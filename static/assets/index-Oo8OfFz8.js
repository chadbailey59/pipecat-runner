(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();function $a(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var xn,Ur;function Ja(){if(Ur)return xn;Ur=1;var t=Object.prototype.toString;xn=function(g){if(g===void 0)return"undefined";if(g===null)return"null";var _=typeof g;if(_==="boolean")return"boolean";if(_==="string")return"string";if(_==="number")return"number";if(_==="symbol")return"symbol";if(_==="function")return o(g)?"generatorfunction":"function";if(n(g))return"array";if(h(g))return"buffer";if(c(g))return"arguments";if(i(g))return"date";if(r(g))return"error";if(a(g))return"regexp";switch(e(g)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(l(g))return"generator";switch(_=t.call(g),_){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return _.slice(8,-1).toLowerCase().replace(/\s/g,"")};function e(p){return typeof p.constructor=="function"?p.constructor.name:null}function n(p){return Array.isArray?Array.isArray(p):p instanceof Array}function r(p){return p instanceof Error||typeof p.message=="string"&&p.constructor&&typeof p.constructor.stackTraceLimit=="number"}function i(p){return p instanceof Date?!0:typeof p.toDateString=="function"&&typeof p.getDate=="function"&&typeof p.setDate=="function"}function a(p){return p instanceof RegExp?!0:typeof p.flags=="string"&&typeof p.ignoreCase=="boolean"&&typeof p.multiline=="boolean"&&typeof p.global=="boolean"}function o(p,g){return e(p)==="GeneratorFunction"}function l(p){return typeof p.throw=="function"&&typeof p.return=="function"&&typeof p.next=="function"}function c(p){try{if(typeof p.length=="number"&&typeof p.callee=="function")return!0}catch(g){if(g.message.indexOf("callee")!==-1)return!0}return!1}function h(p){return p.constructor&&typeof p.constructor.isBuffer=="function"?p.constructor.isBuffer(p):!1}return xn}/*!
 * shallow-clone <https://github.com/jonschlinkert/shallow-clone>
 *
 * Copyright (c) 2015-present, Jon Schlinkert.
 * Released under the MIT License.
 */var jn,$r;function Us(){if($r)return jn;$r=1;const t=Symbol.prototype.valueOf,e=Ja();function n(c,h){switch(e(c)){case"array":return c.slice();case"object":return Object.assign({},c);case"date":return new c.constructor(Number(c));case"map":return new Map(c);case"set":return new Set(c);case"buffer":return o(c);case"symbol":return l(c);case"arraybuffer":return i(c);case"float32array":case"float64array":case"int16array":case"int32array":case"int8array":case"uint16array":case"uint32array":case"uint8clampedarray":case"uint8array":return a(c);case"regexp":return r(c);case"error":return Object.create(c);default:return c}}function r(c){const h=c.flags!==void 0?c.flags:/\w+$/.exec(c)||void 0,p=new c.constructor(c.source,h);return p.lastIndex=c.lastIndex,p}function i(c){const h=new c.constructor(c.byteLength);return new Uint8Array(h).set(new Uint8Array(c)),h}function a(c,h){return new c.constructor(c.buffer,c.byteOffset,c.length)}function o(c){const h=c.length,p=Buffer.allocUnsafe?Buffer.allocUnsafe(h):Buffer.from(h);return c.copy(p),p}function l(c){return t?Object(t.call(c)):{}}return jn=n,jn}/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var Dn,Jr;function $s(){return Jr||(Jr=1,Dn=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1}),Dn}/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var In,qr;function Js(){if(qr)return In;qr=1;var t=$s();function e(n){return t(n)===!0&&Object.prototype.toString.call(n)==="[object Object]"}return In=function(r){var i,a;return!(e(r)===!1||(i=r.constructor,typeof i!="function")||(a=i.prototype,e(a)===!1)||a.hasOwnProperty("isPrototypeOf")===!1)},In}var Nn,Vr;function qs(){if(Vr)return Nn;Vr=1;const t=Us(),e=Ja(),n=Js();function r(o,l){switch(e(o)){case"object":return i(o,l);case"array":return a(o,l);default:return t(o)}}function i(o,l){if(typeof l=="function")return l(o);if(l||n(o)){const c=new o.constructor;for(let h in o)c[h]=r(o[h],l);return c}return o}function a(o,l){const c=new o.constructor(o.length);for(let h=0;h<o.length;h++)c[h]=r(o[h],l);return c}return Nn=r,Nn}var Vs=qs();const Wr=$a(Vs);var Ht={exports:{}},zr;function Ws(){if(zr)return Ht.exports;zr=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(b,E,T){return Function.prototype.apply.call(b,E,T)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:n=function(b){return Object.getOwnPropertyNames(b)};function r(k){console&&console.warn&&console.warn(k)}var i=Number.isNaN||function(b){return b!==b};function a(){a.init.call(this)}Ht.exports=a,Ht.exports.once=A,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function l(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(k){if(typeof k!="number"||k<0||i(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");o=k}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||i(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this};function c(k){return k._maxListeners===void 0?a.defaultMaxListeners:k._maxListeners}a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(b){for(var E=[],T=1;T<arguments.length;T++)E.push(arguments[T]);var P=b==="error",F=this._events;if(F!==void 0)P=P&&F.error===void 0;else if(!P)return!1;if(P){var R;if(E.length>0&&(R=E[0]),R instanceof Error)throw R;var ee=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw ee.context=R,ee}var ge=F[b];if(ge===void 0)return!1;if(typeof ge=="function")e(ge,this,E);else for(var Ce=ge.length,He=v(ge,Ce),T=0;T<Ce;++T)e(He[T],this,E);return!0};function h(k,b,E,T){var P,F,R;if(l(E),F=k._events,F===void 0?(F=k._events=Object.create(null),k._eventsCount=0):(F.newListener!==void 0&&(k.emit("newListener",b,E.listener?E.listener:E),F=k._events),R=F[b]),R===void 0)R=F[b]=E,++k._eventsCount;else if(typeof R=="function"?R=F[b]=T?[E,R]:[R,E]:T?R.unshift(E):R.push(E),P=c(k),P>0&&R.length>P&&!R.warned){R.warned=!0;var ee=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");ee.name="MaxListenersExceededWarning",ee.emitter=k,ee.type=b,ee.count=R.length,r(ee)}return k}a.prototype.addListener=function(b,E){return h(this,b,E,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(b,E){return h(this,b,E,!0)};function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(k,b,E){var T={fired:!1,wrapFn:void 0,target:k,type:b,listener:E},P=p.bind(T);return P.listener=E,T.wrapFn=P,P}a.prototype.once=function(b,E){return l(E),this.on(b,g(this,b,E)),this},a.prototype.prependOnceListener=function(b,E){return l(E),this.prependListener(b,g(this,b,E)),this},a.prototype.removeListener=function(b,E){var T,P,F,R,ee;if(l(E),P=this._events,P===void 0)return this;if(T=P[b],T===void 0)return this;if(T===E||T.listener===E)--this._eventsCount===0?this._events=Object.create(null):(delete P[b],P.removeListener&&this.emit("removeListener",b,T.listener||E));else if(typeof T!="function"){for(F=-1,R=T.length-1;R>=0;R--)if(T[R]===E||T[R].listener===E){ee=T[R].listener,F=R;break}if(F<0)return this;F===0?T.shift():w(T,F),T.length===1&&(P[b]=T[0]),P.removeListener!==void 0&&this.emit("removeListener",b,ee||E)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(b){var E,T,P;if(T=this._events,T===void 0)return this;if(T.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):T[b]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete T[b]),this;if(arguments.length===0){var F=Object.keys(T),R;for(P=0;P<F.length;++P)R=F[P],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(E=T[b],typeof E=="function")this.removeListener(b,E);else if(E!==void 0)for(P=E.length-1;P>=0;P--)this.removeListener(b,E[P]);return this};function _(k,b,E){var T=k._events;if(T===void 0)return[];var P=T[b];return P===void 0?[]:typeof P=="function"?E?[P.listener||P]:[P]:E?O(P):v(P,P.length)}a.prototype.listeners=function(b){return _(this,b,!0)},a.prototype.rawListeners=function(b){return _(this,b,!1)},a.listenerCount=function(k,b){return typeof k.listenerCount=="function"?k.listenerCount(b):C.call(k,b)},a.prototype.listenerCount=C;function C(k){var b=this._events;if(b!==void 0){var E=b[k];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function v(k,b){for(var E=new Array(b),T=0;T<b;++T)E[T]=k[T];return E}function w(k,b){for(;b+1<k.length;b++)k[b]=k[b+1];k.pop()}function O(k){for(var b=new Array(k.length),E=0;E<b.length;++E)b[E]=k[E].listener||k[E];return b}function A(k,b){return new Promise(function(E,T){function P(R){k.removeListener(b,F),T(R)}function F(){typeof k.removeListener=="function"&&k.removeListener("error",P),E([].slice.call(arguments))}N(k,b,F,{once:!0}),b!=="error"&&x(k,P,{once:!0})})}function x(k,b,E){typeof k.on=="function"&&N(k,"error",b,E)}function N(k,b,E,T){if(typeof k.on=="function")T.once?k.once(b,E):k.on(b,E);else if(typeof k.addEventListener=="function")k.addEventListener(b,function P(F){T.once&&k.removeEventListener(b,P),E(F)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}return Ht.exports}var zs=Ws();const Gs=$a(zs);var ne=[];for(var Rn=0;Rn<256;++Rn)ne.push((Rn+256).toString(16).slice(1));function Hs(t,e=0){return(ne[t[e+0]]+ne[t[e+1]]+ne[t[e+2]]+ne[t[e+3]]+"-"+ne[t[e+4]]+ne[t[e+5]]+"-"+ne[t[e+6]]+ne[t[e+7]]+"-"+ne[t[e+8]]+ne[t[e+9]]+"-"+ne[t[e+10]]+ne[t[e+11]]+ne[t[e+12]]+ne[t[e+13]]+ne[t[e+14]]+ne[t[e+15]]).toLowerCase()}var Qt,Qs=new Uint8Array(16);function Ks(){if(!Qt&&(Qt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Qt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Qt(Qs)}var Ys=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Gr={randomUUID:Ys};function Xs(t,e,n){if(Gr.randomUUID&&!e&&!t)return Gr.randomUUID();t=t||{};var r=t.random||(t.rng||Ks)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=r[i];return e}return Hs(r)}function X(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}function Zs(t){return t&&t.__esModule?t.default:t}var eo={};X(eo,"httpActionGenerator",()=>qa);async function qa(t,e,n,r){try{Q.debug("[RTVI] Fetch action",t,e);const i=new Headers({...Object.fromEntries((n.headers??new Headers).entries())});i.has("Content-Type")||i.set("Content-Type","application/json"),i.set("Cache-Control","no-cache"),i.set("Connection","keep-alive");const a=await fetch(t,{method:"POST",headers:i,body:JSON.stringify({...n.requestData,actions:[e]})}),o=a.headers.get("content-type");if(!a.ok){const l=await a.text();throw new fe(`Failed to resolve action: ${l}`,a.status)}if(a.body&&(o!=null&&o.includes("text/event-stream"))){const l=a.body.pipeThrough(new TextDecoderStream).getReader();let c="";for(;;){const{value:h,done:p}=await l.read();if(p)break;c+=h;let g=c.indexOf(`

`);for(;g!==-1;){const _=c.slice(0,g);c=c.slice(g+2);const C=_.split(`
`);let v="";for(const w of C){const O=w.indexOf(":");O!==-1&&(v+=w.slice(O+1).trim())}try{const w=atob(v),O=JSON.parse(w);r(O)}catch(w){throw Q.error("[RTVI] Failed to parse JSON:",w),w}g=c.indexOf(`

`)}}}else{const l=await a.json();r(l)}}catch(i){throw Q.error("[RTVI] Error during fetch:",i),i}}var to={};X(to,"RTVIClient",()=>Ne);var Va={};Va=JSON.parse('{"name":"@pipecat-ai/client-js","version":"0.3.2","license":"BSD-2-Clause","main":"dist/index.js","module":"dist/index.module.js","types":"dist/index.d.ts","source":"src/index.ts","repository":{"type":"git","url":"git+https://github.com/pipecat-ai/pipecat-client-web.git"},"files":["dist","package.json","README.md"],"scripts":{"build":"jest --silent && parcel build --no-cache","dev":"parcel watch","lint":"eslint src/ --report-unused-disable-directives --max-warnings 0","test":"jest"},"jest":{"preset":"ts-jest","testEnvironment":"node"},"devDependencies":{"@jest/globals":"^29.7.0","@types/clone-deep":"^4.0.4","@types/jest":"^29.5.12","@types/uuid":"^10.0.0","eslint":"^9.11.1","eslint-config-prettier":"^9.1.0","eslint-plugin-simple-import-sort":"^12.1.1","jest":"^29.7.0","ts-jest":"^29.2.5"},"dependencies":{"@types/events":"^3.0.3","clone-deep":"^4.0.1","events":"^3.3.0","typed-emitter":"^2.1.0","uuid":"^10.0.0"}}');var mt={};X(mt,"RTVIError",()=>fe);X(mt,"ConnectionTimeoutError",()=>Wa);X(mt,"StartBotError",()=>er);X(mt,"TransportStartError",()=>za);X(mt,"BotNotReadyError",()=>Ve);X(mt,"ConfigUpdateError",()=>no);X(mt,"ActionEndpointNotSetError",()=>Ga);class fe extends Error{constructor(e,n){super(e),this.status=n}}class Wa extends fe{constructor(e){super(e??"Bot did not enter ready state within the specified timeout period.")}}class er extends fe{constructor(e,n){super(e??"Failed to connect / invalid auth bundle from base url",n??500),this.error="invalid-request-error"}}class za extends fe{constructor(e){super(e??"Unable to connect to transport")}}class Ve extends fe{constructor(e){super(e??"Attempt to call action on transport when not in 'ready' state.")}}class no extends fe{constructor(e){super(e??"Unable to update configuration"),this.status=400}}class Ga extends fe{constructor(e){super(e??"Action endpoint is not set")}}function Mt(t,e,n){const r=n.value;return n.value=function(...i){if(this.state==="ready")return r.apply(this,i);throw new Ve(`Attempt to call ${e.toString()} when transport not in ready state. Await connect() first.`)},n}function ro(...t){return t=["ready",...t],function(e,n,r){const i=r.get;return r.get=function(){if(t.includes(this.state))return i==null?void 0:i.apply(this);throw new Ve(`Attempt to call ${n.toString()} when transport not in ${t}. Await connect() first.`)},r}}var io={};X(io,"RTVIEvent",()=>j);var j;(function(t){t.MessageError="messageError",t.Error="error",t.Connected="connected",t.Disconnected="disconnected",t.TransportStateChanged="transportStateChanged",t.Config="config",t.ConfigDescribe="configDescribe",t.ActionsAvailable="actionsAvailable",t.ParticipantConnected="participantConnected",t.ParticipantLeft="participantLeft",t.TrackStarted="trackStarted",t.TrackStopped="trackStopped",t.ScreenTrackStarted="screenTrackStarted",t.ScreenTrackStopped="screenTrackStopped",t.ScreenShareError="screenShareError",t.AvailableCamsUpdated="availableCamsUpdated",t.AvailableMicsUpdated="availableMicsUpdated",t.AvailableSpeakersUpdated="availableSpeakersUpdated",t.CamUpdated="camUpdated",t.MicUpdated="micUpdated",t.SpeakerUpdated="speakerUpdated",t.BotConnected="botConnected",t.BotReady="botReady",t.BotDisconnected="botDisconnected",t.BotStartedSpeaking="botStartedSpeaking",t.BotStoppedSpeaking="botStoppedSpeaking",t.RemoteAudioLevel="remoteAudioLevel",t.UserStartedSpeaking="userStartedSpeaking",t.UserStoppedSpeaking="userStoppedSpeaking",t.LocalAudioLevel="localAudioLevel",t.Metrics="metrics",t.UserTranscript="userTranscript",t.BotTranscript="botTranscript",t.BotLlmText="botLlmText",t.BotLlmStarted="botLlmStarted",t.BotLlmStopped="botLlmStopped",t.BotTtsText="botTtsText",t.BotTtsStarted="botTtsStarted",t.BotTtsStopped="botTtsStopped",t.LLMFunctionCall="llmFunctionCall",t.LLMFunctionCallStart="llmFunctionCallStart",t.LLMJsonCompletion="llmJsonCompletion",t.StorageItemStored="storageItemStored"})(j||(j={}));var ao={};X(ao,"RTVIClientHelper",()=>Cr);class Cr{constructor(e){this._options=e}set client(e){this._client=e}set service(e){this._service=e}}var Ha={};X(Ha,"LogLevel",()=>Je);X(Ha,"logger",()=>Q);var Je;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=1]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG"})(Je||(Je={}));class yt{constructor(){this.level=Je.DEBUG}static getInstance(){return yt.instance||(yt.instance=new yt),yt.instance}setLevel(e){this.level=e}debug(...e){this.level>=Je.DEBUG&&console.debug(...e)}info(...e){this.level>=Je.INFO&&console.info(...e)}warn(...e){this.level>=Je.WARN&&console.warn(...e)}error(...e){this.level>=Je.ERROR&&console.error(...e)}}const Q=yt.getInstance();var Tt={};X(Tt,"RTVI_MESSAGE_LABEL",()=>Qa);X(Tt,"RTVIMessageType",()=>J);X(Tt,"RTVIMessage",()=>ie);X(Tt,"RTVI_ACTION_TYPE",()=>Ka);X(Tt,"RTVIActionRequest",()=>Ya);X(Tt,"MessageDispatcher",()=>Xa);const Qa="rtvi-ai";var J;(function(t){t.CLIENT_READY="client-ready",t.UPDATE_CONFIG="update-config",t.GET_CONFIG="get-config",t.DESCRIBE_CONFIG="describe-config",t.DESCRIBE_ACTIONS="describe-actions",t.DISCONNECT_BOT="disconnect-bot",t.BOT_READY="bot-ready",t.ERROR="error",t.ERROR_RESPONSE="error-response",t.CONFIG="config",t.CONFIG_AVAILABLE="config-available",t.CONFIG_ERROR="config-error",t.ACTIONS_AVAILABLE="actions-available",t.ACTION_RESPONSE="action-response",t.METRICS="metrics",t.USER_TRANSCRIPTION="user-transcription",t.BOT_TRANSCRIPTION="bot-transcription",t.USER_STARTED_SPEAKING="user-started-speaking",t.USER_STOPPED_SPEAKING="user-stopped-speaking",t.BOT_STARTED_SPEAKING="bot-started-speaking",t.BOT_STOPPED_SPEAKING="bot-stopped-speaking",t.USER_LLM_TEXT="user-llm-text",t.BOT_LLM_TEXT="bot-llm-text",t.BOT_LLM_STARTED="bot-llm-started",t.BOT_LLM_STOPPED="bot-llm-stopped",t.BOT_TTS_TEXT="bot-tts-text",t.BOT_TTS_STARTED="bot-tts-started",t.BOT_TTS_STOPPED="bot-tts-stopped",t.STORAGE_ITEM_STORED="storage-item-stored"})(J||(J={}));class ie{constructor(e,n,r){this.label=Qa,this.type=e,this.data=n,this.id=r||Xs().slice(0,8)}static clientReady(){return new ie(J.CLIENT_READY,{})}static updateConfig(e,n=!1){return new ie(J.UPDATE_CONFIG,{config:e,interrupt:n})}static describeConfig(){return new ie(J.DESCRIBE_CONFIG,{})}static getBotConfig(){return new ie(J.GET_CONFIG,{})}static describeActions(){return new ie(J.DESCRIBE_ACTIONS,{})}static disconnectBot(){return new ie(J.DISCONNECT_BOT,{})}}const Ka="action";class Ya extends ie{constructor(e){super(Ka,e)}}class Xa{constructor(e){this._queue=new Array,this._gcTime=1e4,this._queue=[],this._client=e}dispatch(e){const n=new Promise((r,i)=>{this._queue.push({message:e,timestamp:Date.now(),resolve:r,reject:i})});return Q.debug("[MessageDispatcher] dispatch",e),this._client.sendMessage(e),this._gc(),n}async dispatchAction(e,n){var i;const r=new Promise((a,o)=>{this._queue.push({message:e,timestamp:Date.now(),resolve:a,reject:o})});if(Q.debug("[MessageDispatcher] action",e),this._client.connected)this._client.sendMessage(e);else{if(!((i=this._client.params.endpoints)!=null&&i.action))throw Q.error("[MessageDispatcher] Action endpoint is required when dispatching action in disconnected state"),new Ga;const a=this._client.constructUrl("action");try{await qa(a,e,this._client.params,o=>{n(o)})}catch{n(new ie(J.ERROR_RESPONSE,`Action endpoint '${a}' returned an error response`,e.id))}}return this._gc(),r}_resolveReject(e,n=!0){const r=this._queue.find(i=>i.message.id===e.id);return r&&(n?(Q.debug("[MessageDispatcher] Resolve",e),r.resolve((e.type===J.ACTION_RESPONSE,e))):(Q.debug("[MessageDispatcher] Reject",e),r.reject(e)),this._queue=this._queue.filter(i=>i.message.id!==e.id),Q.debug("[MessageDispatcher] Queue",this._queue)),e}resolve(e){return this._resolveReject(e,!0)}reject(e){return this._resolveReject(e,!1)}_gc(){this._queue=this._queue.filter(e=>Date.now()-e.timestamp<this._gcTime),Q.debug("[MessageDispatcher] GC",this._queue)}}var gt=function(t,e,n,r){var i=arguments.length,a=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(t,e,n,r);else for(var l=t.length-1;l>=0;l--)(o=t[l])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a};const so={connect:"/connect",action:"/action"};class oo extends Gs{}class Ne extends oo{constructor(e){super(),this.params={...e.params,endpoints:{...so,...e.params.endpoints??{}}},this._helpers={},this._transport=e.transport;const n={...e.callbacks,onMessageError:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onMessageError)==null||a.call(i,r),this.emit(j.MessageError,r)},onError:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onError)==null||a.call(i,r),this.emit(j.Error,r)},onConnected:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onConnected)==null||i.call(r),this.emit(j.Connected)},onDisconnected:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onDisconnected)==null||i.call(r),this.emit(j.Disconnected)},onTransportStateChanged:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onTransportStateChanged)==null||a.call(i,r),this.emit(j.TransportStateChanged,r)},onConfig:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onConfig)==null||a.call(i,r),this.emit(j.Config,r)},onConfigDescribe:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onConfigDescribe)==null||a.call(i,r),this.emit(j.ConfigDescribe,r)},onActionsAvailable:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onActionsAvailable)==null||a.call(i,r),this.emit(j.ActionsAvailable,r)},onParticipantJoined:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onParticipantJoined)==null||a.call(i,r),this.emit(j.ParticipantConnected,r)},onParticipantLeft:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onParticipantLeft)==null||a.call(i,r),this.emit(j.ParticipantLeft,r)},onTrackStarted:(r,i)=>{var a,o;(o=(a=e==null?void 0:e.callbacks)==null?void 0:a.onTrackStarted)==null||o.call(a,r,i),this.emit(j.TrackStarted,r,i)},onTrackStopped:(r,i)=>{var a,o;(o=(a=e==null?void 0:e.callbacks)==null?void 0:a.onTrackStopped)==null||o.call(a,r,i),this.emit(j.TrackStopped,r,i)},onScreenTrackStarted:(r,i)=>{var a,o;(o=(a=e==null?void 0:e.callbacks)==null?void 0:a.onScreenTrackStarted)==null||o.call(a,r,i),this.emit(j.ScreenTrackStarted,r,i)},onScreenTrackStopped:(r,i)=>{var a,o;(o=(a=e==null?void 0:e.callbacks)==null?void 0:a.onScreenTrackStopped)==null||o.call(a,r,i),this.emit(j.ScreenTrackStopped,r,i)},onScreenShareError:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onScreenShareError)==null||a.call(i,r),this.emit(j.ScreenShareError,r)},onAvailableCamsUpdated:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onAvailableCamsUpdated)==null||a.call(i,r),this.emit(j.AvailableCamsUpdated,r)},onAvailableMicsUpdated:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onAvailableMicsUpdated)==null||a.call(i,r),this.emit(j.AvailableMicsUpdated,r)},onAvailableSpeakersUpdated:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onAvailableSpeakersUpdated)==null||a.call(i,r),this.emit(j.AvailableSpeakersUpdated,r)},onCamUpdated:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onCamUpdated)==null||a.call(i,r),this.emit(j.CamUpdated,r)},onMicUpdated:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onMicUpdated)==null||a.call(i,r),this.emit(j.MicUpdated,r)},onSpeakerUpdated:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onSpeakerUpdated)==null||a.call(i,r),this.emit(j.SpeakerUpdated,r)},onBotConnected:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotConnected)==null||a.call(i,r),this.emit(j.BotConnected,r)},onBotReady:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotReady)==null||a.call(i,r),this.emit(j.BotReady,r)},onBotDisconnected:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotDisconnected)==null||a.call(i,r),this.emit(j.BotDisconnected,r)},onBotStartedSpeaking:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotStartedSpeaking)==null||i.call(r),this.emit(j.BotStartedSpeaking)},onBotStoppedSpeaking:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotStoppedSpeaking)==null||i.call(r),this.emit(j.BotStoppedSpeaking)},onRemoteAudioLevel:(r,i)=>{var a,o;(o=(a=e==null?void 0:e.callbacks)==null?void 0:a.onRemoteAudioLevel)==null||o.call(a,r,i),this.emit(j.RemoteAudioLevel,r,i)},onUserStartedSpeaking:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onUserStartedSpeaking)==null||i.call(r),this.emit(j.UserStartedSpeaking)},onUserStoppedSpeaking:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onUserStoppedSpeaking)==null||i.call(r),this.emit(j.UserStoppedSpeaking)},onLocalAudioLevel:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onLocalAudioLevel)==null||a.call(i,r),this.emit(j.LocalAudioLevel,r)},onUserTranscript:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onUserTranscript)==null||a.call(i,r),this.emit(j.UserTranscript,r)},onBotTranscript:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotTranscript)==null||a.call(i,r),this.emit(j.BotTranscript,r)},onBotLlmText:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotLlmText)==null||a.call(i,r),this.emit(j.BotLlmText,r)},onBotLlmStarted:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotLlmStarted)==null||i.call(r),this.emit(j.BotLlmStarted)},onBotLlmStopped:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotLlmStopped)==null||i.call(r),this.emit(j.BotLlmStopped)},onBotTtsText:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotTtsText)==null||a.call(i,r),this.emit(j.BotTtsText,r)},onBotTtsStarted:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotTtsStarted)==null||i.call(r),this.emit(j.BotTtsStarted)},onBotTtsStopped:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotTtsStopped)==null||i.call(r),this.emit(j.BotTtsStopped)},onStorageItemStored:r=>{var i,a;(a=(i=e==null?void 0:e.callbacks)==null?void 0:i.onStorageItemStored)==null||a.call(i,r),this.emit(j.StorageItemStored,r)}};this._options={...e,callbacks:n,enableMic:e.enableMic??!0,enableCam:e.enableCam??!1},this._initialize(),Q.debug("[RTVI Client] Initialized",this.version)}constructUrl(e){var r;if(!this.params.baseUrl)throw new fe("Base URL not set. Please set rtviClient.params.baseUrl");return this.params.baseUrl.replace(/\/+$/,"")+(((r=this.params.endpoints)==null?void 0:r[e])??"")}setLogLevel(e){Q.setLevel(e)}async initDevices(){Q.debug("[RTVI Client] Initializing devices..."),await this._transport.initDevices()}async connect(){if(["authenticating","connecting","connected","ready"].includes(this._transport.state))throw new fe("Voice client has already been started. Please call disconnect() before starting again.");return this._abortController=new AbortController,new Promise((e,n)=>{(async()=>{var a,o,l;this._startResolve=e,this._transport.state==="disconnected"&&await this._transport.initDevices(),this._transport.state="authenticating",this._options.timeout&&(this._handshakeTimeout=setTimeout(async()=>{var c;(c=this._abortController)==null||c.abort(),await this.disconnect(),this._transport.state="error",n(new Wa)},this._options.timeout));let r;const i=this._options.customConnectHandler;if(Q.debug("[RTVI Client] Start params",this.params),this.params={...this.params,requestData:{...this.params.requestData,rtvi_client_version:this.version}},!this.params.baseUrl&&!((a=this.params.endpoints)!=null&&a.connect))Q.debug("[RTVI Client] Connecting directly (skipping handshake / auth)..."),clearTimeout(this._handshakeTimeout);else{const c=this.constructUrl("connect");Q.debug("[RTVI Client] Connecting...",c),Q.debug("[RTVI Client] Start params",this.params);try{i?r=await i(this.params,this._handshakeTimeout,this._abortController):r=await fetch(c,{method:"POST",mode:"cors",headers:new Headers({"Content-Type":"application/json",...Object.fromEntries((this.params.headers??new Headers).entries())}),body:JSON.stringify({config:this.params.config,...this.params.services?{services:this.params.services}:{},...this.params.requestData}),signal:(o=this._abortController)==null?void 0:o.signal}).then(h=>(clearTimeout(this._handshakeTimeout),h.ok?h.json():Promise.reject(h)))}catch(h){if(clearTimeout(this._handshakeTimeout),(l=this._abortController)!=null&&l.signal.aborted)return;if(this._transport.state="error",h instanceof Response){const p=await h.json();n(new er(p.info??p.detail??h.statusText,h.status))}else n(new er);return}Q.debug("[RTVI Client] Auth bundle received",r)}try{await this._transport.connect(r,this._abortController)}catch(c){clearTimeout(this._handshakeTimeout),n(c);return}await this._transport.sendReadyMessage()})()})}async disconnect(){this._abortController&&this._abortController.abort(),clearTimeout(this._handshakeTimeout),await this._transport.disconnect(),this._initialize()}_initialize(){this._transport=this._options.transport,this._transport.initialize(this._options,this.handleMessage.bind(this)),this._messageDispatcher=new Xa(this)}get connected(){return["connected","ready"].includes(this._transport.state)}get state(){return this._transport.state}get version(){return Zs(Va).version}async getAllMics(){return await this._transport.getAllMics()}async getAllCams(){return await this._transport.getAllCams()}async getAllSpeakers(){return await this._transport.getAllSpeakers()}get selectedMic(){return this._transport.selectedMic}get selectedCam(){return this._transport.selectedCam}get selectedSpeaker(){return this._transport.selectedSpeaker}updateMic(e){this._transport.updateMic(e)}updateCam(e){this._transport.updateCam(e)}updateSpeaker(e){this._transport.updateSpeaker(e)}enableMic(e){this._transport.enableMic(e)}get isMicEnabled(){return this._transport.isMicEnabled}enableCam(e){this._transport.enableCam(e)}get isCamEnabled(){return this._transport.isCamEnabled}tracks(){return this._transport.tracks()}enableScreenShare(e){return this._transport.enableScreenShare(e)}get isSharingScreen(){return this._transport.isSharingScreen}async getConfig(){return(await this._messageDispatcher.dispatch(ie.getBotConfig())).data.config}async updateConfig(e,n=!1){return Q.debug("[RTVI Client] Updating config",e),this._messageDispatcher.dispatch(ie.updateConfig(e,n))}async describeConfig(){return this._messageDispatcher.dispatch(ie.describeConfig())}async getServiceOptionsFromConfig(e,n){if(!n&&this.state!=="ready")throw new Ve("getServiceOptionsFromConfig called without config array before bot is ready");return Promise.resolve().then(async()=>{if(!e){Q.debug("Target service name is required");return}const i=(n??await this.getConfig()).find(a=>a.service===e);if(!i){Q.debug("No service with name "+e+" not found in config");return}return i})}async getServiceOptionValueFromConfig(e,n,r){const i=await this.getServiceOptionsFromConfig(e,r);if(!i){Q.debug("Service with name "+e+" not found in config");return}const a=i.options.find(o=>o.name===n);return a?a.value:void 0}_updateOrAddOption(e,n){const r=e.findIndex(i=>i.name===n.name);return r!==-1?e.map((i,a)=>a===r?{...i,value:n.value}:i):[...e,{name:n.name,value:n.value}]}async setServiceOptionInConfig(e,n,r){const i=Wr(r??await this.getConfig());if(!await this.getServiceOptionsFromConfig(e,i))return Q.debug("Service with name '"+e+"' not found in config"),i;const o=Array.isArray(n)?n:[n];for(const l of o){const c=i.find(p=>p.service===e),h=c?this._updateOrAddOption(c.options,l):[{name:l.name,value:l.value}];c?c.options=h:i.push({service:e,options:h})}return i}async setConfigOptions(e,n){let r=Wr(n??await this.getConfig());for(const i of e)r=await this.setServiceOptionInConfig(i.service,i.options,r)||r;return r}async action(e){return this._messageDispatcher.dispatchAction(new Ya(e),this.handleMessage.bind(this))}async describeActions(){return this._messageDispatcher.dispatch(ie.describeActions())}get transportExpiry(){return this._transport.expiry}sendMessage(e){this._transport.sendMessage(e)}disconnectBot(){this._transport.sendMessage(new ie(J.DISCONNECT_BOT,{}))}handleMessage(e){var n,r,i,a,o,l,c,h,p,g,_,C,v,w,O,A,x,N,k,b,E,T,P,F,R,ee,ge,Ce,He,Qe,At,Ke,Pt,Ye,Lt,Xe,zt,ae,s,u,d,m,f;switch(Q.debug("[RTVI Message]",e),e.type){case J.BOT_READY:clearTimeout(this._handshakeTimeout),(n=this._startResolve)==null||n.call(this,e.data),(i=(r=this._options.callbacks)==null?void 0:r.onBotReady)==null||i.call(r,e.data);break;case J.CONFIG_AVAILABLE:this._messageDispatcher.resolve(e),(o=(a=this._options.callbacks)==null?void 0:a.onConfigDescribe)==null||o.call(a,e.data);break;case J.CONFIG:{const y=this._messageDispatcher.resolve(e);(c=(l=this._options.callbacks)==null?void 0:l.onConfig)==null||c.call(l,y.data.config);break}case J.ACTIONS_AVAILABLE:this._messageDispatcher.resolve(e),(p=(h=this._options.callbacks)==null?void 0:h.onActionsAvailable)==null||p.call(h,e.data);break;case J.ACTION_RESPONSE:this._messageDispatcher.resolve(e);break;case J.ERROR_RESPONSE:{const y=this._messageDispatcher.reject(e);(_=(g=this._options.callbacks)==null?void 0:g.onMessageError)==null||_.call(g,y);break}case J.ERROR:(v=(C=this._options.callbacks)==null?void 0:C.onError)==null||v.call(C,e);break;case J.USER_STARTED_SPEAKING:(O=(w=this._options.callbacks)==null?void 0:w.onUserStartedSpeaking)==null||O.call(w);break;case J.USER_STOPPED_SPEAKING:(x=(A=this._options.callbacks)==null?void 0:A.onUserStoppedSpeaking)==null||x.call(A);break;case J.BOT_STARTED_SPEAKING:(k=(N=this._options.callbacks)==null?void 0:N.onBotStartedSpeaking)==null||k.call(N);break;case J.BOT_STOPPED_SPEAKING:(E=(b=this._options.callbacks)==null?void 0:b.onBotStoppedSpeaking)==null||E.call(b);break;case J.USER_TRANSCRIPTION:{const y=e.data;(P=(T=this._options.callbacks)==null?void 0:T.onUserTranscript)==null||P.call(T,y);break}case J.BOT_TRANSCRIPTION:(R=(F=this._options.callbacks)==null?void 0:F.onBotTranscript)==null||R.call(F,e.data);break;case J.BOT_LLM_TEXT:(ge=(ee=this._options.callbacks)==null?void 0:ee.onBotLlmText)==null||ge.call(ee,e.data);break;case J.BOT_LLM_STARTED:(He=(Ce=this._options.callbacks)==null?void 0:Ce.onBotLlmStarted)==null||He.call(Ce);break;case J.BOT_LLM_STOPPED:(At=(Qe=this._options.callbacks)==null?void 0:Qe.onBotLlmStopped)==null||At.call(Qe);break;case J.BOT_TTS_TEXT:(Pt=(Ke=this._options.callbacks)==null?void 0:Ke.onBotTtsText)==null||Pt.call(Ke,e.data);break;case J.BOT_TTS_STARTED:(Lt=(Ye=this._options.callbacks)==null?void 0:Ye.onBotTtsStarted)==null||Lt.call(Ye);break;case J.BOT_TTS_STOPPED:(zt=(Xe=this._options.callbacks)==null?void 0:Xe.onBotTtsStopped)==null||zt.call(Xe);break;case J.METRICS:this.emit(j.Metrics,e.data),(s=(ae=this._options.callbacks)==null?void 0:ae.onMetrics)==null||s.call(ae,e.data);break;case J.STORAGE_ITEM_STORED:(d=(u=this._options.callbacks)==null?void 0:u.onStorageItemStored)==null||d.call(u,e.data);break;default:{let y=!1;for(const M of Object.values(this._helpers))M.getMessageTypes().includes(e.type)&&(y=!0,M.handleMessage(e));y||(f=(m=this._options.callbacks)==null?void 0:m.onGenericMessage)==null||f.call(m,e.data)}}}registerHelper(e,n){if(this._helpers[e])throw new Error(`Helper with name '${e}' already registered`);if(!(n instanceof Cr))throw new Error("Helper must be an instance of RTVIClientHelper");return n.service=e,n.client=this,this._helpers[e]=n,this._helpers[e]}getHelper(e){const n=this._helpers[e];if(!n){Q.debug(`Helper targeting service '${e}' not found`);return}return n}unregisterHelper(e){this._helpers[e]&&delete this._helpers[e]}}gt([Mt],Ne.prototype,"getConfig",null);gt([Mt],Ne.prototype,"updateConfig",null);gt([Mt],Ne.prototype,"describeConfig",null);gt([Mt],Ne.prototype,"describeActions",null);gt([ro("connected","ready")],Ne.prototype,"transportExpiry",null);gt([Mt],Ne.prototype,"sendMessage",null);gt([Mt],Ne.prototype,"disconnectBot",null);var Za={};X(Za,"LLMMessageType",()=>qe);X(Za,"LLMHelper",()=>co);var qe;(function(t){t.LLM_FUNCTION_CALL="llm-function-call",t.LLM_FUNCTION_CALL_START="llm-function-call-start",t.LLM_FUNCTION_CALL_RESULT="llm-function-call-result",t.LLM_JSON_COMPLETION="llm-json-completion"})(qe||(qe={}));class co extends Cr{constructor(e){super(e),this._functionCallCallback=null}getMessageTypes(){return Object.values(qe)}async getContext(){if(this._client.state!=="ready")throw new Ve("getContext called while transport not in ready state");return(await this._client.action({service:this._service,action:"get_context"})).data.result}async setContext(e,n=!1){if(this._client.state!=="ready")throw new Ve("setContext called while transport not in ready state");return!!(await this._client.action({service:this._service,action:"set_context",arguments:[{name:"messages",value:e.messages},{name:"interrupt",value:n}]})).data.result}async appendToMessages(e,n=!1){if(this._client.state!=="ready")throw new Ve("setContext called while transport not in ready state");return!!(await this._client.action({service:this._service,action:"append_to_messages",arguments:[{name:"messages",value:[e]},{name:"run_immediately",value:n}]})).data.result}async run(e=!1){if(this._client.state==="ready")return this._client.action({service:this._service,action:"run",arguments:[{name:"interrupt",value:e}]})}handleFunctionCall(e){this._functionCallCallback=e}handleMessage(e){var n,r,i,a,o,l;switch(e.type){case qe.LLM_JSON_COMPLETION:(r=(n=this._options.callbacks)==null?void 0:n.onLLMJsonCompletion)==null||r.call(n,e.data),this._client.emit(j.LLMJsonCompletion,e.data);break;case qe.LLM_FUNCTION_CALL:{const c=e.data;if((a=(i=this._options.callbacks)==null?void 0:i.onLLMFunctionCall)==null||a.call(i,e.data),this._client.emit(j.LLMFunctionCall,e.data),this._functionCallCallback){const h={functionName:c.function_name,arguments:c.args};if(this._client.state==="ready")this._functionCallCallback(h).then(p=>{this._client.sendMessage(new ie(qe.LLM_FUNCTION_CALL_RESULT,{function_name:c.function_name,tool_call_id:c.tool_call_id,arguments:c.args,result:p}))});else throw new Ve("Attempted to send a function call result from bot while transport not in ready state")}break}case qe.LLM_FUNCTION_CALL_START:{const c=e.data;(l=(o=this._options.callbacks)==null?void 0:o.onLLMFunctionCallStart)==null||l.call(o,c.function_name),this._client.emit(j.LLMFunctionCallStart,c.function_name);break}}}}var lo={};X(lo,"Transport",()=>es);class es{constructor(){this._state="disconnected",this._expiry=void 0}get expiry(){return this._expiry}}function Hr(t,e){if(t==null)return{};var n,r,i=function(o,l){if(o==null)return{};var c,h,p={},g=Object.keys(o);for(h=0;h<g.length;h++)c=g[h],l.indexOf(c)>=0||(p[c]=o[c]);return p}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function we(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t){return z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(t)}function ts(t){var e=function(n,r){if(z(n)!=="object"||n===null)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,r||"default");if(z(a)!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(t,"string");return z(e)==="symbol"?e:String(e)}function Qr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ts(r.key),r)}}function ke(t,e,n){return e&&Qr(t.prototype,e),n&&Qr(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Le(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ut(t,e){return Ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},Ut(t,e)}function Cn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ut(t,e)}function En(t,e){if(e&&(z(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Le(t)}function Se(t){return Se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Se(t)}function je(t,e,n){return(e=ts(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Kr(t,e,n,r,i,a,o){try{var l=t[a](o),c=l.value}catch(h){return void n(h)}l.done?e(c):Promise.resolve(c).then(r,i)}function D(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(c){Kr(a,r,i,o,l,"next",c)}function l(c){Kr(a,r,i,o,l,"throw",c)}o(void 0)})}}function Yr(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ut(t,e){return function(n){if(Array.isArray(n))return n}(t)||function(n,r){var i=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var a,o,l,c,h=[],p=!0,g=!1;try{if(l=(i=i.call(n)).next,r===0){if(Object(i)!==i)return;p=!1}else for(;!(p=(a=l.call(i)).done)&&(h.push(a.value),h.length!==r);p=!0);}catch(_){g=!0,o=_}finally{try{if(!p&&i.return!=null&&(c=i.return(),Object(c)!==c))return}finally{if(g)throw o}}return h}}(t,e)||function(n,r){if(n){if(typeof n=="string")return Yr(n,r);var i=Object.prototype.toString.call(n).slice(8,-1);return i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set"?Array.from(n):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Yr(n,r):void 0}}(t,e)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}var ns,De={},uo={get exports(){return De},set exports(t){De=t}},bt=typeof Reflect=="object"?Reflect:null,Xr=bt&&typeof bt.apply=="function"?bt.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};ns=bt&&typeof bt.ownKeys=="function"?bt.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var Zr=Number.isNaN||function(t){return t!=t};function W(){W.init.call(this)}uo.exports=W,De.once=function(t,e){return new Promise(function(n,r){function i(o){t.removeListener(e,a),r(o)}function a(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}ai(t,e,a,{once:!0}),e!=="error"&&function(o,l,c){typeof o.on=="function"&&ai(o,"error",l,c)}(t,i,{once:!0})})},W.EventEmitter=W,W.prototype._events=void 0,W.prototype._eventsCount=0,W.prototype._maxListeners=void 0;var ei=10;function un(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function rs(t){return t._maxListeners===void 0?W.defaultMaxListeners:t._maxListeners}function ti(t,e,n,r){var i,a,o,l;if(un(n),(a=t._events)===void 0?(a=t._events=Object.create(null),t._eventsCount=0):(a.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),a=t._events),o=a[e]),o===void 0)o=a[e]=n,++t._eventsCount;else if(typeof o=="function"?o=a[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=rs(t))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,l=c,console&&console.warn&&console.warn(l)}return t}function ho(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ni(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=ho.bind(r);return i.listener=n,r.wrapFn=i,i}function ri(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?function(a){for(var o=new Array(a.length),l=0;l<o.length;++l)o[l]=a[l].listener||a[l];return o}(i):is(i,i.length)}function ii(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}function is(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function ai(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else{if(typeof t.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,function i(a){r.once&&t.removeEventListener(e,i),n(a)})}}Object.defineProperty(W,"defaultMaxListeners",{enumerable:!0,get:function(){return ei},set:function(t){if(typeof t!="number"||t<0||Zr(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");ei=t}}),W.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},W.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Zr(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},W.prototype.getMaxListeners=function(){return rs(this)},W.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r=t==="error",i=this._events;if(i!==void 0)r=r&&i.error===void 0;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=i[t];if(l===void 0)return!1;if(typeof l=="function")Xr(l,this,e);else{var c=l.length,h=is(l,c);for(n=0;n<c;++n)Xr(h[n],this,e)}return!0},W.prototype.addListener=function(t,e){return ti(this,t,e,!1)},W.prototype.on=W.prototype.addListener,W.prototype.prependListener=function(t,e){return ti(this,t,e,!0)},W.prototype.once=function(t,e){return un(e),this.on(t,ni(this,t,e)),this},W.prototype.prependOnceListener=function(t,e){return un(e),this.prependListener(t,ni(this,t,e)),this},W.prototype.removeListener=function(t,e){var n,r,i,a,o;if(un(e),(r=this._events)===void 0)return this;if((n=r[t])===void 0)return this;if(n===e||n.listener===e)--this._eventsCount==0?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if(typeof n!="function"){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===e||n[a].listener===e){o=n[a].listener,i=a;break}if(i<0)return this;i===0?n.shift():function(l,c){for(;c+1<l.length;c++)l[c]=l[c+1];l.pop()}(n,i),n.length===1&&(r[t]=n[0]),r.removeListener!==void 0&&this.emit("removeListener",t,o||e)}return this},W.prototype.off=W.prototype.removeListener,W.prototype.removeAllListeners=function(t){var e,n,r;if((n=this._events)===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[t]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete n[t]),this;if(arguments.length===0){var i,a=Object.keys(n);for(r=0;r<a.length;++r)(i=a[r])!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(e=n[t])=="function")this.removeListener(t,e);else if(e!==void 0)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},W.prototype.listeners=function(t){return ri(this,t,!0)},W.prototype.rawListeners=function(t){return ri(this,t,!1)},W.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):ii.call(t,e)},W.prototype.listenerCount=ii,W.prototype.eventNames=function(){return this._eventsCount>0?ns(this._events):[]};var si=Object.prototype.hasOwnProperty;function oi(t,e,n){for(n of t.keys())if(le(n,e))return n}function le(t,e){var n,r,i;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&le(t[r],e[r]););return r===-1}if(n===Set){if(t.size!==e.size)return!1;for(r of t)if((i=r)&&typeof i=="object"&&!(i=oi(e,i))||!e.has(i))return!1;return!0}if(n===Map){if(t.size!==e.size)return!1;for(r of t)if((i=r[0])&&typeof i=="object"&&!(i=oi(e,i))||!le(r[1],e.get(i)))return!1;return!0}if(n===ArrayBuffer)t=new Uint8Array(t),e=new Uint8Array(e);else if(n===DataView){if((r=t.byteLength)===e.byteLength)for(;r--&&t.getInt8(r)===e.getInt8(r););return r===-1}if(ArrayBuffer.isView(t)){if((r=t.byteLength)===e.byteLength)for(;r--&&t[r]===e[r];);return r===-1}if(!n||typeof t=="object"){for(n in r=0,t)if(si.call(t,n)&&++r&&!si.call(e,n)||!(n in e)||!le(t[n],e[n]))return!1;return Object.keys(e).length===r}}return t!=t&&e!=e}const po={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},as={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},Z={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},ce={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},Fe={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class S{static getFirstMatch(e,n){const r=n.match(e);return r&&r.length>0&&r[1]||""}static getSecondMatch(e,n){const r=n.match(e);return r&&r.length>1&&r[2]||""}static matchAndReturnConst(e,n,r){if(e.test(n))return r}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const n=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(n.push(0),n[0]===10)switch(n[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const n=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(n.push(0),!(n[0]===1&&n[1]<5))return n[0]===1&&n[1]<6?"Cupcake":n[0]===1&&n[1]>=6?"Donut":n[0]===2&&n[1]<2?"Eclair":n[0]===2&&n[1]===2?"Froyo":n[0]===2&&n[1]>2?"Gingerbread":n[0]===3?"Honeycomb":n[0]===4&&n[1]<1?"Ice Cream Sandwich":n[0]===4&&n[1]<4?"Jelly Bean":n[0]===4&&n[1]>=4?"KitKat":n[0]===5?"Lollipop":n[0]===6?"Marshmallow":n[0]===7?"Nougat":n[0]===8?"Oreo":n[0]===9?"Pie":void 0}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,n,r=!1){const i=S.getVersionPrecision(e),a=S.getVersionPrecision(n);let o=Math.max(i,a),l=0;const c=S.map([e,n],h=>{const p=o-S.getVersionPrecision(h),g=h+new Array(p+1).join(".0");return S.map(g.split("."),_=>new Array(20-_.length).join("0")+_).reverse()});for(r&&(l=o-Math.min(i,a)),o-=1;o>=l;){if(c[0][o]>c[1][o])return 1;if(c[0][o]===c[1][o]){if(o===l)return 0;o-=1}else if(c[0][o]<c[1][o])return-1}}static map(e,n){const r=[];let i;if(Array.prototype.map)return Array.prototype.map.call(e,n);for(i=0;i<e.length;i+=1)r.push(n(e[i]));return r}static find(e,n){let r,i;if(Array.prototype.find)return Array.prototype.find.call(e,n);for(r=0,i=e.length;r<i;r+=1){const a=e[r];if(n(a,r))return a}}static assign(e,...n){const r=e;let i,a;if(Object.assign)return Object.assign(e,...n);for(i=0,a=n.length;i<a;i+=1){const o=n[i];typeof o=="object"&&o!==null&&Object.keys(o).forEach(l=>{r[l]=o[l]})}return e}static getBrowserAlias(e){return po[e]}static getBrowserTypeByAlias(e){return as[e]||""}}const G=/version\/(\d+(\.?_?\d+)+)/i,fo=[{test:[/googlebot/i],describe(t){const e={name:"Googlebot"},n=S.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/opera/i],describe(t){const e={name:"Opera"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opr\/|opios/i],describe(t){const e={name:"Opera"},n=S.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/SamsungBrowser/i],describe(t){const e={name:"Samsung Internet for Android"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Whale/i],describe(t){const e={name:"NAVER Whale Browser"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MZBrowser/i],describe(t){const e={name:"MZ Browser"},n=S.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/focus/i],describe(t){const e={name:"Focus"},n=S.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/swing/i],describe(t){const e={name:"Swing"},n=S.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/coast/i],describe(t){const e={name:"Opera Coast"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(t){const e={name:"Opera Touch"},n=S.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/yabrowser/i],describe(t){const e={name:"Yandex Browser"},n=S.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/ucbrowser/i],describe(t){const e={name:"UC Browser"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/Maxthon|mxios/i],describe(t){const e={name:"Maxthon"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/epiphany/i],describe(t){const e={name:"Epiphany"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/puffin/i],describe(t){const e={name:"Puffin"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sleipnir/i],describe(t){const e={name:"Sleipnir"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/k-meleon/i],describe(t){const e={name:"K-Meleon"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/micromessenger/i],describe(t){const e={name:"WeChat"},n=S.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/qqbrowser/i],describe(t){const e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},n=S.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/msie|trident/i],describe(t){const e={name:"Internet Explorer"},n=S.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/\sedg\//i],describe(t){const e={name:"Microsoft Edge"},n=S.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/edg([ea]|ios)/i],describe(t){const e={name:"Microsoft Edge"},n=S.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/vivaldi/i],describe(t){const e={name:"Vivaldi"},n=S.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/seamonkey/i],describe(t){const e={name:"SeaMonkey"},n=S.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/sailfish/i],describe(t){const e={name:"Sailfish"},n=S.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return n&&(e.version=n),e}},{test:[/silk/i],describe(t){const e={name:"Amazon Silk"},n=S.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/phantom/i],describe(t){const e={name:"PhantomJS"},n=S.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/slimerjs/i],describe(t){const e={name:"SlimerJS"},n=S.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e={name:"BlackBerry"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(web|hpw)[o0]s/i],describe(t){const e={name:"WebOS Browser"},n=S.getFirstMatch(G,t)||S.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/bada/i],describe(t){const e={name:"Bada"},n=S.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/tizen/i],describe(t){const e={name:"Tizen"},n=S.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/qupzilla/i],describe(t){const e={name:"QupZilla"},n=S.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/firefox|iceweasel|fxios/i],describe(t){const e={name:"Firefox"},n=S.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/electron/i],describe(t){const e={name:"Electron"},n=S.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/MiuiBrowser/i],describe(t){const e={name:"Miui"},n=S.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/chromium/i],describe(t){const e={name:"Chromium"},n=S.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/chrome|crios|crmo/i],describe(t){const e={name:"Chrome"},n=S.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/GSA/i],describe(t){const e={name:"Google Search"},n=S.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test(t){const e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe(t){const e={name:"Android Browser"},n=S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/playstation 4/i],describe(t){const e={name:"PlayStation 4"},n=S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/safari|applewebkit/i],describe(t){const e={name:"Safari"},n=S.getFirstMatch(G,t);return n&&(e.version=n),e}},{test:[/.*/i],describe(t){const e=t.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:S.getFirstMatch(e,t),version:S.getSecondMatch(e,t)}}}];var mo=[{test:[/Roku\/DVP/],describe(t){const e=S.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:ce.Roku,version:e}}},{test:[/windows phone/i],describe(t){const e=S.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:ce.WindowsPhone,version:e}}},{test:[/windows /i],describe(t){const e=S.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),n=S.getWindowsVersionName(e);return{name:ce.Windows,version:e,versionName:n}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(t){const e={name:ce.iOS},n=S.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return n&&(e.version=n),e}},{test:[/macintosh/i],describe(t){const e=S.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),n=S.getMacOSVersionName(e),r={name:ce.MacOS,version:e};return n&&(r.versionName=n),r}},{test:[/(ipod|iphone|ipad)/i],describe(t){const e=S.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:ce.iOS,version:e}}},{test(t){const e=!t.test(/like android/i),n=t.test(/android/i);return e&&n},describe(t){const e=S.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),n=S.getAndroidVersionName(e),r={name:ce.Android,version:e};return n&&(r.versionName=n),r}},{test:[/(web|hpw)[o0]s/i],describe(t){const e=S.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),n={name:ce.WebOS};return e&&e.length&&(n.version=e),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(t){const e=S.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||S.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||S.getFirstMatch(/\bbb(\d+)/i,t);return{name:ce.BlackBerry,version:e}}},{test:[/bada/i],describe(t){const e=S.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:ce.Bada,version:e}}},{test:[/tizen/i],describe(t){const e=S.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:ce.Tizen,version:e}}},{test:[/linux/i],describe:()=>({name:ce.Linux})},{test:[/CrOS/],describe:()=>({name:ce.ChromeOS})},{test:[/PlayStation 4/],describe(t){const e=S.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:ce.PlayStation4,version:e}}}],go=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(t){const e=S.getFirstMatch(/(can-l01)/i,t)&&"Nova",n={type:Z.mobile,vendor:"Huawei"};return e&&(n.model=e),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:Z.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:Z.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:Z.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:Z.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:Z.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:Z.tablet})},{test(t){const e=t.test(/ipod|iphone/i),n=t.test(/like (ipod|iphone)/i);return e&&!n},describe(t){const e=S.getFirstMatch(/(ipod|iphone)/i,t);return{type:Z.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:Z.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:Z.mobile})},{test:t=>t.getBrowserName(!0)==="blackberry",describe:()=>({type:Z.mobile,vendor:"BlackBerry"})},{test:t=>t.getBrowserName(!0)==="bada",describe:()=>({type:Z.mobile})},{test:t=>t.getBrowserName()==="windows phone",describe:()=>({type:Z.mobile,vendor:"Microsoft"})},{test(t){const e=Number(String(t.getOSVersion()).split(".")[0]);return t.getOSName(!0)==="android"&&e>=3},describe:()=>({type:Z.tablet})},{test:t=>t.getOSName(!0)==="android",describe:()=>({type:Z.mobile})},{test:t=>t.getOSName(!0)==="macos",describe:()=>({type:Z.desktop,vendor:"Apple"})},{test:t=>t.getOSName(!0)==="windows",describe:()=>({type:Z.desktop})},{test:t=>t.getOSName(!0)==="linux",describe:()=>({type:Z.desktop})},{test:t=>t.getOSName(!0)==="playstation 4",describe:()=>({type:Z.tv})},{test:t=>t.getOSName(!0)==="roku",describe:()=>({type:Z.tv})}],vo=[{test:t=>t.getBrowserName(!0)==="microsoft edge",describe(t){if(/\sedg\//i.test(t))return{name:Fe.Blink};const e=S.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:Fe.EdgeHTML,version:e}}},{test:[/trident/i],describe(t){const e={name:Fe.Trident},n=S.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:t=>t.test(/presto/i),describe(t){const e={name:Fe.Presto},n=S.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test(t){const e=t.test(/gecko/i),n=t.test(/like gecko/i);return e&&!n},describe(t){const e={name:Fe.Gecko},n=S.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:Fe.Blink})},{test:[/(apple)?webkit/i],describe(t){const e={name:Fe.WebKit},n=S.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return n&&(e.version=n),e}}];class ci{constructor(e,n=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},n!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=S.find(fo,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=S.find(mo,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:n}=this.getOS();return e?String(n).toLowerCase()||"":n||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:n}=this.getPlatform();return e?String(n).toLowerCase()||"":n||""}parsePlatform(){this.parsedResult.platform={};const e=S.find(go,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=S.find(vo,n=>{if(typeof n.test=="function")return n.test(this);if(n.test instanceof Array)return n.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return S.assign({},this.parsedResult)}satisfies(e){const n={};let r=0;const i={};let a=0;if(Object.keys(e).forEach(o=>{const l=e[o];typeof l=="string"?(i[o]=l,a+=1):typeof l=="object"&&(n[o]=l,r+=1)}),r>0){const o=Object.keys(n),l=S.find(o,h=>this.isOS(h));if(l){const h=this.satisfies(n[l]);if(h!==void 0)return h}const c=S.find(o,h=>this.isPlatform(h));if(c){const h=this.satisfies(n[c]);if(h!==void 0)return h}}if(a>0){const o=Object.keys(i),l=S.find(o,c=>this.isBrowser(c,!0));if(l!==void 0)return this.compareVersion(i[l])}}isBrowser(e,n=!1){const r=this.getBrowserName().toLowerCase();let i=e.toLowerCase();const a=S.getBrowserTypeByAlias(i);return n&&a&&(i=a.toLowerCase()),i===r}compareVersion(e){let n=[0],r=e,i=!1;const a=this.getBrowserVersion();if(typeof a=="string")return e[0]===">"||e[0]==="<"?(r=e.substr(1),e[1]==="="?(i=!0,r=e.substr(2)):n=[],e[0]===">"?n.push(1):n.push(-1)):e[0]==="="?r=e.substr(1):e[0]==="~"&&(i=!0,r=e.substr(1)),n.indexOf(S.compareVersions(a,r,i))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,n=!1){return this.isBrowser(e,n)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(n=>this.is(n))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class yo{static getParser(e,n=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new ci(e,n)}static parse(e){return new ci(e).getResult()}static get BROWSER_MAP(){return as}static get ENGINE_MAP(){return Fe}static get OS_MAP(){return ce}static get PLATFORMS_MAP(){return Z}}function Mn(){return Date.now()+Math.random().toString()}function Dt(){throw new Error("Method must be implemented in subclass")}function ss(t,e){return e!=null&&e.proxyUrl?e.proxyUrl+(e.proxyUrl.slice(-1)==="/"?"":"/")+t.substring(8):t}function mn(t){return t!=null&&t.callObjectBundleUrlOverride?t.callObjectBundleUrlOverride:ss("https://c.daily.co/call-machine/versioned/".concat("0.73.0","/static/call-machine-object-bundle.js"),t)}function gn(t){try{new URL(t)}catch{return!1}return!0}const os=Object.prototype.toString;function Er(t){switch(os.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return dt(t,Error)}}function Ot(t,e){return os.call(t)===`[object ${e}]`}function cs(t){return Ot(t,"ErrorEvent")}function li(t){return Ot(t,"DOMError")}function Ie(t){return Ot(t,"String")}function Mr(t){return typeof t=="object"&&t!==null&&"__sentry_template_string__"in t&&"__sentry_template_values__"in t}function tr(t){return t===null||Mr(t)||typeof t!="object"&&typeof t!="function"}function kt(t){return Ot(t,"Object")}function Tn(t){return typeof Event<"u"&&dt(t,Event)}function On(t){return!!(t&&t.then&&typeof t.then=="function")}function dt(t,e){try{return t instanceof e}catch{return!1}}function ls(t){return!(typeof t!="object"||t===null||!t.__isVue&&!t._isVue)}function St(t,e=0){return typeof t!="string"||e===0||t.length<=e?t:`${t.slice(0,e)}...`}function ui(t,e){if(!Array.isArray(t))return"";const n=[];for(let r=0;r<t.length;r++){const i=t[r];try{ls(i)?n.push("[VueViewModel]"):n.push(String(i))}catch{n.push("[value cannot be serialized]")}}return n.join(e)}function _o(t,e,n=!1){return!!Ie(t)&&(Ot(e,"RegExp")?e.test(t):!!Ie(e)&&(n?t===e:t.includes(e)))}function Kt(t,e=[],n=!1){return e.some(r=>_o(t,r,n))}function bo(t,e,n=250,r,i,a,o){if(!(a.exception&&a.exception.values&&o&&dt(o.originalException,Error)))return;const l=a.exception.values.length>0?a.exception.values[a.exception.values.length-1]:void 0;var c,h;l&&(a.exception.values=(c=nr(t,e,i,o.originalException,r,a.exception.values,l,0),h=n,c.map(p=>(p.value&&(p.value=St(p.value,h)),p))))}function nr(t,e,n,r,i,a,o,l){if(a.length>=n+1)return a;let c=[...a];if(dt(r[i],Error)){di(o,l);const h=t(e,r[i]),p=c.length;hi(h,i,p,l),c=nr(t,e,n,r[i],i,[h,...c],h,p)}return Array.isArray(r.errors)&&r.errors.forEach((h,p)=>{if(dt(h,Error)){di(o,l);const g=t(e,h),_=c.length;hi(g,`errors[${p}]`,_,l),c=nr(t,e,n,h,i,[g,...c],g,_)}}),c}function di(t,e){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,...t.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function hi(t,e,n,r){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,type:"chained",source:e,exception_id:n,parent_id:r}}function pi(t){return t===void 0?void 0:t>=400&&t<500?"warning":t>=500?"error":void 0}const lt="8.33.1",V=globalThis;function vn(t,e,n){const r=V,i=r.__SENTRY__=r.__SENTRY__||{},a=i[lt]=i[lt]||{};return a[t]||(a[t]=e())}const Tr=V;function us(t,e={}){if(!t)return"<unknown>";try{let n=t;const r=5,i=[];let a=0,o=0;const l=" > ",c=l.length;let h;const p=Array.isArray(e)?e:e.keyAttrs,g=!Array.isArray(e)&&e.maxStringLength||80;for(;n&&a++<r&&(h=So(n,p),!(h==="html"||a>1&&o+i.length*c+h.length>=g));)i.push(h),o+=h.length,n=n.parentNode;return i.reverse().join(l)}catch{return"<unknown>"}}function So(t,e){const n=t,r=[];if(!n||!n.tagName)return"";if(Tr.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const i=e&&e.length?e.filter(o=>n.getAttribute(o)).map(o=>[o,n.getAttribute(o)]):null;if(i&&i.length)i.forEach(o=>{r.push(`[${o[0]}="${o[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const o=n.className;if(o&&Ie(o)){const l=o.split(/\s+/);for(const c of l)r.push(`.${c}`)}}const a=["aria-label","type","name","title","alt"];for(const o of a){const l=n.getAttribute(o);l&&r.push(`[${o}="${l}"]`)}return r.join("")}const Vt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,rr=["debug","info","warn","error","log","assert","trace"],yn={};function Or(t){if(!("console"in V))return t();const e=V.console,n={},r=Object.keys(yn);r.forEach(i=>{const a=yn[i];n[i]=e[i],e[i]=a});try{return t()}finally{r.forEach(i=>{e[i]=n[i]})}}const B=vn("logger",function(){let t=!1;const e={enable:()=>{t=!0},disable:()=>{t=!1},isEnabled:()=>t};return Vt?rr.forEach(n=>{e[n]=(...r)=>{t&&Or(()=>{V.console[n](`Sentry Logger [${n}]:`,...r)})}}):rr.forEach(n=>{e[n]=()=>{}}),e}),wo=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function _n(t,e=!1){const{host:n,path:r,pass:i,port:a,projectId:o,protocol:l,publicKey:c}=t;return`${l}://${c}${e&&i?`:${i}`:""}@${n}${a?`:${a}`:""}/${r&&`${r}/`}${o}`}function fi(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function ko(t){const e=typeof t=="string"?function(n){const r=wo.exec(n);if(!r)return void Or(()=>{console.error(`Invalid Sentry Dsn: ${n}`)});const[i,a,o="",l="",c="",h=""]=r.slice(1);let p="",g=h;const _=g.split("/");if(_.length>1&&(p=_.slice(0,-1).join("/"),g=_.pop()),g){const C=g.match(/^\d+/);C&&(g=C[0])}return fi({host:l,pass:o,path:p,projectId:g,port:c,protocol:i,publicKey:a})}(t):fi(t);if(e&&function(n){if(!Vt)return!0;const{port:r,projectId:i,protocol:a}=n;return!(["protocol","publicKey","host","projectId"].find(o=>!n[o]&&(B.error(`Invalid Sentry Dsn: ${o} missing`),!0))||(i.match(/^\d+$/)?function(o){return o==="http"||o==="https"}(a)?r&&isNaN(parseInt(r,10))&&(B.error(`Invalid Sentry Dsn: Invalid port ${r}`),1):(B.error(`Invalid Sentry Dsn: Invalid protocol ${a}`),1):(B.error(`Invalid Sentry Dsn: Invalid projectId ${i}`),1)))}(e))return e}class Ee extends Error{constructor(e,n="warn"){super(e),this.message=e,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=n}}function he(t,e,n){if(!(e in t))return;const r=t[e],i=n(r);typeof i=="function"&&ds(i,r),t[e]=i}function ht(t,e,n){try{Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0})}catch{Vt&&B.log(`Failed to add non-enumerable property "${e}" to object`,t)}}function ds(t,e){try{const n=e.prototype||{};t.prototype=e.prototype=n,ht(t,"__sentry_original__",e)}catch{}}function Ar(t){return t.__sentry_original__}function hs(t){if(Er(t))return{message:t.message,name:t.name,stack:t.stack,...gi(t)};if(Tn(t)){const e={type:t.type,target:mi(t.target),currentTarget:mi(t.currentTarget),...gi(t)};return typeof CustomEvent<"u"&&dt(t,CustomEvent)&&(e.detail=t.detail),e}return t}function mi(t){try{return e=t,typeof Element<"u"&&dt(e,Element)?us(t):Object.prototype.toString.call(t)}catch{return"<unknown>"}var e}function gi(t){if(typeof t=="object"&&t!==null){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}return{}}function ye(t){return ir(t,new Map)}function ir(t,e){if(function(n){if(!kt(n))return!1;try{const r=Object.getPrototypeOf(n).constructor.name;return!r||r==="Object"}catch{return!0}}(t)){const n=e.get(t);if(n!==void 0)return n;const r={};e.set(t,r);for(const i of Object.getOwnPropertyNames(t))t[i]!==void 0&&(r[i]=ir(t[i],e));return r}if(Array.isArray(t)){const n=e.get(t);if(n!==void 0)return n;const r=[];return e.set(t,r),t.forEach(i=>{r.push(ir(i,e))}),r}return t}const st="?",vi=/\(error: (.*)\)/,yi=/captureMessage|captureException/;function Yt(t){return t[t.length-1]||{}}const _i="<anonymous>";function ze(t){try{return t&&typeof t=="function"&&t.name||_i}catch{return _i}}function bi(t){const e=t.exception;if(e){const n=[];try{return e.values.forEach(r=>{r.stacktrace.frames&&n.push(...r.stacktrace.frames)}),n}catch{return}}}const dn={},Si={};function ot(t,e){dn[t]=dn[t]||[],dn[t].push(e)}function ct(t,e){Si[t]||(e(),Si[t]=!0)}function _e(t,e){const n=t&&dn[t];if(n)for(const r of n)try{r(e)}catch(i){Vt&&B.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${ze(r)}
Error:`,i)}}function Co(){"console"in V&&rr.forEach(function(t){t in V.console&&he(V.console,t,function(e){return yn[t]=e,function(...n){_e("console",{args:n,level:t});const r=yn[t];r&&r.apply(V.console,n)}})})}const Bn=V;function ar(t){return t&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}function Eo(){if(typeof EdgeRuntime=="string")return!0;if(!function(){if(!("fetch"in Bn))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}())return!1;if(ar(Bn.fetch))return!0;let t=!1;const e=Bn.document;if(e&&typeof e.createElement=="function")try{const n=e.createElement("iframe");n.hidden=!0,e.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(t=ar(n.contentWindow.fetch)),e.head.removeChild(n)}catch(n){Vt&&B.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",n)}return t}function Wt(){return Date.now()/1e3}const We=function(){const{performance:t}=V;if(!t||!t.now)return Wt;const e=Date.now()-t.now(),n=t.timeOrigin==null?e:t.timeOrigin;return()=>(n+t.now())/1e3}();function Mo(t,e){const n="fetch";ot(n,t),ct(n,()=>function(r,i=!1){i&&!Eo()||he(V,"fetch",function(a){return function(...o){const{method:l,url:c}=function(g){if(g.length===0)return{method:"GET",url:""};if(g.length===2){const[C,v]=g;return{url:wi(C),method:sr(v,"method")?String(v.method).toUpperCase():"GET"}}const _=g[0];return{url:wi(_),method:sr(_,"method")?String(_.method).toUpperCase():"GET"}}(o),h={args:o,fetchData:{method:l,url:c},startTimestamp:1e3*We()};_e("fetch",{...h});const p=new Error().stack;return a.apply(V,o).then(async g=>(_e("fetch",{...h,endTimestamp:1e3*We(),response:g}),g),g=>{throw _e("fetch",{...h,endTimestamp:1e3*We(),error:g}),Er(g)&&g.stack===void 0&&(g.stack=p,ht(g,"framesToPop",1)),g})}})}(void 0,e))}function sr(t,e){return!!t&&typeof t=="object"&&!!t[e]}function wi(t){return typeof t=="string"?t:t?sr(t,"url")?t.url:t.toString?t.toString():"":""}(()=>{const{performance:t}=V;if(!t||!t.now)return;const e=36e5,n=t.now(),r=Date.now(),i=t.timeOrigin?Math.abs(t.timeOrigin+n-r):e,a=i<e,o=t.timing&&t.timing.navigationStart,l=typeof o=="number"?Math.abs(o+n-r):e;(a||l<e)&&i<=l&&t.timeOrigin})();let Xt=null;function To(){Xt=V.onerror,V.onerror=function(t,e,n,r,i){return _e("error",{column:r,error:i,line:n,msg:t,url:e}),!(!Xt||Xt.__SENTRY_LOADER__)&&Xt.apply(this,arguments)},V.onerror.__SENTRY_INSTRUMENTED__=!0}let Zt=null;function Oo(){Zt=V.onunhandledrejection,V.onunhandledrejection=function(t){return _e("unhandledrejection",t),!(Zt&&!Zt.__SENTRY_LOADER__)||Zt.apply(this,arguments)},V.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function be(){const t=V,e=t.crypto||t.msCrypto;let n=()=>16*Math.random();try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(n=()=>{const r=new Uint8Array(1);return e.getRandomValues(r),r[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,r=>(r^(15&n())>>r/4).toString(16))}function ps(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function Ue(t){const{message:e,event_id:n}=t;if(e)return e;const r=ps(t);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function or(t,e,n){const r=t.exception=t.exception||{},i=r.values=r.values||[],a=i[0]=i[0]||{};a.value||(a.value=e||""),a.type||(a.type="Error")}function $t(t,e){const n=ps(t);if(!n)return;const r=n.mechanism;if(n.mechanism={type:"generic",handled:!0,...r,...e},e&&"data"in e){const i={...r&&r.data,...e.data};n.mechanism.data=i}}function ki(t){if(t&&t.__sentry_captured__)return!0;try{ht(t,"__sentry_captured__",!0)}catch{}return!1}function $e(t,e=100,n=1/0){try{return cr("",t,e,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function fs(t,e=3,n=102400){const r=$e(t,e);return i=r,function(a){return~-encodeURI(a).split(/%..|./).length}(JSON.stringify(i))>n?fs(t,e-1,n):r;var i}function cr(t,e,n=1/0,r=1/0,i=function(){const a=typeof WeakSet=="function",o=a?new WeakSet:[];return[function(l){if(a)return!!o.has(l)||(o.add(l),!1);for(let c=0;c<o.length;c++)if(o[c]===l)return!0;return o.push(l),!1},function(l){if(a)o.delete(l);else for(let c=0;c<o.length;c++)if(o[c]===l){o.splice(c,1);break}}]}()){const[a,o]=i;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const l=function(C,v){try{if(C==="domain"&&v&&typeof v=="object"&&v._events)return"[Domain]";if(C==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&v===global)return"[Global]";if(typeof window<"u"&&v===window)return"[Window]";if(typeof document<"u"&&v===document)return"[Document]";if(ls(v))return"[VueViewModel]";if(kt(w=v)&&"nativeEvent"in w&&"preventDefault"in w&&"stopPropagation"in w)return"[SyntheticEvent]";if(typeof v=="number"&&!Number.isFinite(v))return`[${v}]`;if(typeof v=="function")return`[Function: ${ze(v)}]`;if(typeof v=="symbol")return`[${String(v)}]`;if(typeof v=="bigint")return`[BigInt: ${String(v)}]`;const O=function(A){const x=Object.getPrototypeOf(A);return x?x.constructor.name:"null prototype"}(v);return/^HTML(\w*)Element$/.test(O)?`[HTMLElement: ${O}]`:`[object ${O}]`}catch(O){return`**non-serializable** (${O})`}var w}(t,e);if(!l.startsWith("[object "))return l;if(e.__sentry_skip_normalization__)return e;const c=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:n;if(c===0)return l.replace("object ","");if(a(e))return"[Circular ~]";const h=e;if(h&&typeof h.toJSON=="function")try{return cr("",h.toJSON(),c-1,r,i)}catch{}const p=Array.isArray(e)?[]:{};let g=0;const _=hs(e);for(const C in _){if(!Object.prototype.hasOwnProperty.call(_,C))continue;if(g>=r){p[C]="[MaxProperties ~]";break}const v=_[C];p[C]=cr(C,v,c-1,r,i),g++}return o(e),p}var xe;function pt(t){return new pe(e=>{e(t)})}function bn(t){return new pe((e,n)=>{n(t)})}(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(xe||(xe={}));class pe{constructor(e){pe.prototype.__init.call(this),pe.prototype.__init2.call(this),pe.prototype.__init3.call(this),pe.prototype.__init4.call(this),this._state=xe.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(n){this._reject(n)}}then(e,n){return new pe((r,i)=>{this._handlers.push([!1,a=>{if(e)try{r(e(a))}catch(o){i(o)}else r(a)},a=>{if(n)try{r(n(a))}catch(o){i(o)}else i(a)}]),this._executeHandlers()})}catch(e){return this.then(n=>n,e)}finally(e){return new pe((n,r)=>{let i,a;return this.then(o=>{a=!1,i=o,e&&e()},o=>{a=!0,i=o,e&&e()}).then(()=>{a?r(i):n(i)})})}__init(){this._resolve=e=>{this._setResult(xe.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(xe.REJECTED,e)}}__init3(){this._setResult=(e,n)=>{this._state===xe.PENDING&&(On(n)?n.then(this._resolve,this._reject):(this._state=e,this._value=n,this._executeHandlers()))}}__init4(){this._executeHandlers=()=>{if(this._state===xe.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(n=>{n[0]||(this._state===xe.RESOLVED&&n[1](this._value),this._state===xe.REJECTED&&n[2](this._value),n[0]=!0)})}}}function Ao(t){const e=[];function n(r){return e.splice(e.indexOf(r),1)[0]||Promise.resolve(void 0)}return{$:e,add:function(r){if(!(t===void 0||e.length<t))return bn(new Ee("Not adding Promise because buffer limit was reached."));const i=r();return e.indexOf(i)===-1&&e.push(i),i.then(()=>n(i)).then(null,()=>n(i).then(null,()=>{})),i},drain:function(r){return new pe((i,a)=>{let o=e.length;if(!o)return i(!0);const l=setTimeout(()=>{r&&r>0&&i(!1)},r);e.forEach(c=>{pt(c).then(()=>{--o||(clearTimeout(l),i(!0))},a)})})}}}function Fn(t){if(!t)return{};const e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const n=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:n,hash:r,relative:e[5]+n+r}}const Po=["fatal","error","warning","log","info","debug"];function Lo(t){return t==="warn"?"warning":Po.includes(t)?t:"log"}const xo=/^sentry-/;function jo(t){const e=function(r){if(!(!r||!Ie(r)&&!Array.isArray(r)))return Array.isArray(r)?r.reduce((i,a)=>{const o=Ci(a);return Object.entries(o).forEach(([l,c])=>{i[l]=c}),i},{}):Ci(r)}(t);if(!e)return;const n=Object.entries(e).reduce((r,[i,a])=>(i.match(xo)&&(r[i.slice(7)]=a),r),{});return Object.keys(n).length>0?n:void 0}function Ci(t){return t.split(",").map(e=>e.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((e,[n,r])=>(n&&r&&(e[n]=r),e),{})}function Jt(t,e=[]){return[t,e]}function Do(t,e){const[n,r]=t;return[n,[...r,e]]}function Ei(t,e){const n=t[1];for(const r of n)if(e(r,r[0].type))return!0;return!1}function lr(t){return V.__SENTRY__&&V.__SENTRY__.encodePolyfill?V.__SENTRY__.encodePolyfill(t):new TextEncoder().encode(t)}function Io(t){const[e,n]=t;let r=JSON.stringify(e);function i(a){typeof r=="string"?r=typeof a=="string"?r+a:[lr(r),a]:r.push(typeof a=="string"?lr(a):a)}for(const a of n){const[o,l]=a;if(i(`
${JSON.stringify(o)}
`),typeof l=="string"||l instanceof Uint8Array)i(l);else{let c;try{c=JSON.stringify(l)}catch{c=JSON.stringify($e(l))}i(c)}}return typeof r=="string"?r:function(a){const o=a.reduce((h,p)=>h+p.length,0),l=new Uint8Array(o);let c=0;for(const h of a)l.set(h,c),c+=h.length;return l}(r)}function No(t){const e=typeof t.data=="string"?lr(t.data):t.data;return[ye({type:"attachment",length:e.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),e]}const Ro={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket"};function Mi(t){return Ro[t]}function ms(t){if(!t||!t.sdk)return;const{name:e,version:n}=t.sdk;return{name:e,version:n}}function Bo(t,{statusCode:e,headers:n},r=Date.now()){const i={...t},a=n&&n["x-sentry-rate-limits"],o=n&&n["retry-after"];if(a)for(const l of a.trim().split(",")){const[c,h,,,p]=l.split(":",5),g=parseInt(c,10),_=1e3*(isNaN(g)?60:g);if(h)for(const C of h.split(";"))C==="metric_bucket"&&p&&!p.split(";").includes("custom")||(i[C]=r+_);else i.all=r+_}else o?i.all=r+function(l,c=Date.now()){const h=parseInt(`${l}`,10);if(!isNaN(h))return 1e3*h;const p=Date.parse(`${l}`);return isNaN(p)?6e4:p-c}(o,r):e===429&&(i.all=r+6e4);return i}function Ti(){return{traceId:be(),spanId:be().substring(16)}}const en=V,K=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function An(){return Pr(V),V}function Pr(t){const e=t.__SENTRY__=t.__SENTRY__||{};return e.version=e.version||lt,e[lt]=e[lt]||{}}function ur(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),t.did||e.did||(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||We(),e.abnormal_mechanism&&(t.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=e.sid.length===32?e.sid:be()),e.init!==void 0&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),typeof e.started=="number"&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if(typeof e.duration=="number")t.duration=e.duration;else{const n=t.timestamp-t.started;t.duration=n>=0?n:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),typeof e.errors=="number"&&(t.errors=e.errors),e.status&&(t.status=e.status)}const dr="_sentrySpan";function Oi(t,e){e?ht(t,dr,e):delete t[dr]}function Ai(t){return t[dr]}class Lr{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=Ti()}clone(){const e=new Lr;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,Oi(e,Ai(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&ur(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,n){return this._tags={...this._tags,[e]:n},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,n){return this._extra={...this._extra,[e]:n},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,n){return n===null?delete this._contexts[e]:this._contexts[e]=n,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const n=typeof e=="function"?e(this):e,[r,i]=n instanceof Ge?[n.getScopeData(),n.getRequestSession()]:kt(n)?[e,e.requestSession]:[],{tags:a,extra:o,user:l,contexts:c,level:h,fingerprint:p=[],propagationContext:g}=r||{};return this._tags={...this._tags,...a},this._extra={...this._extra,...o},this._contexts={...this._contexts,...c},l&&Object.keys(l).length&&(this._user=l),h&&(this._level=h),p.length&&(this._fingerprint=p),g&&(this._propagationContext=g),i&&(this._requestSession=i),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,Oi(this,void 0),this._attachments=[],this._propagationContext=Ti(),this._notifyScopeListeners(),this}addBreadcrumb(e,n){const r=typeof n=="number"?n:100;if(r<=0)return this;const i={timestamp:Wt(),...e},a=this._breadcrumbs;return a.push(i),this._breadcrumbs=a.length>r?a.slice(-r):a,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Ai(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...e},this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,n){const r=n&&n.event_id?n.event_id:be();if(!this._client)return B.warn("No client configured on scope - will not capture exception!"),r;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...n,event_id:r},this),r}captureMessage(e,n,r){const i=r&&r.event_id?r.event_id:be();if(!this._client)return B.warn("No client configured on scope - will not capture message!"),i;const a=new Error(e);return this._client.captureMessage(e,n,{originalException:e,syntheticException:a,...r,event_id:i},this),i}captureEvent(e,n){const r=n&&n.event_id?n.event_id:be();return this._client?(this._client.captureEvent(e,{...n,event_id:r},this),r):(B.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const Ge=Lr;class Fo{constructor(e,n){let r,i;r=e||new Ge,i=n||new Ge,this._stack=[{scope:r}],this._isolationScope=i}withScope(e){const n=this._pushScope();let r;try{r=e(n)}catch(i){throw this._popScope(),i}return On(r)?r.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function Ct(){const t=Pr(An());return t.stack=t.stack||new Fo(vn("defaultCurrentScope",()=>new Ge),vn("defaultIsolationScope",()=>new Ge))}function Uo(t){return Ct().withScope(t)}function $o(t,e){const n=Ct();return n.withScope(()=>(n.getStackTop().scope=t,e(t)))}function Pi(t){return Ct().withScope(()=>t(Ct().getIsolationScope()))}function xr(t){const e=Pr(t);return e.acs?e.acs:{withIsolationScope:Pi,withScope:Uo,withSetScope:$o,withSetIsolationScope:(n,r)=>Pi(r),getCurrentScope:()=>Ct().getScope(),getIsolationScope:()=>Ct().getIsolationScope()}}function jr(){return xr(An()).getCurrentScope()}function gs(){return xr(An()).getIsolationScope()}function ue(){return jr().getClient()}function Jo(t){const e=t._sentryMetrics;if(!e)return;const n={};for(const[,[r,i]]of e)(n[r]||(n[r]=[])).push(ye(i));return n}function qo(t){const{spanId:e,traceId:n}=t.spanContext(),{parent_span_id:r}=Sn(t);return ye({parent_span_id:r,span_id:e,trace_id:n})}function Li(t){return typeof t=="number"?xi(t):Array.isArray(t)?t[0]+t[1]/1e9:t instanceof Date?xi(t.getTime()):We()}function xi(t){return t>9999999999?t/1e3:t}function Sn(t){if(function(e){return typeof e.getSpanJSON=="function"}(t))return t.getSpanJSON();try{const{spanId:e,traceId:n}=t.spanContext();if(function(r){const i=r;return!!(i.attributes&&i.startTime&&i.name&&i.endTime&&i.status)}(t)){const{attributes:r,startTime:i,name:a,endTime:o,parentSpanId:l,status:c}=t;return ye({span_id:e,trace_id:n,data:r,description:a,parent_span_id:l,start_timestamp:Li(i),timestamp:Li(o)||void 0,status:Vo(c),op:r["sentry.op"],origin:r["sentry.origin"],_metrics_summary:Jo(t)})}return{span_id:e,trace_id:n}}catch{return{}}}function Vo(t){if(t&&t.code!==0)return t.code===1?"ok":t.message||"unknown_error"}function vs(t){return t._sentryRootSpan||t}const ys="production";function _s(t,e){const n=e.getOptions(),{publicKey:r}=e.getDsn()||{},i=ye({environment:n.environment||ys,release:n.release,public_key:r,trace_id:t});return e.emit("createDsc",i),i}function Wo(t){const e=ue();if(!e)return{};const n=_s(Sn(t).trace_id||"",e),r=vs(t),i=r._frozenDsc;if(i)return i;const a=r.spanContext().traceState,o=a&&a.get("sentry.dsc"),l=o&&jo(o);if(l)return l;const c=Sn(r),h=c.data||{},p=h["sentry.sample_rate"];p!=null&&(n.sample_rate=`${p}`);const g=h["sentry.source"],_=c.description;return g!=="url"&&_&&(n.transaction=_),function(C){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const v=ue(),w=v&&v.getOptions();return!!w&&(w.enableTracing||"tracesSampleRate"in w||"tracesSampler"in w)}()&&(n.sampled=String(function(C){const{traceFlags:v}=C.spanContext();return v===1}(r))),e.emit("createDsc",n,r),n}function zo(t,e,n,r){const i=ms(n),a=t.type&&t.type!=="replay_event"?t.type:"event";(function(l,c){c&&(l.sdk=l.sdk||{},l.sdk.name=l.sdk.name||c.name,l.sdk.version=l.sdk.version||c.version,l.sdk.integrations=[...l.sdk.integrations||[],...c.integrations||[]],l.sdk.packages=[...l.sdk.packages||[],...c.packages||[]])})(t,n&&n.sdk);const o=function(l,c,h,p){const g=l.sdkProcessingMetadata&&l.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:l.event_id,sent_at:new Date().toISOString(),...c&&{sdk:c},...!!h&&p&&{dsn:_n(p)},...g&&{trace:ye({...g})}}}(t,i,r,e);return delete t.sdkProcessingMetadata,Jt(o,[[{type:a},t]])}function hr(t,e,n,r=0){return new pe((i,a)=>{const o=t[r];if(e===null||typeof o!="function")i(e);else{const l=o({...e},n);K&&o.id&&l===null&&B.log(`Event processor "${o.id}" dropped event`),On(l)?l.then(c=>hr(t,c,n,r+1).then(i)).then(null,a):hr(t,l,n,r+1).then(i).then(null,a)}})}function Go(t,e){const{fingerprint:n,span:r,breadcrumbs:i,sdkProcessingMetadata:a}=e;(function(o,l){const{extra:c,tags:h,user:p,contexts:g,level:_,transactionName:C}=l,v=ye(c);v&&Object.keys(v).length&&(o.extra={...v,...o.extra});const w=ye(h);w&&Object.keys(w).length&&(o.tags={...w,...o.tags});const O=ye(p);O&&Object.keys(O).length&&(o.user={...O,...o.user});const A=ye(g);A&&Object.keys(A).length&&(o.contexts={...A,...o.contexts}),_&&(o.level=_),C&&o.type!=="transaction"&&(o.transaction=C)})(t,e),r&&function(o,l){o.contexts={trace:qo(l),...o.contexts},o.sdkProcessingMetadata={dynamicSamplingContext:Wo(l),...o.sdkProcessingMetadata};const c=vs(l),h=Sn(c).description;h&&!o.transaction&&o.type==="transaction"&&(o.transaction=h)}(t,r),function(o,l){o.fingerprint=o.fingerprint?function(c){return Array.isArray(c)?c:[c]}(o.fingerprint):[],l&&(o.fingerprint=o.fingerprint.concat(l)),o.fingerprint&&!o.fingerprint.length&&delete o.fingerprint}(t,n),function(o,l){const c=[...o.breadcrumbs||[],...l];o.breadcrumbs=c.length?c:void 0}(t,i),function(o,l){o.sdkProcessingMetadata={...o.sdkProcessingMetadata,...l}}(t,a)}function ji(t,e){const{extra:n,tags:r,user:i,contexts:a,level:o,sdkProcessingMetadata:l,breadcrumbs:c,fingerprint:h,eventProcessors:p,attachments:g,propagationContext:_,transactionName:C,span:v}=e;It(t,"extra",n),It(t,"tags",r),It(t,"user",i),It(t,"contexts",a),It(t,"sdkProcessingMetadata",l),o&&(t.level=o),C&&(t.transactionName=C),v&&(t.span=v),c.length&&(t.breadcrumbs=[...t.breadcrumbs,...c]),h.length&&(t.fingerprint=[...t.fingerprint,...h]),p.length&&(t.eventProcessors=[...t.eventProcessors,...p]),g.length&&(t.attachments=[...t.attachments,...g]),t.propagationContext={...t.propagationContext,..._}}function It(t,e,n){if(n&&Object.keys(n).length){t[e]={...t[e]};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[e][r]=n[r])}}function Ho(t,e,n,r,i,a){const{normalizeDepth:o=3,normalizeMaxBreadth:l=1e3}=t,c={...e,event_id:e.event_id||n.event_id||be(),timestamp:e.timestamp||Wt()},h=n.integrations||t.integrations.map(v=>v.name);(function(v,w){const{environment:O,release:A,dist:x,maxValueLength:N=250}=w;"environment"in v||(v.environment="environment"in w?O:ys),v.release===void 0&&A!==void 0&&(v.release=A),v.dist===void 0&&x!==void 0&&(v.dist=x),v.message&&(v.message=St(v.message,N));const k=v.exception&&v.exception.values&&v.exception.values[0];k&&k.value&&(k.value=St(k.value,N));const b=v.request;b&&b.url&&(b.url=St(b.url,N))})(c,t),function(v,w){w.length>0&&(v.sdk=v.sdk||{},v.sdk.integrations=[...v.sdk.integrations||[],...w])}(c,h),i&&i.emit("applyFrameMetadata",e),e.type===void 0&&function(v,w){const O=V._sentryDebugIds;if(!O)return;let A;const x=Di.get(w);x?A=x:(A=new Map,Di.set(w,A));const N=Object.entries(O).reduce((k,[b,E])=>{let T;const P=A.get(b);P?T=P:(T=w(b),A.set(b,T));for(let F=T.length-1;F>=0;F--){const R=T[F];if(R.filename){k[R.filename]=E;break}}return k},{});try{v.exception.values.forEach(k=>{k.stacktrace.frames.forEach(b=>{b.filename&&(b.debug_id=N[b.filename])})})}catch{}}(c,t.stackParser);const p=function(v,w){if(!w)return v;const O=v?v.clone():new Ge;return O.update(w),O}(r,n.captureContext);n.mechanism&&$t(c,n.mechanism);const g=i?i.getEventProcessors():[],_=vn("globalScope",()=>new Ge).getScopeData();a&&ji(_,a.getScopeData()),p&&ji(_,p.getScopeData());const C=[...n.attachments||[],..._.attachments];return C.length&&(n.attachments=C),Go(c,_),hr([...g,..._.eventProcessors],c,n).then(v=>(v&&function(w){const O={};try{w.exception.values.forEach(x=>{x.stacktrace.frames.forEach(N=>{N.debug_id&&(N.abs_path?O[N.abs_path]=N.debug_id:N.filename&&(O[N.filename]=N.debug_id),delete N.debug_id)})})}catch{}if(Object.keys(O).length===0)return;w.debug_meta=w.debug_meta||{},w.debug_meta.images=w.debug_meta.images||[];const A=w.debug_meta.images;Object.entries(O).forEach(([x,N])=>{A.push({type:"sourcemap",code_file:x,debug_id:N})})}(v),typeof o=="number"&&o>0?function(w,O,A){if(!w)return null;const x={...w,...w.breadcrumbs&&{breadcrumbs:w.breadcrumbs.map(N=>({...N,...N.data&&{data:$e(N.data,O,A)}}))},...w.user&&{user:$e(w.user,O,A)},...w.contexts&&{contexts:$e(w.contexts,O,A)},...w.extra&&{extra:$e(w.extra,O,A)}};return w.contexts&&w.contexts.trace&&x.contexts&&(x.contexts.trace=w.contexts.trace,w.contexts.trace.data&&(x.contexts.trace.data=$e(w.contexts.trace.data,O,A))),w.spans&&(x.spans=w.spans.map(N=>({...N,...N.data&&{data:$e(N.data,O,A)}}))),x}(v,o,l):v))}const Di=new WeakMap;function Ii(t,e){return jr().captureEvent(t,e)}function Qo(t,e){return n={sentry_key:t.publicKey,sentry_version:"7",...e&&{sentry_client:`${e.name}/${e.version}`}},Object.keys(n).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(n[r])}`).join("&");var n}const Ni=[];function Ri(t,e){for(const n of e)n&&n.afterAllSetup&&n.afterAllSetup(t)}function Bi(t,e,n){if(n[e.name])K&&B.log(`Integration skipped because it was already installed: ${e.name}`);else{if(n[e.name]=e,Ni.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),Ni.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(t),typeof e.preprocessEvent=="function"){const r=e.preprocessEvent.bind(e);t.on("preprocessEvent",(i,a)=>r(i,a,t))}if(typeof e.processEvent=="function"){const r=e.processEvent.bind(e),i=Object.assign((a,o)=>r(a,o,t),{id:e.name});t.addEventProcessor(i)}K&&B.log(`Integration installed: ${e.name}`)}}const Fi="Not capturing exception because it's already been captured.";class Ko{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=ko(e.dsn):K&&B.warn("No DSN provided, client will not send events."),this._dsn){const a=(n=this._dsn,r=e.tunnel,i=e._metadata?e._metadata.sdk:void 0,r||`${function(o){return`${function(l){const c=l.protocol?`${l.protocol}:`:"",h=l.port?`:${l.port}`:"";return`${c}//${l.host}${h}${l.path?`/${l.path}`:""}/api/`}(o)}${o.projectId}/envelope/`}(n)}?${Qo(n,i)}`);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:a})}var n,r,i}captureException(e,n,r){const i=be();if(ki(e))return K&&B.log(Fi),i;const a={event_id:i,...n};return this._process(this.eventFromException(e,a).then(o=>this._captureEvent(o,a,r))),a.event_id}captureMessage(e,n,r,i){const a={event_id:be(),...r},o=Mr(e)?e:String(e),l=tr(e)?this.eventFromMessage(o,n,a):this.eventFromException(e,a);return this._process(l.then(c=>this._captureEvent(c,a,i))),a.event_id}captureEvent(e,n,r){const i=be();if(n&&n.originalException&&ki(n.originalException))return K&&B.log(Fi),i;const a={event_id:i,...n},o=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,a,o||r)),a.event_id}captureSession(e){typeof e.release!="string"?K&&B.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),ur(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const n=this._transport;return n?(this.emit("flush"),this._isClientDoneProcessing(e).then(r=>n.flush(e).then(i=>r&&i))):pt(!0)}close(e){return this.flush(e).then(n=>(this.getOptions().enabled=!1,this.emit("close"),n))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const n=this._integrations[e.name];Bi(this,e,this._integrations),n||Ri(this,[e])}sendEvent(e,n={}){this.emit("beforeSendEvent",e,n);let r=zo(e,this._dsn,this._options._metadata,this._options.tunnel);for(const a of n.attachments||[])r=Do(r,No(a));const i=this.sendEnvelope(r);i&&i.then(a=>this.emit("afterSendEvent",e,a),null)}sendSession(e){const n=function(r,i,a,o){const l=ms(a);return Jt({sent_at:new Date().toISOString(),...l&&{sdk:l},...!!o&&i&&{dsn:_n(i)}},["aggregates"in r?[{type:"sessions"},r]:[{type:"session"},r.toJSON()]])}(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(n)}recordDroppedEvent(e,n,r){if(this._options.sendClientReports){const i=typeof r=="number"?r:1,a=`${e}:${n}`;K&&B.log(`Recording outcome: "${a}"${i>1?` (${i} times)`:""}`),this._outcomes[a]=(this._outcomes[a]||0)+i}}on(e,n){const r=this._hooks[e]=this._hooks[e]||[];return r.push(n),()=>{const i=r.indexOf(n);i>-1&&r.splice(i,1)}}emit(e,...n){const r=this._hooks[e];r&&r.forEach(i=>i(...n))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,n=>(K&&B.error("Error while sending event:",n),n)):(K&&B.error("Transport disabled"),pt({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=function(n,r){const i={};return r.forEach(a=>{a&&Bi(n,a,i)}),i}(this,e),Ri(this,e)}_updateSessionFromEvent(e,n){let r=!1,i=!1;const a=n.exception&&n.exception.values;if(a){i=!0;for(const l of a){const c=l.mechanism;if(c&&c.handled===!1){r=!0;break}}}const o=e.status==="ok";(o&&e.errors===0||o&&r)&&(ur(e,{...r&&{status:"crashed"},errors:e.errors||Number(i||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new pe(n=>{let r=0;const i=setInterval(()=>{this._numProcessing==0?(clearInterval(i),n(!0)):(r+=1,e&&r>=e&&(clearInterval(i),n(!1)))},1)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,n,r,i=gs()){const a=this.getOptions(),o=Object.keys(this._integrations);return!n.integrations&&o.length>0&&(n.integrations=o),this.emit("preprocessEvent",e,n),e.type||i.setLastEventId(e.event_id||n.event_id),Ho(a,e,n,r,this,i).then(l=>{if(l===null)return l;const c={...i.getPropagationContext(),...r?r.getPropagationContext():void 0};if(!(l.contexts&&l.contexts.trace)&&c){const{traceId:h,spanId:p,parentSpanId:g,dsc:_}=c;l.contexts={trace:ye({trace_id:h,span_id:p,parent_span_id:g}),...l.contexts};const C=_||_s(h,this);l.sdkProcessingMetadata={dynamicSamplingContext:C,...l.sdkProcessingMetadata}}return l})}_captureEvent(e,n={},r){return this._processEvent(e,n,r).then(i=>i.event_id,i=>{if(K){const a=i;a.logLevel==="log"?B.log(a.message):B.warn(a)}})}_processEvent(e,n,r){const i=this.getOptions(),{sampleRate:a}=i,o=$i(e),l=Ui(e),c=e.type||"error",h=`before send for type \`${c}\``,p=a===void 0?void 0:function(C){if(typeof C=="boolean")return Number(C);const v=typeof C=="string"?parseFloat(C):C;if(!(typeof v!="number"||isNaN(v)||v<0||v>1))return v;K&&B.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(C)} of type ${JSON.stringify(typeof C)}.`)}(a);if(l&&typeof p=="number"&&Math.random()>p)return this.recordDroppedEvent("sample_rate","error",e),bn(new Ee(`Discarding event because it's not included in the random sample (sampling rate = ${a})`,"log"));const g=c==="replay_event"?"replay":c,_=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,n,r,_).then(C=>{if(C===null)throw this.recordDroppedEvent("event_processor",g,e),new Ee("An event processor returned `null`, will not send event.","log");if(n.data&&n.data.__sentry__===!0)return C;const v=function(w,O,A,x){const{beforeSend:N,beforeSendTransaction:k,beforeSendSpan:b}=O;if(Ui(A)&&N)return N(A,x);if($i(A)){if(A.spans&&b){const E=[];for(const T of A.spans){const P=b(T);P?E.push(P):w.recordDroppedEvent("before_send","span")}A.spans=E}if(k){if(A.spans){const E=A.spans.length;A.sdkProcessingMetadata={...A.sdkProcessingMetadata,spanCountBeforeProcessing:E}}return k(A,x)}}return A}(this,i,C,n);return function(w,O){const A=`${O} must return \`null\` or a valid event.`;if(On(w))return w.then(x=>{if(!kt(x)&&x!==null)throw new Ee(A);return x},x=>{throw new Ee(`${O} rejected with ${x}`)});if(!kt(w)&&w!==null)throw new Ee(A);return w}(v,h)}).then(C=>{if(C===null){if(this.recordDroppedEvent("before_send",g,e),o){const O=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",O)}throw new Ee(`${h} returned \`null\`, will not send event.`,"log")}const v=r&&r.getSession();if(!o&&v&&this._updateSessionFromEvent(v,C),o){const O=(C.sdkProcessingMetadata&&C.sdkProcessingMetadata.spanCountBeforeProcessing||0)-(C.spans?C.spans.length:0);O>0&&this.recordDroppedEvent("before_send","span",O)}const w=C.transaction_info;if(o&&w&&C.transaction!==e.transaction){const O="custom";C.transaction_info={...w,source:O}}return this.sendEvent(C,n),C}).then(null,C=>{throw C instanceof Ee?C:(this.captureException(C,{data:{__sentry__:!0},originalException:C}),new Ee(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${C}`))})}_process(e){this._numProcessing++,e.then(n=>(this._numProcessing--,n),n=>(this._numProcessing--,n))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([n,r])=>{const[i,a]=n.split(":");return{reason:i,category:a,quantity:r}})}_flushOutcomes(){K&&B.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0)return void(K&&B.log("No outcomes to send"));if(!this._dsn)return void(K&&B.log("No dsn provided, will not send outcomes"));K&&B.log("Sending outcomes:",e);const n=(r=e,Jt((i=this._options.tunnel&&_n(this._dsn))?{dsn:i}:{},[[{type:"client_report"},{timestamp:a||Wt(),discarded_events:r}]]));var r,i,a;this.sendEnvelope(n)}}function Ui(t){return t.type===void 0}function $i(t){return t.type==="transaction"}function Yo(t,e,n=Ao(t.bufferSize||64)){let r={};return{send:function(i){const a=[];if(Ei(i,(c,h)=>{const p=Mi(h);if(function(g,_,C=Date.now()){return function(v,w){return v[w]||v.all||0}(g,_)>C}(r,p)){const g=Ji(c,h);t.recordDroppedEvent("ratelimit_backoff",p,g)}else a.push(c)}),a.length===0)return pt({});const o=Jt(i[0],a),l=c=>{Ei(o,(h,p)=>{const g=Ji(h,p);t.recordDroppedEvent(c,Mi(p),g)})};return n.add(()=>e({body:Io(o)}).then(c=>(c.statusCode!==void 0&&(c.statusCode<200||c.statusCode>=300)&&K&&B.warn(`Sentry responded with status code ${c.statusCode} to sent event.`),r=Bo(r,c),c),c=>{throw l("network_error"),c})).then(c=>c,c=>{if(c instanceof Ee)return K&&B.error("Skipped sending event because buffer is full."),l("queue_overflow"),pt({});throw c})},flush:i=>n.drain(i)}}function Ji(t,e){if(e==="event"||e==="transaction")return Array.isArray(t)?t[1]:void 0}const Xo=100;function et(t,e){const n=ue(),r=gs();if(!n)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:a=Xo}=n.getOptions();if(a<=0)return;const o={timestamp:Wt(),...t},l=i?Or(()=>i(o,e)):o;l!==null&&(n.emit&&n.emit("beforeAddBreadcrumb",l,e),r.addBreadcrumb(l,a))}let qi;const Vi=new WeakMap,Zo=()=>({name:"FunctionToString",setupOnce(){qi=Function.prototype.toString;try{Function.prototype.toString=function(...t){const e=Ar(this),n=Vi.has(ue())&&e!==void 0?e:this;return qi.apply(n,t)}}catch{}},setup(t){Vi.set(t,!0)}}),ec=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler"],tc=(t={})=>({name:"InboundFilters",processEvent(e,n,r){const i=r.getOptions(),a=function(o={},l={}){return{allowUrls:[...o.allowUrls||[],...l.allowUrls||[]],denyUrls:[...o.denyUrls||[],...l.denyUrls||[]],ignoreErrors:[...o.ignoreErrors||[],...l.ignoreErrors||[],...o.disableErrorDefaults?[]:ec],ignoreTransactions:[...o.ignoreTransactions||[],...l.ignoreTransactions||[]],ignoreInternal:o.ignoreInternal===void 0||o.ignoreInternal}}(t,i);return function(o,l){return l.ignoreInternal&&function(c){try{return c.exception.values[0].type==="SentryError"}catch{}return!1}(o)?(K&&B.warn(`Event dropped due to being internal Sentry Error.
Event: ${Ue(o)}`),!0):function(c,h){return c.type||!h||!h.length?!1:function(p){const g=[];p.message&&g.push(p.message);let _;try{_=p.exception.values[p.exception.values.length-1]}catch{}return _&&_.value&&(g.push(_.value),_.type&&g.push(`${_.type}: ${_.value}`)),g}(c).some(p=>Kt(p,h))}(o,l.ignoreErrors)?(K&&B.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${Ue(o)}`),!0):function(c){return c.type||!c.exception||!c.exception.values||c.exception.values.length===0?!1:!c.message&&!c.exception.values.some(h=>h.stacktrace||h.type&&h.type!=="Error"||h.value)}(o)?(K&&B.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${Ue(o)}`),!0):function(c,h){if(c.type!=="transaction"||!h||!h.length)return!1;const p=c.transaction;return!!p&&Kt(p,h)}(o,l.ignoreTransactions)?(K&&B.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${Ue(o)}`),!0):function(c,h){if(!h||!h.length)return!1;const p=tn(c);return!!p&&Kt(p,h)}(o,l.denyUrls)?(K&&B.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${Ue(o)}.
Url: ${tn(o)}`),!0):function(c,h){if(!h||!h.length)return!0;const p=tn(c);return!p||Kt(p,h)}(o,l.allowUrls)?!1:(K&&B.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${Ue(o)}.
Url: ${tn(o)}`),!0)}(e,a)?null:e}});function tn(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch{}return e?function(n=[]){for(let r=n.length-1;r>=0;r--){const i=n[r];if(i&&i.filename!=="<anonymous>"&&i.filename!=="[native code]")return i.filename||null}return null}(e):null}catch{return K&&B.error(`Cannot extract url for event ${Ue(t)}`),null}}const nc=()=>{let t;return{name:"Dedupe",processEvent(e){if(e.type)return e;try{if(function(n,r){return r?!!(function(i,a){const o=i.message,l=a.message;return!(!o&&!l||o&&!l||!o&&l||o!==l||!zi(i,a)||!Wi(i,a))}(n,r)||function(i,a){const o=Gi(a),l=Gi(i);return!(!o||!l||o.type!==l.type||o.value!==l.value||!zi(i,a)||!Wi(i,a))}(n,r)):!1}(e,t))return K&&B.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return t=e}}};function Wi(t,e){let n=bi(t),r=bi(e);if(!n&&!r)return!0;if(n&&!r||!n&&r||r.length!==n.length)return!1;for(let i=0;i<r.length;i++){const a=r[i],o=n[i];if(a.filename!==o.filename||a.lineno!==o.lineno||a.colno!==o.colno||a.function!==o.function)return!1}return!0}function zi(t,e){let n=t.fingerprint,r=e.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;try{return n.join("")===r.join("")}catch{return!1}}function Gi(t){return t.exception&&t.exception.values&&t.exception.values[0]}const re=V;let pr=0;function Hi(){return pr>0}function Et(t,e={},n){if(typeof t!="function")return t;try{const i=t.__sentry_wrapped__;if(i)return typeof i=="function"?i:t;if(Ar(t))return t}catch{return t}const r=function(){const i=Array.prototype.slice.call(arguments);try{n&&typeof n=="function"&&n.apply(this,arguments);const a=i.map(o=>Et(o,e));return t.apply(this,a)}catch(a){throw pr++,setTimeout(()=>{pr--}),function(...o){const l=xr(An());if(o.length===2){const[c,h]=o;return c?l.withSetScope(c,h):l.withScope(h)}l.withScope(o[0])}(o=>{var l;o.addEventProcessor(c=>(e.mechanism&&(or(c,void 0),$t(c,e.mechanism)),c.extra={...c.extra,arguments:i},c)),l=a,jr().captureException(l,void 0)}),a}};try{for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}catch{}ds(r,t),ht(t,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get:()=>t.name})}catch{}return r}const Dr=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Ir(t,e){const n=Nr(t,e),r={type:e&&e.name,value:ac(e)};return n.length&&(r.stacktrace={frames:n}),r.type===void 0&&r.value===""&&(r.value="Unrecoverable error caught"),r}function rc(t,e,n,r){const i=ue(),a=i&&i.getOptions().normalizeDepth,o=function(h){for(const p in h)if(Object.prototype.hasOwnProperty.call(h,p)){const g=h[p];if(g instanceof Error)return g}}(e),l={__serialized__:fs(e,a)};if(o)return{exception:{values:[Ir(t,o)]},extra:l};const c={exception:{values:[{type:Tn(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:sc(e,{isUnhandledRejection:r})}]},extra:l};if(n){const h=Nr(t,n);h.length&&(c.exception.values[0].stacktrace={frames:h})}return c}function Un(t,e){return{exception:{values:[Ir(t,e)]}}}function Nr(t,e){const n=e.stacktrace||e.stack||"",r=function(a){return a&&ic.test(a.message)?1:0}(e),i=function(a){return typeof a.framesToPop=="number"?a.framesToPop:0}(e);try{return t(n,r,i)}catch{}return[]}const ic=/Minified React error #\d+;/i;function ac(t){const e=t&&t.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:e:"No error message"}function fr(t,e,n,r,i){let a;if(cs(e)&&e.error)return Un(t,e.error);if(li(e)||Ot(e,"DOMException")){const o=e;if("stack"in e)a=Un(t,e);else{const l=o.name||(li(o)?"DOMError":"DOMException"),c=o.message?`${l}: ${o.message}`:l;a=mr(t,c,n,r),or(a,c)}return"code"in o&&(a.tags={...a.tags,"DOMException.code":`${o.code}`}),a}return Er(e)?Un(t,e):kt(e)||Tn(e)?(a=rc(t,e,n,i),$t(a,{synthetic:!0}),a):(a=mr(t,e,n,r),or(a,`${e}`),$t(a,{synthetic:!0}),a)}function mr(t,e,n,r){const i={};if(r&&n){const a=Nr(t,n);a.length&&(i.exception={values:[{value:e,stacktrace:{frames:a}}]})}if(Mr(e)){const{__sentry_template_string__:a,__sentry_template_values__:o}=e;return i.logentry={message:a,params:o},i}return i.message=e,i}function sc(t,{isUnhandledRejection:e}){const n=function(i,a=40){const o=Object.keys(hs(i));o.sort();const l=o[0];if(!l)return"[object has no keys]";if(l.length>=a)return St(l,a);for(let c=o.length;c>0;c--){const h=o.slice(0,c).join(", ");if(!(h.length>a))return c===o.length?h:St(h,a)}return""}(t),r=e?"promise rejection":"exception";return cs(t)?`Event \`ErrorEvent\` captured as ${r} with message \`${t.message}\``:Tn(t)?`Event \`${function(i){try{const a=Object.getPrototypeOf(i);return a?a.constructor.name:void 0}catch{}}(t)}\` (type=${t.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}class oc extends Ko{constructor(e){const n={parentSpanIsAlwaysRootSpan:!0,...e};(function(r,i,a=[i],o="npm"){const l=r._metadata||{};l.sdk||(l.sdk={name:`sentry.javascript.${i}`,packages:a.map(c=>({name:`${o}:@sentry/${c}`,version:lt})),version:lt}),r._metadata=l})(n,"browser",["browser"],re.SENTRY_SDK_SOURCE||"npm"),super(n),n.sendClientReports&&re.document&&re.document.addEventListener("visibilitychange",()=>{re.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,n){return function(r,i,a,o){const l=fr(r,i,a&&a.syntheticException||void 0,o);return $t(l),l.level="error",a&&a.event_id&&(l.event_id=a.event_id),pt(l)}(this._options.stackParser,e,n,this._options.attachStacktrace)}eventFromMessage(e,n="info",r){return function(i,a,o="info",l,c){const h=mr(i,a,l&&l.syntheticException||void 0,c);return h.level=o,l&&l.event_id&&(h.event_id=l.event_id),pt(h)}(this._options.stackParser,e,n,r,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled())return void(Dr&&B.warn("SDK not enabled, will not capture user feedback."));const n=function(r,{metadata:i,tunnel:a,dsn:o}){const l={event_id:r.event_id,sent_at:new Date().toISOString(),...i&&i.sdk&&{sdk:{name:i.sdk.name,version:i.sdk.version}},...!!a&&!!o&&{dsn:_n(o)}};return Jt(l,[function(h){return[{type:"user_report"},h]}(r)])}(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(n)}_prepareEvent(e,n,r){return e.platform=e.platform||"javascript",super._prepareEvent(e,n,r)}}const cc=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,oe=V;let Qi,$n,Jn,nn;function lc(){if(!oe.document)return;const t=_e.bind(null,"dom"),e=Ki(t,!0);oe.document.addEventListener("click",e,!1),oe.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(n=>{const r=oe[n]&&oe[n].prototype;r&&r.hasOwnProperty&&r.hasOwnProperty("addEventListener")&&(he(r,"addEventListener",function(i){return function(a,o,l){if(a==="click"||a=="keypress")try{const c=this,h=c.__sentry_instrumentation_handlers__=c.__sentry_instrumentation_handlers__||{},p=h[a]=h[a]||{refCount:0};if(!p.handler){const g=Ki(t);p.handler=g,i.call(this,a,g,l)}p.refCount++}catch{}return i.call(this,a,o,l)}}),he(r,"removeEventListener",function(i){return function(a,o,l){if(a==="click"||a=="keypress")try{const c=this,h=c.__sentry_instrumentation_handlers__||{},p=h[a];p&&(p.refCount--,p.refCount<=0&&(i.call(this,a,p.handler,l),p.handler=void 0,delete h[a]),Object.keys(h).length===0&&delete c.__sentry_instrumentation_handlers__)}catch{}return i.call(this,a,o,l)}}))})}function Ki(t,e=!1){return n=>{if(!n||n._sentryCaptured)return;const r=function(a){try{return a.target}catch{return null}}(n);if(function(a,o){return a==="keypress"&&(!o||!o.tagName||o.tagName!=="INPUT"&&o.tagName!=="TEXTAREA"&&!o.isContentEditable)}(n.type,r))return;ht(n,"_sentryCaptured",!0),r&&!r._sentryId&&ht(r,"_sentryId",be());const i=n.type==="keypress"?"input":n.type;(function(a){if(a.type!==$n)return!1;try{if(!a.target||a.target._sentryId!==Jn)return!1}catch{}return!0})(n)||(t({event:n,name:i,global:e}),$n=n.type,Jn=r?r._sentryId:void 0),clearTimeout(Qi),Qi=oe.setTimeout(()=>{Jn=void 0,$n=void 0},1e3)}}function uc(){if(!function(){const n=en.chrome,r=n&&n.app&&n.app.runtime,i="history"in en&&!!en.history.pushState&&!!en.history.replaceState;return!r&&i}())return;const t=oe.onpopstate;function e(n){return function(...r){const i=r.length>2?r[2]:void 0;if(i){const a=nn,o=String(i);nn=o,_e("history",{from:a,to:o})}return n.apply(this,r)}}oe.onpopstate=function(...n){const r=oe.location.href,i=nn;if(nn=r,_e("history",{from:i,to:r}),t)try{return t.apply(this,n)}catch{}},he(oe.history,"pushState",e),he(oe.history,"replaceState",e)}const hn={};function Yi(t){hn[t]=void 0}const Rt="__sentry_xhr_v3__";function dc(){if(!oe.XMLHttpRequest)return;const t=XMLHttpRequest.prototype;t.open=new Proxy(t.open,{apply(e,n,r){const i=1e3*We(),a=Ie(r[0])?r[0].toUpperCase():void 0,o=function(c){if(Ie(c))return c;try{return c.toString()}catch{}}(r[1]);if(!a||!o)return e.apply(n,r);n[Rt]={method:a,url:o,request_headers:{}},a==="POST"&&o.match(/sentry_key/)&&(n.__sentry_own_request__=!0);const l=()=>{const c=n[Rt];if(c&&n.readyState===4){try{c.status_code=n.status}catch{}_e("xhr",{endTimestamp:1e3*We(),startTimestamp:i,xhr:n})}};return"onreadystatechange"in n&&typeof n.onreadystatechange=="function"?n.onreadystatechange=new Proxy(n.onreadystatechange,{apply:(c,h,p)=>(l(),c.apply(h,p))}):n.addEventListener("readystatechange",l),n.setRequestHeader=new Proxy(n.setRequestHeader,{apply(c,h,p){const[g,_]=p,C=h[Rt];return C&&Ie(g)&&Ie(_)&&(C.request_headers[g.toLowerCase()]=_),c.apply(h,p)}}),e.apply(n,r)}}),t.send=new Proxy(t.send,{apply(e,n,r){const i=n[Rt];return i?(r[0]!==void 0&&(i.body=r[0]),_e("xhr",{startTimestamp:1e3*We(),xhr:n}),e.apply(n,r)):e.apply(n,r)}})}function hc(t,e=function(n){const r=hn[n];if(r)return r;let i=oe[n];if(ar(i))return hn[n]=i.bind(oe);const a=oe.document;if(a&&typeof a.createElement=="function")try{const o=a.createElement("iframe");o.hidden=!0,a.head.appendChild(o);const l=o.contentWindow;l&&l[n]&&(i=l[n]),a.head.removeChild(o)}catch(o){cc&&B.warn(`Could not create sandbox iframe for ${n} check, bailing to window.${n}: `,o)}return i&&(hn[n]=i.bind(oe))}("fetch")){let n=0,r=0;return Yo(t,function(i){const a=i.body.length;n+=a,r++;const o={body:i.body,method:"POST",referrerPolicy:"origin",headers:t.headers,keepalive:n<=6e4&&r<15,...t.fetchOptions};if(!e)return Yi("fetch"),bn("No fetch implementation available");try{return e(t.url,o).then(l=>(n-=a,r--,{statusCode:l.status,headers:{"x-sentry-rate-limits":l.headers.get("X-Sentry-Rate-Limits"),"retry-after":l.headers.get("Retry-After")}}))}catch(l){return Yi("fetch"),n-=a,r--,bn(l)}})}function qn(t,e,n,r){const i={filename:t,function:e==="<anonymous>"?st:e,in_app:!0};return n!==void 0&&(i.lineno=n),r!==void 0&&(i.colno=r),i}const pc=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,fc=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,mc=/\((\S*)(?::(\d+))(?::(\d+))\)/,gc=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,vc=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,yc=function(...t){const e=t.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0,i=0)=>{const a=[],o=n.split(`
`);for(let l=r;l<o.length;l++){const c=o[l];if(c.length>1024)continue;const h=vi.test(c)?c.replace(vi,"$1"):c;if(!h.match(/\S*Error: /)){for(const p of e){const g=p(h);if(g){a.push(g);break}}if(a.length>=50+i)break}}return function(l){if(!l.length)return[];const c=Array.from(l);return/sentryWrapped/.test(Yt(c).function||"")&&c.pop(),c.reverse(),yi.test(Yt(c).function||"")&&(c.pop(),yi.test(Yt(c).function||"")&&c.pop()),c.slice(0,50).map(h=>({...h,filename:h.filename||Yt(c).filename,function:h.function||st}))}(a.slice(i))}}([30,t=>{const e=pc.exec(t);if(e){const[,r,i,a]=e;return qn(r,st,+i,+a)}const n=fc.exec(t);if(n){if(n[2]&&n[2].indexOf("eval")===0){const a=mc.exec(n[2]);a&&(n[2]=a[1],n[3]=a[2],n[4]=a[3])}const[r,i]=Xi(n[1]||st,n[2]);return qn(i,r,n[3]?+n[3]:void 0,n[4]?+n[4]:void 0)}}],[50,t=>{const e=gc.exec(t);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const i=vc.exec(e[3]);i&&(e[1]=e[1]||"eval",e[3]=i[1],e[4]=i[2],e[5]="")}let n=e[3],r=e[1]||st;return[r,n]=Xi(r,n),qn(n,r,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}]),Xi=(t,e)=>{const n=t.indexOf("safari-extension")!==-1,r=t.indexOf("safari-web-extension")!==-1;return n||r?[t.indexOf("@")!==-1?t.split("@")[0]:st,n?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]},Zi=1024,_c=(t={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...t};return{name:"Breadcrumbs",setup(n){var r;e.console&&function(i){const a="console";ot(a,i),ct(a,Co)}(function(i){return function(a){if(ue()!==i)return;const o={category:"console",data:{arguments:a.args,logger:"console"},level:Lo(a.level),message:ui(a.args," ")};if(a.level==="assert"){if(a.args[0]!==!1)return;o.message=`Assertion failed: ${ui(a.args.slice(1)," ")||"console.assert"}`,o.data.arguments=a.args.slice(1)}et(o,{input:a.args,level:a.level})}}(n)),e.dom&&(r=function(i,a){return function(o){if(ue()!==i)return;let l,c,h=typeof a=="object"?a.serializeAttribute:void 0,p=typeof a=="object"&&typeof a.maxStringLength=="number"?a.maxStringLength:void 0;p&&p>Zi&&(Dr&&B.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${p} was configured. Sentry will use 1024 instead.`),p=Zi),typeof h=="string"&&(h=[h]);try{const _=o.event,C=function(v){return!!v&&!!v.target}(_)?_.target:_;l=us(C,{keyAttrs:h,maxStringLength:p}),c=function(v){if(!Tr.HTMLElement)return null;let w=v;for(let O=0;O<5;O++){if(!w)return null;if(w instanceof HTMLElement){if(w.dataset.sentryComponent)return w.dataset.sentryComponent;if(w.dataset.sentryElement)return w.dataset.sentryElement}w=w.parentNode}return null}(C)}catch{l="<unknown>"}if(l.length===0)return;const g={category:`ui.${o.name}`,message:l};c&&(g.data={"ui.component_name":c}),et(g,{event:o.event,name:o.name,global:o.global})}}(n,e.dom),ot("dom",r),ct("dom",lc)),e.xhr&&function(i){ot("xhr",i),ct("xhr",dc)}(function(i){return function(a){if(ue()!==i)return;const{startTimestamp:o,endTimestamp:l}=a,c=a.xhr[Rt];if(!o||!l||!c)return;const{method:h,url:p,status_code:g,body:_}=c,C={method:h,url:p,status_code:g},v={xhr:a.xhr,input:_,startTimestamp:o,endTimestamp:l};et({category:"xhr",data:C,type:"http",level:pi(g)},v)}}(n)),e.fetch&&Mo(function(i){return function(a){if(ue()!==i)return;const{startTimestamp:o,endTimestamp:l}=a;if(l&&(!a.fetchData.url.match(/sentry_key/)||a.fetchData.method!=="POST"))if(a.error)et({category:"fetch",data:a.fetchData,level:"error",type:"http"},{data:a.error,input:a.args,startTimestamp:o,endTimestamp:l});else{const c=a.response,h={...a.fetchData,status_code:c&&c.status},p={input:a.args,response:c,startTimestamp:o,endTimestamp:l};et({category:"fetch",data:h,type:"http",level:pi(h.status_code)},p)}}}(n)),e.history&&function(i){const a="history";ot(a,i),ct(a,uc)}(function(i){return function(a){if(ue()!==i)return;let o=a.from,l=a.to;const c=Fn(re.location.href);let h=o?Fn(o):void 0;const p=Fn(l);h&&h.path||(h=c),c.protocol===p.protocol&&c.host===p.host&&(l=p.relative),c.protocol===h.protocol&&c.host===h.host&&(o=h.relative),et({category:"navigation",data:{from:o,to:l}})}}(n)),e.sentry&&n.on("beforeSendEvent",function(i){return function(a){ue()===i&&et({category:"sentry."+(a.type==="transaction"?"transaction":"event"),event_id:a.event_id,level:a.level,message:Ue(a)},{event:a})}}(n))}}},bc=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],Sc=(t={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...t};return{name:"BrowserApiErrors",setupOnce(){e.setTimeout&&he(re,"setTimeout",ea),e.setInterval&&he(re,"setInterval",ea),e.requestAnimationFrame&&he(re,"requestAnimationFrame",wc),e.XMLHttpRequest&&"XMLHttpRequest"in re&&he(XMLHttpRequest.prototype,"send",kc);const n=e.eventTarget;n&&(Array.isArray(n)?n:bc).forEach(Cc)}}};function ea(t){return function(...e){const n=e[0];return e[0]=Et(n,{mechanism:{data:{function:ze(t)},handled:!1,type:"instrument"}}),t.apply(this,e)}}function wc(t){return function(e){return t.apply(this,[Et(e,{mechanism:{data:{function:"requestAnimationFrame",handler:ze(t)},handled:!1,type:"instrument"}})])}}function kc(t){return function(...e){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(r=>{r in n&&typeof n[r]=="function"&&he(n,r,function(i){const a={mechanism:{data:{function:r,handler:ze(i)},handled:!1,type:"instrument"}},o=Ar(i);return o&&(a.mechanism.data.handler=ze(o)),Et(i,a)})}),t.apply(this,e)}}function Cc(t){const e=re,n=e[t]&&e[t].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(he(n,"addEventListener",function(r){return function(i,a,o){try{typeof a.handleEvent=="function"&&(a.handleEvent=Et(a.handleEvent,{mechanism:{data:{function:"handleEvent",handler:ze(a),target:t},handled:!1,type:"instrument"}}))}catch{}return r.apply(this,[i,Et(a,{mechanism:{data:{function:"addEventListener",handler:ze(a),target:t},handled:!1,type:"instrument"}}),o])}}),he(n,"removeEventListener",function(r){return function(i,a,o){const l=a;try{const c=l&&l.__sentry_wrapped__;c&&r.call(this,i,c,o)}catch{}return r.call(this,i,l,o)}}))}const Ec=(t={})=>{const e={onerror:!0,onunhandledrejection:!0,...t};return{name:"GlobalHandlers",setupOnce(){Error.stackTraceLimit=50},setup(n){e.onerror&&(function(r){(function(i){const a="error";ot(a,i),ct(a,To)})(i=>{const{stackParser:a,attachStacktrace:o}=na();if(ue()!==r||Hi())return;const{msg:l,url:c,line:h,column:p,error:g}=i,_=function(C,v,w,O){const A=C.exception=C.exception||{},x=A.values=A.values||[],N=x[0]=x[0]||{},k=N.stacktrace=N.stacktrace||{},b=k.frames=k.frames||[],E=isNaN(parseInt(O,10))?void 0:O,T=isNaN(parseInt(w,10))?void 0:w,P=Ie(v)&&v.length>0?v:function(){try{return Tr.document.location.href}catch{return""}}();return b.length===0&&b.push({colno:E,filename:P,function:st,in_app:!0,lineno:T}),C}(fr(a,g||l,void 0,o,!1),c,h,p);_.level="error",Ii(_,{originalException:g,mechanism:{handled:!1,type:"onerror"}})})}(n),ta("onerror")),e.onunhandledrejection&&(function(r){(function(i){const a="unhandledrejection";ot(a,i),ct(a,Oo)})(i=>{const{stackParser:a,attachStacktrace:o}=na();if(ue()!==r||Hi())return;const l=function(h){if(tr(h))return h;try{if("reason"in h)return h.reason;if("detail"in h&&"reason"in h.detail)return h.detail.reason}catch{}return h}(i),c=tr(l)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(l)}`}]}}:fr(a,l,void 0,o,!0);c.level="error",Ii(c,{originalException:l,mechanism:{handled:!1,type:"onunhandledrejection"}})})}(n),ta("onunhandledrejection"))}}};function ta(t){Dr&&B.log(`Global Handler attached: ${t}`)}function na(){const t=ue();return t&&t.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const Mc=()=>({name:"HttpContext",preprocessEvent(t){if(!re.navigator&&!re.location&&!re.document)return;const e=t.request&&t.request.url||re.location&&re.location.href,{referrer:n}=re.document||{},{userAgent:r}=re.navigator||{},i={...t.request&&t.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},a={...t.request,...e&&{url:e},headers:i};t.request=a}}),Tc=(t={})=>{const e=t.limit||5,n=t.key||"cause";return{name:"LinkedErrors",preprocessEvent(r,i,a){const o=a.getOptions();bo(Ir,o.stackParser,o.maxValueLength,n,e,r,i)}}};var ra="new",ia="loading",aa="loaded",gr="joining-meeting",at="joined-meeting",tt="left-meeting",Be="error",Vn="unknown",Oc="full",Ac="base",sa="no-room",Pc="end-of-life",Lc="connection-error",xc="iframe-ready-for-launch-config",jc="iframe-launch-config",Dc="theme-updated",Ic="loading",Nc="load-attempt-failed",oa="loaded",Rc="started-camera",Bc="camera-error",Fc="joining-meeting",Uc="joined-meeting",$c="left-meeting",Jc="participant-joined",qc="participant-updated",Vc="participant-left",Wc="participant-counts-updated",zc="access-state-updated",Gc="meeting-session-summary-updated",Hc="meeting-session-state-updated",Qc="waiting-participant-added",Kc="waiting-participant-updated",Yc="waiting-participant-removed",Xc="track-started",Zc="track-stopped",el="transcription-started",tl="transcription-stopped",nl="transcription-error",ca="recording-started",la="recording-stopped",rl="recording-stats",il="recording-error",al="recording-upload-completed",sl="recording-data",ol="app-message",cl="transcription-message",ll="remote-media-player-started",ul="remote-media-player-updated",dl="remote-media-player-stopped",hl="local-screen-share-started",pl="local-screen-share-stopped",fl="local-screen-share-canceled",ml="active-speaker-change",gl="active-speaker-mode-change",vl="network-quality-change",yl="network-connection",_l="cpu-load-change",bl="face-counts-updated",rn="fullscreen",an="exited-fullscreen",Sl="live-streaming-started",wl="live-streaming-updated",kl="live-streaming-stopped",Cl="live-streaming-error",El="lang-updated",Ml="receive-settings-updated",Tl="input-settings-updated",ua="nonfatal-error",da="error",Wn=4096,ha=102400,zn="iframe-call-message",pa="local-screen-start",fa="daily-method-update-live-streaming-endpoints",sn="transmit-log",Bt="daily-custom-track",pn={NONE:"none",BGBLUR:"background-blur",BGIMAGE:"background-image",FACE_DETECTION:"face-detection"},bs={NONE:"none",NOISE_CANCELLATION:"noise-cancellation"},vr={PLAY:"play",PAUSE:"pause"},Gn=["jpg","png","jpeg"],Ol="add-endpoints",Al="remove-endpoints",ma="sip-call-transfer";function me(){return!q()&&typeof window<"u"&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:""}function q(){return typeof navigator<"u"&&navigator.product&&navigator.product==="ReactNative"}function Ss(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia}function Pl(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)&&(function(t,e){if(!t||!e)return!0;switch(t){case"Chrome":return e.major>=75;case"Safari":return RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")&&!(e.major===13&&e.minor===0&&e.point===0);case"Firefox":return e.major>=67}return!0}(ft(),qt())||q())}function ga(){if(q()||!document)return!1;var t=document.createElement("iframe");return!!t.requestFullscreen||!!t.webkitRequestFullscreen}var Ll=function(){try{var t=document.createElement("canvas"),e=t.getContext("webgl2")!=null;return t.remove(),e}catch{return!1}}();function ws(){var t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return!q()&&!!Ll&&(t?function(){return ya()?!1:["Chrome","Firefox"].includes(ft())}():function(){if(ya())return!1;var e=ft();if(e==="Safari"){var n=Br();if(n.major<15||n.major===15&&n.minor<4)return!1}return e==="Chrome"?Rr().major>=77:e==="Firefox"?Fr().major>=97:["Chrome","Firefox","Safari"].includes(e)}())}function ks(){if(q()||Cs()||typeof AudioWorkletNode>"u")return!1;switch(ft()){case"Chrome":case"Firefox":return!0;case"Safari":return qt().major>=17&&qt().minor>=4}return!1}function va(){return Ss()&&!function(){var t,e=ft();if(!me())return!0;switch(e){case"Chrome":return(t=Rr()).major&&t.major>0&&t.major<75;case"Firefox":return(t=Fr()).major<91;case"Safari":return(t=Br()).major<13||t.major===13&&t.minor<1;default:return!0}}()}function Cs(){return me().match(/Linux; Android/)}function ya(){var t,e,n=me(),r=n.match(/Mac/)&&(!q()&&typeof window<"u"&&(t=window)!==null&&t!==void 0&&(e=t.navigator)!==null&&e!==void 0&&e.maxTouchPoints?window.navigator.maxTouchPoints:0)>=5;return!!(n.match(/Mobi/)||n.match(/Android/)||r)||!!me().match(/DailyAnd\//)||void 0}function ft(){if(typeof window<"u"){var t=me();return Es()?"Safari":t.indexOf("Edge")>-1?"Edge":t.match(/Chrome\//)?"Chrome":t.indexOf("Safari")>-1||Ms()?"Safari":t.indexOf("Firefox")>-1?"Firefox":t.indexOf("MSIE")>-1||t.indexOf(".NET")>-1?"IE":"Unknown Browser"}}function qt(){switch(ft()){case"Chrome":return Rr();case"Safari":return Br();case"Firefox":return Fr();case"Edge":return function(){var t=0,e=0;if(typeof window<"u"){var n=me().match(/Edge\/(\d+).(\d+)/);if(n)try{t=parseInt(n[1]),e=parseInt(n[2])}catch{}}return{major:t,minor:e}}()}}function Rr(){var t=0,e=0,n=0,r=0,i=!1;if(typeof window<"u"){var a=me(),o=a.match(/Chrome\/(\d+).(\d+).(\d+).(\d+)/);if(o)try{t=parseInt(o[1]),e=parseInt(o[2]),n=parseInt(o[3]),r=parseInt(o[4]),i=a.indexOf("OPR/")>-1}catch{}}return{major:t,minor:e,build:n,patch:r,opera:i}}function Es(){return!!me().match(/iPad|iPhone|iPod/i)&&Ss()}function Ms(){return me().indexOf("AppleWebKit/605.1.15")>-1}function Br(){var t=0,e=0,n=0;if(typeof window<"u"){var r=me().match(/Version\/(\d+).(\d+)(.(\d+))?/);if(r)try{t=parseInt(r[1]),e=parseInt(r[2]),n=parseInt(r[4])}catch{}else(Es()||Ms())&&(t=14,e=0,n=3)}return{major:t,minor:e,point:n}}function Fr(){var t=0,e=0;if(typeof window<"u"){var n=me().match(/Firefox\/(\d+).(\d+)/);if(n)try{t=parseInt(n[1]),e=parseInt(n[2])}catch{}}return{major:t,minor:e}}var Ts=function(){function t(){we(this,t)}return ke(t,[{key:"addListenerForMessagesFromCallMachine",value:function(e,n,r){Dt()}},{key:"addListenerForMessagesFromDailyJs",value:function(e,n,r){Dt()}},{key:"sendMessageToCallMachine",value:function(e,n,r,i){Dt()}},{key:"sendMessageToDailyJs",value:function(e,n){Dt()}},{key:"removeListener",value:function(e){Dt()}}]),t}();function _a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Hn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_a(Object(n),!0).forEach(function(r){je(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_a(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function xl(t){var e=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var n,r=Se(t);if(e){var i=Se(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return En(this,n)}}var jl=function(){Cn(e,Ts);var t=xl(e);function e(){var n;return we(this,e),(n=t.call(this))._wrappedListeners={},n._messageCallbacks={},n}return ke(e,[{key:"addListenerForMessagesFromCallMachine",value:function(n,r,i){var a=this,o=function(l){if(l.data&&l.data.what==="iframe-call-message"&&(!l.data.callClientId||l.data.callClientId===r)&&(!l.data.from||l.data.from!=="module")){var c=Hn({},l.data);if(delete c.from,c.callbackStamp&&a._messageCallbacks[c.callbackStamp]){var h=c.callbackStamp;a._messageCallbacks[h].call(i,c),delete a._messageCallbacks[h]}delete c.what,delete c.callbackStamp,n.call(i,c)}};this._wrappedListeners[n]=o,window.addEventListener("message",o)}},{key:"addListenerForMessagesFromDailyJs",value:function(n,r,i){var a=function(o){var l;if(!(!o.data||o.data.what!==zn||!o.data.action||o.data.from&&o.data.from!=="module"||o.data.callClientId&&r&&o.data.callClientId!==r||o!=null&&(l=o.data)!==null&&l!==void 0&&l.callFrameId)){var c=o.data;n.call(i,c)}};this._wrappedListeners[n]=a,window.addEventListener("message",a)}},{key:"sendMessageToCallMachine",value:function(n,r,i,a){if(!i)throw new Error("undefined callClientId. Are you trying to use a DailyCall instance previously destroyed?");var o=Hn({},n);if(o.what=zn,o.from="module",o.callClientId=i,r){var l=Mn();this._messageCallbacks[l]=r,o.callbackStamp=l}var c=a?a.contentWindow:window,h=this._callMachineTargetOrigin(a);h&&c.postMessage(o,h)}},{key:"sendMessageToDailyJs",value:function(n,r){n.what=zn,n.callClientId=r,n.from="embedded",window.postMessage(n,this._targetOriginFromWindowLocation())}},{key:"removeListener",value:function(n){var r=this._wrappedListeners[n];r&&(window.removeEventListener("message",r),delete this._wrappedListeners[n])}},{key:"forwardPackagedMessageToCallMachine",value:function(n,r,i){var a=Hn({},n);a.callClientId=i;var o=r?r.contentWindow:window,l=this._callMachineTargetOrigin(r);l&&o.postMessage(a,l)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(n,r){var i=function(a){if(a.data&&a.data.what==="iframe-call-message"&&(!a.data.callClientId||a.data.callClientId===r)&&(!a.data.from||a.data.from!=="module")){var o=a.data;n(o)}};return this._wrappedListeners[n]=i,window.addEventListener("message",i),n}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(n){var r=this._wrappedListeners[n];r&&(window.removeEventListener("message",r),delete this._wrappedListeners[n])}},{key:"_callMachineTargetOrigin",value:function(n){return n?n.src?new URL(n.src).origin:void 0:this._targetOriginFromWindowLocation()}},{key:"_targetOriginFromWindowLocation",value:function(){return window.location.protocol==="file:"?"*":window.location.origin}}]),e}();function ba(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Dl(t){var e=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var n,r=Se(t);if(e){var i=Se(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return En(this,n)}}var Il=function(){Cn(e,Ts);var t=Dl(e);function e(){var n;return we(this,e),n=t.call(this),global.callMachineToDailyJsEmitter=global.callMachineToDailyJsEmitter||new De.EventEmitter,global.dailyJsToCallMachineEmitter=global.dailyJsToCallMachineEmitter||new De.EventEmitter,n._wrappedListeners={},n._messageCallbacks={},n}return ke(e,[{key:"addListenerForMessagesFromCallMachine",value:function(n,r,i){this._addListener(n,global.callMachineToDailyJsEmitter,r,i,"received call machine message")}},{key:"addListenerForMessagesFromDailyJs",value:function(n,r,i){this._addListener(n,global.dailyJsToCallMachineEmitter,r,i,"received daily-js message")}},{key:"sendMessageToCallMachine",value:function(n,r,i){this._sendMessage(n,global.dailyJsToCallMachineEmitter,i,r,"sending message to call machine")}},{key:"sendMessageToDailyJs",value:function(n,r){this._sendMessage(n,global.callMachineToDailyJsEmitter,r,null,"sending message to daily-js")}},{key:"removeListener",value:function(n){var r=this._wrappedListeners[n];r&&(global.callMachineToDailyJsEmitter.removeListener("message",r),global.dailyJsToCallMachineEmitter.removeListener("message",r),delete this._wrappedListeners[n])}},{key:"_addListener",value:function(n,r,i,a,o){var l=this,c=function(h){if(h.callClientId===i){if(h.callbackStamp&&l._messageCallbacks[h.callbackStamp]){var p=h.callbackStamp;l._messageCallbacks[p].call(a,h),delete l._messageCallbacks[p]}n.call(a,h)}};this._wrappedListeners[n]=c,r.addListener("message",c)}},{key:"_sendMessage",value:function(n,r,i,a,o){var l=function(h){for(var p=1;p<arguments.length;p++){var g=arguments[p]!=null?arguments[p]:{};p%2?ba(Object(g),!0).forEach(function(_){je(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ba(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}({},n);if(l.callClientId=i,a){var c=Mn();this._messageCallbacks[c]=a,l.callbackStamp=c}r.emit("message",l)}}]),e}(),yr="replace",_r="shallow-merge",Sa=[yr,_r],Nl=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data,r=e.mergeStrategy,i=r===void 0?yr:r;we(this,t),t._validateMergeStrategy(i),t._validateData(n,i),this.mergeStrategy=i,this.data=n}return ke(t,[{key:"isNoOp",value:function(){return t.isNoOpUpdate(this.data,this.mergeStrategy)}}],[{key:"isNoOpUpdate",value:function(e,n){return Object.keys(e).length===0&&n===_r}},{key:"_validateMergeStrategy",value:function(e){if(!Sa.includes(e))throw Error("Unrecognized mergeStrategy provided. Options are: [".concat(Sa,"]"))}},{key:"_validateData",value:function(e,n){if(!function(l){if(l==null||z(l)!=="object")return!1;var c=Object.getPrototypeOf(l);return c==null||c===Object.prototype}(e))throw Error("Meeting session data must be a plain (map-like) object");var r;try{if(r=JSON.stringify(e),n===yr){var i=JSON.parse(r);le(i,e)||console.warn("The meeting session data provided will be modified when serialized.",i,e)}else if(n===_r){for(var a in e)if(Object.hasOwnProperty.call(e,a)&&e[a]!==void 0){var o=JSON.parse(JSON.stringify(e[a]));le(e[a],o)||console.warn("At least one key in the meeting session data provided will be modified when serialized.",o,e[a])}}}catch(l){throw Error("Meeting session data must be serializable to JSON: ".concat(l))}if(r.length>ha)throw Error("Meeting session data is too large (".concat(r.length," characters). Maximum size suppported is ").concat(ha,"."))}}]),t}();function br(t,e,n){return br=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}()?Reflect.construct.bind():function(r,i,a){var o=[null];o.push.apply(o,i);var l=new(Function.bind.apply(r,o));return a&&Ut(l,a.prototype),l},br.apply(null,arguments)}function Sr(t){var e=typeof Map=="function"?new Map:void 0;return Sr=function(n){if(n===null||(r=n,Function.toString.call(r).indexOf("[native code]")===-1))return n;var r;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,i)}function i(){return br(n,arguments,Se(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Ut(i,n)},Sr(t)}function Rl(t){var e=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var n,r=Se(t);if(e){var i=Se(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return En(this,n)}}function wa(t){var e,n=(e=window._daily)===null||e===void 0?void 0:e.pendings;if(n){var r=n.indexOf(t);r!==-1&&n.splice(r,1)}}var Bl=function(){function t(e){we(this,t),this._currentLoad=null,this._callClientId=e}return ke(t,[{key:"load",value:function(){var e,n=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;if(this.loaded)return window._daily.instances[this._callClientId].callMachine.reset(),void i(!0);e=this._callClientId,window._daily.pendings.push(e),this._currentLoad&&this._currentLoad.cancel(),this._currentLoad=new Fl(r,function(){i(!1)},function(o,l){l||wa(n._callClientId),a(o,l)}),this._currentLoad.start()}},{key:"cancel",value:function(){this._currentLoad&&this._currentLoad.cancel(),wa(this._callClientId)}},{key:"loaded",get:function(){return this._currentLoad&&this._currentLoad.succeeded}}]),t}(),Fl=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;we(this,t),this._attemptsRemaining=3,this._currentAttempt=null,this._dailyConfig=e,this._successCallback=n,this._failureCallback=r}return ke(t,[{key:"start",value:function(){var e=this;this._currentAttempt||(this._currentAttempt=new ka(this._dailyConfig,this._successCallback,function n(r){e._currentAttempt.cancelled||(e._attemptsRemaining--,e._failureCallback(r,e._attemptsRemaining>0),e._attemptsRemaining<=0||setTimeout(function(){e._currentAttempt.cancelled||(e._currentAttempt=new ka(e._dailyConfig,e._successCallback,n),e._currentAttempt.start())},3e3))}),this._currentAttempt.start())}},{key:"cancel",value:function(){this._currentAttempt&&this._currentAttempt.cancel()}},{key:"cancelled",get:function(){return this._currentAttempt&&this._currentAttempt.cancelled}},{key:"succeeded",get:function(){return this._currentAttempt&&this._currentAttempt.succeeded}}]),t}(),Qn=function(){Cn(e,Sr(Error));var t=Rl(e);function e(){return we(this,e),t.apply(this,arguments)}return ke(e)}(),wn=2e4,ka=function(){function t(n,r,i){we(this,t),this._loadAttemptImpl=q()||!n.avoidEval?new Ul(n,r,i):new $l(n,r,i)}var e;return ke(t,[{key:"start",value:(e=D(function*(){return this._loadAttemptImpl.start()}),function(){return e.apply(this,arguments)})},{key:"cancel",value:function(){this._loadAttemptImpl.cancel()}},{key:"cancelled",get:function(){return this._loadAttemptImpl.cancelled}},{key:"succeeded",get:function(){return this._loadAttemptImpl.succeeded}}]),t}(),Ul=function(){function t(a,o,l){we(this,t),this.cancelled=!1,this.succeeded=!1,this._networkTimedOut=!1,this._networkTimeout=null,this._iosCache=typeof iOSCallObjectBundleCache<"u"&&iOSCallObjectBundleCache,this._refetchHeaders=null,this._dailyConfig=a,this._successCallback=o,this._failureCallback=l}var e,n,r,i;return ke(t,[{key:"start",value:(i=D(function*(){var a=mn(this._dailyConfig);!(yield this._tryLoadFromIOSCache(a))&&this._loadFromNetwork(a)}),function(){return i.apply(this,arguments)})},{key:"cancel",value:function(){clearTimeout(this._networkTimeout),this.cancelled=!0}},{key:"_tryLoadFromIOSCache",value:(r=D(function*(a){if(!this._iosCache)return!1;try{var o=yield this._iosCache.get(a);return!!this.cancelled||!!o&&(o.code?(Function('"use strict";'+o.code)(),this.succeeded=!0,this._successCallback(),!0):(this._refetchHeaders=o.refetchHeaders,!1))}catch{return!1}}),function(a){return r.apply(this,arguments)})},{key:"_loadFromNetwork",value:(n=D(function*(a){var o=this;this._networkTimeout=setTimeout(function(){o._networkTimedOut=!0,o._failureCallback({msg:"Timed out (>".concat(wn," ms) when loading call object bundle ").concat(a),type:"timeout"})},wn);try{var l=this._refetchHeaders?{headers:this._refetchHeaders}:{},c=yield fetch(a,l);if(clearTimeout(this._networkTimeout),this.cancelled||this._networkTimedOut)throw new Qn;var h=yield this._getBundleCodeFromResponse(a,c);if(this.cancelled)throw new Qn;Function('"use strict";'+h)(),this._iosCache&&this._iosCache.set(a,h,c.headers),this.succeeded=!0,this._successCallback()}catch(p){if(clearTimeout(this._networkTimeout),p instanceof Qn||this.cancelled||this._networkTimedOut)return;this._failureCallback({msg:"Failed to load call object bundle ".concat(a,": ").concat(p),type:p.message})}}),function(a){return n.apply(this,arguments)})},{key:"_getBundleCodeFromResponse",value:(e=D(function*(a,o){if(o.ok)return yield o.text();if(this._iosCache&&o.status===304)return(yield this._iosCache.renew(a,o.headers)).code;throw new Error("Received ".concat(o.status," response"))}),function(a,o){return e.apply(this,arguments)})}]),t}(),$l=function(){function t(e,n,r){we(this,t),this.cancelled=!1,this.succeeded=!1,this._dailyConfig=e,this._successCallback=n,this._failureCallback=r,this._attemptId=Mn(),this._networkTimeout=null,this._scriptElement=null}return ke(t,[{key:"start",value:function(){window._dailyCallMachineLoadWaitlist||(window._dailyCallMachineLoadWaitlist=new Set);var e=mn(this._dailyConfig);(typeof document>"u"?"undefined":z(document))==="object"?this._startLoading(e):this._failureCallback({msg:"Call object bundle must be loaded in a DOM/web context",type:"missing context"})}},{key:"cancel",value:function(){this._stopLoading(),this.cancelled=!0}},{key:"_startLoading",value:function(e){var n=this;this._signUpForCallMachineLoadWaitlist(),this._networkTimeout=setTimeout(function(){n._stopLoading(),n._failureCallback({msg:"Timed out (>".concat(wn," ms) when loading call object bundle ").concat(e),type:"timeout"})},wn);var r=document.getElementsByTagName("head")[0],i=document.createElement("script");this._scriptElement=i,i.onload=function(){n._stopLoading(),n.succeeded=!0,n._successCallback()},i.onerror=function(a){n._stopLoading(),n._failureCallback({msg:"Failed to load call object bundle ".concat(a.target.src),type:a.message})},i.src=e,r.appendChild(i)}},{key:"_stopLoading",value:function(){this._withdrawFromCallMachineLoadWaitlist(),clearTimeout(this._networkTimeout),this._scriptElement&&(this._scriptElement.onload=null,this._scriptElement.onerror=null)}},{key:"_signUpForCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.add(this._attemptId)}},{key:"_withdrawFromCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.delete(this._attemptId)}}]),t}(),on=function(t,e,n){return ql(t.local,e,n)===!0},Jl=function(t,e,n){return t.local.streams&&t.local.streams[e]&&t.local.streams[e].stream&&t.local.streams[e].stream["get".concat(n==="video"?"Video":"Audio","Tracks")]()[0]},_t=function(t,e,n,r){var i=Vl(t,e,n,r);return i&&i.pendingTrack},ql=function(t,e,n){if(!t)return!1;var r=function(a){switch(a){case"avatar":return!0;case"staged":return a;default:return!!a}},i=t.public.subscribedTracks;return i&&i[e]?["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo"].indexOf(n)===-1&&i[e].custom?[!0,"staged"].includes(i[e].custom)?r(i[e].custom):r(i[e].custom[n]):r(i[e][n]):!i||r(i.ALL)},Vl=function(t,e,n,r){var i=Object.values(t.streams||{}).filter(function(a){return a.participantId===e&&a.type===n&&a.pendingTrack&&a.pendingTrack.kind===r}).sort(function(a,o){return new Date(o.starttime)-new Date(a.starttime)});return i&&i[0]},Wl=function(t,e){var n=t.local.public.customTracks;if(n&&n[e])return n[e].track};function Ca(t,e){for(var n=e.getState(),r=0,i=["cam","screen"];r<i.length;r++)for(var a=i[r],o=0,l=["video","audio"];o<l.length;o++){var c=l[o],h=a==="cam"?c:"screen".concat(c.charAt(0).toUpperCase()+c.slice(1)),p=t.tracks[h];if(p){var g=t.local?Jl(n,a,c):_t(n,t.session_id,a,c);p.state==="playable"&&(p.track=g),p.persistentTrack=g}}}function Ea(t,e){try{var n=e.getState();for(var r in t.tracks)if(!zl(r)){var i=t.tracks[r].kind;if(i){var a=t.tracks[r];if(a){var o=t.local?Wl(n,r):_t(n,t.session_id,r,i);a.state==="playable"&&(t.tracks[r].track=o),a.persistentTrack=o}}else console.error("unknown type for custom track")}}catch(l){console.error(l)}}function zl(t){return["video","audio","screenVideo","screenAudio"].includes(t)}function Ma(t,e,n){var r=n.getState();if(t.local){if(t.audio)try{t.audioTrack=r.local.streams.cam.stream.getAudioTracks()[0],t.audioTrack||(t.audio=!1)}catch{}if(t.video)try{t.videoTrack=r.local.streams.cam.stream.getVideoTracks()[0],t.videoTrack||(t.video=!1)}catch{}if(t.screen)try{t.screenVideoTrack=r.local.streams.screen.stream.getVideoTracks()[0],t.screenAudioTrack=r.local.streams.screen.stream.getAudioTracks()[0],t.screenVideoTrack||t.screenAudioTrack||(t.screen=!1)}catch{}}else{var i=!0;try{var a=r.participants[t.session_id];a&&a.public&&a.public.rtcType&&a.public.rtcType.impl==="peer-to-peer"&&a.private&&!["connected","completed"].includes(a.private.peeringState)&&(i=!1)}catch(p){console.error(p)}if(!i)return t.audio=!1,t.audioTrack=!1,t.video=!1,t.videoTrack=!1,t.screen=!1,void(t.screenTrack=!1);try{if(r.streams,t.audio&&on(r,t.session_id,"cam-audio")){var o=_t(r,t.session_id,"cam","audio");o&&(e&&e.audioTrack&&e.audioTrack.id===o.id?t.audioTrack=o:o.muted||(t.audioTrack=o)),t.audioTrack||(t.audio=!1)}if(t.video&&on(r,t.session_id,"cam-video")){var l=_t(r,t.session_id,"cam","video");l&&(e&&e.videoTrack&&e.videoTrack.id===l.id?t.videoTrack=l:l.muted||(t.videoTrack=l)),t.videoTrack||(t.video=!1)}if(t.screen&&on(r,t.session_id,"screen-audio")){var c=_t(r,t.session_id,"screen","audio");c&&(e&&e.screenAudioTrack&&e.screenAudioTrack.id===c.id?t.screenAudioTrack=c:c.muted||(t.screenAudioTrack=c))}if(t.screen&&on(r,t.session_id,"screen-video")){var h=_t(r,t.session_id,"screen","video");h&&(e&&e.screenVideoTrack&&e.screenVideoTrack.id===h.id?t.screenVideoTrack=h:h.muted||(t.screenVideoTrack=h))}t.screenVideoTrack||t.screenAudioTrack||(t.screen=!1)}catch(p){console.error("unexpected error matching up tracks",p)}}}function Gl(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(c,h){if(c){if(typeof c=="string")return Ta(c,h);var p=Object.prototype.toString.call(c).slice(8,-1);if(p==="Object"&&c.constructor&&(p=c.constructor.name),p==="Map"||p==="Set")return Array.from(c);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return Ta(c,h)}}(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return o=c.done,c},e:function(c){l=!0,a=c},f:function(){try{o||n.return==null||n.return()}finally{if(l)throw a}}}}function Ta(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Me=new Map,wt=null;function Hl(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(c,h){if(c){if(typeof c=="string")return Oa(c,h);var p=Object.prototype.toString.call(c).slice(8,-1);if(p==="Object"&&c.constructor&&(p=c.constructor.name),p==="Map"||p==="Set")return Array.from(c);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return Oa(c,h)}}(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return o=c.done,c},e:function(c){l=!0,a=c},f:function(){try{o||n.return==null||n.return()}finally{if(l)throw a}}}}function Oa(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Te=new Map,Ft=null;function Ql(t){Os()?function(e){Me.has(e)||(Me.set(e,{}),navigator.mediaDevices.enumerateDevices().then(function(n){Me.has(e)&&(Me.get(e).lastDevicesString=JSON.stringify(n),wt||(wt=function(){var r=D(function*(){var i,a=yield navigator.mediaDevices.enumerateDevices(),o=Gl(Me.keys());try{for(o.s();!(i=o.n()).done;){var l=i.value,c=JSON.stringify(a);c!==Me.get(l).lastDevicesString&&(Me.get(l).lastDevicesString=c,l(a))}}catch(h){o.e(h)}finally{o.f()}});return function(){return r.apply(this,arguments)}}(),navigator.mediaDevices.addEventListener("devicechange",wt)))}).catch(function(){}))}(t):function(e){Te.has(e)||(Te.set(e,{}),navigator.mediaDevices.enumerateDevices().then(function(n){Te.has(e)&&(Te.get(e).lastDevicesString=JSON.stringify(n),Ft||(Ft=setInterval(D(function*(){var r,i=yield navigator.mediaDevices.enumerateDevices(),a=Hl(Te.keys());try{for(a.s();!(r=a.n()).done;){var o=r.value,l=JSON.stringify(i);l!==Te.get(o).lastDevicesString&&(Te.get(o).lastDevicesString=l,o(i))}}catch(c){a.e(c)}finally{a.f()}}),3e3)))}))}(t)}function Kl(t){Os()?function(e){Me.has(e)&&(Me.delete(e),Me.size===0&&wt&&(navigator.mediaDevices.removeEventListener("devicechange",wt),wt=null))}(t):function(e){Te.has(e)&&(Te.delete(e),Te.size===0&&Ft&&(clearInterval(Ft),Ft=null))}(t)}function Os(){return q()||navigator.mediaDevices.ondevicechange!==void 0}var Yl=new Set;function Xl(t,e){return t&&t.readyState==="live"&&!function(n,r){return n.muted&&!Yl.has(n.id)}(t)}var Zl=["result"],eu=["preserveIframe"];function Aa(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Aa(Object(n),!0).forEach(function(r){je(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Aa(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function tu(t){var e=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var n,r=Se(t);if(e){var i=Se(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return En(this,n)}}function Pa(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(c,h){if(c){if(typeof c=="string")return La(c,h);var p=Object.prototype.toString.call(c).slice(8,-1);if(p==="Object"&&c.constructor&&(p=c.constructor.name),p==="Map"||p==="Set")return Array.from(c);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return La(c,h)}}(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return o=c.done,c},e:function(c){l=!0,a=c},f:function(){try{o||n.return==null||n.return()}finally{if(l)throw a}}}}function La(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var nt={},xa="video",nu="voice",ja=q()?{data:{}}:{data:{},topology:"none"},Da={present:0,hidden:0},As={maxBitrate:{min:1e5,max:25e5},maxFramerate:{min:1,max:30},scaleResolutionDownBy:{min:1,max:8}},Kn=Object.keys(As),Ia=["state","volume","simulcastEncodings"],Na={androidInCallNotification:{title:"string",subtitle:"string",iconName:"string",disableForCustomOverride:"boolean"},disableAutoDeviceManagement:{audio:"boolean",video:"boolean"}},kn={id:{iconPath:"string",iconPathDarkMode:"string",label:"string",tooltip:"string",visualState:"'default' | 'sidebar-open' | 'active'"}},wr={id:{allow:"string",controlledBy:"'*' | 'owners' | string[]",csp:"string",iconURL:"string",label:"string",loading:"'eager' | 'lazy'",location:"'main' | 'sidebar'",name:"string",referrerPolicy:"string",sandbox:"string",src:"string",srcdoc:"string",shared:"string[] | 'owners' | boolean"}},rt={customIntegrations:{validate:Rs,help:Is()},customTrayButtons:{validate:Ns,help:"customTrayButtons should be a dictionary of the type ".concat(JSON.stringify(kn))},url:{validate:function(t){return typeof t=="string"},help:"url should be a string"},baseUrl:{validate:function(t){return typeof t=="string"},help:"baseUrl should be a string"},token:{validate:function(t){return typeof t=="string"},help:"token should be a string",queryString:"t"},dailyConfig:{validate:function(t,e){try{return e.validateDailyConfig(t),!0}catch(n){console.error("Failed to validate dailyConfig",n)}return!1},help:"Unsupported dailyConfig. Check error logs for detailed info."},reactNativeConfig:{validate:function(t){return Bs(t,Na)},help:"reactNativeConfig should look like ".concat(JSON.stringify(Na),", all fields optional")},lang:{validate:function(t){return["da","de","en-us","en","es","fi","fr","it","jp","ka","nl","no","pl","pt","pt-BR","ru","sv","tr","user"].includes(t)},help:"language not supported. Options are: da, de, en-us, en, es, fi, fr, it, jp, ka, nl, no, pl, pt, pt-BR, ru, sv, tr, user"},userName:!0,userData:{validate:function(t){try{return Ps(t),!0}catch(e){return console.error(e),!1}},help:"invalid userData type provided"},startVideoOff:!0,startAudioOff:!0,activeSpeakerMode:!0,showLeaveButton:!0,showLocalVideo:!0,showParticipantsBar:!0,showFullscreenButton:!0,showUserNameChangeUI:!0,iframeStyle:!0,customLayout:!0,cssFile:!0,cssText:!0,bodyClass:!0,videoSource:{validate:function(t,e){return t instanceof MediaStreamTrack&&(e._sharedTracks.videoDeviceId=t),e._preloadCache.videoDeviceId=t,!0}},audioSource:{validate:function(t,e){return t instanceof MediaStreamTrack&&(e._sharedTracks.audioDeviceId=t),e._preloadCache.audioDeviceId=t,!0}},subscribeToTracksAutomatically:{validate:function(t,e){return e._preloadCache.subscribeToTracksAutomatically=t,!0}},theme:{validate:function(t){var e=["accent","accentText","background","backgroundAccent","baseText","border","mainAreaBg","mainAreaBgAccent","mainAreaText","supportiveText"],n=function(r){for(var i=0,a=Object.keys(r);i<a.length;i++){var o=a[i];if(!e.includes(o))return console.error('unsupported color "'.concat(o,'". Valid colors: ').concat(e.join(", "))),!1;if(!r[o].match(/^#[0-9a-f]{6}|#[0-9a-f]{3}$/i))return console.error("".concat(o,' theme color should be provided in valid hex color format. Received: "').concat(r[o],'"')),!1}return!0};return z(t)==="object"&&("light"in t&&"dark"in t||"colors"in t)?"light"in t&&"dark"in t?"colors"in t.light?"colors"in t.dark?n(t.light.colors)&&n(t.dark.colors):(console.error('Dark theme is missing "colors" property.',t),!1):(console.error('Light theme is missing "colors" property.',t),!1):n(t.colors):(console.error('Theme must contain either both "light" and "dark" properties, or "colors".',t),!1)},help:"unsupported theme configuration. Check error logs for detailed info."},layoutConfig:{validate:function(t){if("grid"in t){var e=t.grid;if("maxTilesPerPage"in e){if(!Number.isInteger(e.maxTilesPerPage))return console.error("grid.maxTilesPerPage should be an integer. You passed ".concat(e.maxTilesPerPage,".")),!1;if(e.maxTilesPerPage>49)return console.error("grid.maxTilesPerPage can't be larger than 49 without sacrificing browser performance. Please contact us at https://www.daily.co/contact to talk about your use case."),!1}if("minTilesPerPage"in e){if(!Number.isInteger(e.minTilesPerPage))return console.error("grid.minTilesPerPage should be an integer. You passed ".concat(e.minTilesPerPage,".")),!1;if(e.minTilesPerPage<1)return console.error("grid.minTilesPerPage can't be lower than 1."),!1;if("maxTilesPerPage"in e&&e.minTilesPerPage>e.maxTilesPerPage)return console.error("grid.minTilesPerPage can't be higher than grid.maxTilesPerPage."),!1}}return!0},help:"unsupported layoutConfig. Check error logs for detailed info."},receiveSettings:{validate:function(t){return Ls(t,{allowAllParticipantsKey:!1})},help:Ds({allowAllParticipantsKey:!1})},sendSettings:{validate:function(t,e){return!!function(n,r){try{return r.validateUpdateSendSettings(n),!0}catch(i){return console.error("Failed to validate send settings",i),!1}}(t,e)&&(e._preloadCache.sendSettings=t,!0)},help:"Invalid sendSettings provided. Check error logs for detailed info."},inputSettings:{validate:function(t,e){var n;return!!xs(t)&&(e._preloadCache.inputSettings||(e._preloadCache.inputSettings={}),js(t,(n=e.properties)===null||n===void 0?void 0:n.dailyConfig),t.audio&&(e._preloadCache.inputSettings.audio=t.audio),t.video&&(e._preloadCache.inputSettings.video=t.video),!0)},help:kr()},layout:{validate:function(t){return t==="custom-v1"||t==="browser"||t==="none"},help:'layout may only be set to "custom-v1"',queryString:"layout"},emb:{queryString:"emb"},embHref:{queryString:"embHref"},dailyJsVersion:{queryString:"dailyJsVersion"},proxy:{queryString:"proxy"},strictMode:!0,allowMultipleCallInstances:!0},cn={styles:{validate:function(t){for(var e in t)if(e!=="cam"&&e!=="screen")return!1;if(t.cam){for(var n in t.cam)if(n!=="div"&&n!=="video")return!1}if(t.screen){for(var r in t.screen)if(r!=="div"&&r!=="video")return!1}return!0},help:"styles format should be a subset of: { cam: {div: {}, video: {}}, screen: {div: {}, video: {}} }"},setSubscribedTracks:{validate:function(t,e){if(e._preloadCache.subscribeToTracksAutomatically)return!1;var n=[!0,!1,"staged"];if(n.includes(t)||!q()&&t==="avatar")return!0;var r=["audio","video","screenAudio","screenVideo","rmpAudio","rmpVideo"];return function i(a){var o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];for(var l in a)if(l==="custom"){if(!n.includes(a[l])&&!i(a[l],!0))return!1}else{var c=!o&&!r.includes(l),h=!n.includes(a[l]);if(c||h)return!1}return!0}(t)},help:"setSubscribedTracks cannot be used when setSubscribeToTracksAutomatically is enabled, and should be of the form: "+"true".concat(q()?"":" | 'avatar'"," | false | 'staged' | { [audio: true|false|'staged'], [video: true|false|'staged'], [screenAudio: true|false|'staged'], [screenVideo: true|false|'staged'] }")},setAudio:!0,setVideo:!0,setScreenShare:{validate:function(t){return t===!1},help:"setScreenShare must be false, as it's only meant for stopping remote participants' screen shares"},eject:!0,updatePermissions:{validate:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var r=ut(n[e],2),i=r[0],a=r[1];switch(i){case"hasPresence":if(typeof a!="boolean")return!1;break;case"canSend":if(a instanceof Set||a instanceof Array||Array.isArray(a)){var o,l=["video","audio","screenVideo","screenAudio","customVideo","customAudio"],c=Pa(a);try{for(c.s();!(o=c.n()).done;){var h=o.value;if(!l.includes(h))return!1}}catch(v){c.e(v)}finally{c.f()}}else if(typeof a!="boolean")return!1;(a instanceof Array||Array.isArray(a))&&(t.canSend=new Set(a));break;case"canAdmin":if(a instanceof Set||a instanceof Array||Array.isArray(a)){var p,g=["participants","streaming","transcription"],_=Pa(a);try{for(_.s();!(p=_.n()).done;){var C=p.value;if(!g.includes(C))return!1}}catch(v){_.e(v)}finally{_.f()}}else if(typeof a!="boolean")return!1;(a instanceof Array||Array.isArray(a))&&(t.canAdmin=new Set(a));break;default:return!1}}return!0},help:"updatePermissions can take hasPresence, canSend, and canAdmin permissions. hasPresence must be a boolean. canSend can be a boolean or an Array or Set of media types (video, audio, screenVideo, screenAudio, customVideo, customAudio). canAdmin can be a boolean or an Array or Set of admin types (participants, streaming, transcription)."}};Promise.any||(Promise.any=function(){var t=D(function*(e){return new Promise(function(n,r){var i=[];e.forEach(function(a){return Promise.resolve(a).then(function(o){n(o)}).catch(function(o){i.push(o),i.length===e.length&&r(i)})})})});return function(e){return t.apply(this,arguments)}}());var Ra=function(){Cn(ae,De);var t,e,n,r,i,a,o,l,c,h,p,g,_,C,v,w,O,A,x,N,k,b,E,T,P,F,R,ee,ge,Ce,He,Qe,At,Ke,Pt,Ye,Lt,Xe,zt=tu(ae);function ae(s){var u,d,m,f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(we(this,ae),je(Le(d=zt.call(this)),"startListeningForDeviceChanges",function(){Ql(d.handleDeviceChange)}),je(Le(d),"stopListeningForDeviceChanges",function(){Kl(d.handleDeviceChange)}),je(Le(d),"handleDeviceChange",function(M){M=M.map(function(L){return JSON.parse(JSON.stringify(L))}),d.emitDailyJSEvent({action:"available-devices-updated",availableDevices:M})}),je(Le(d),"handleNativeAppStateChange",function(){var M=D(function*(L){if(L==="destroyed")return console.warn("App has been destroyed before leaving the meeting. Cleaning up all the resources!"),void(yield d.destroy());var $=L==="active";d.disableReactNativeAutoDeviceManagement("video")||($?d.camUnmutedBeforeLosingNativeActiveState&&d.setLocalVideo(!0):(d.camUnmutedBeforeLosingNativeActiveState=d.localVideo(),d.camUnmutedBeforeLosingNativeActiveState&&d.setLocalVideo(!1)))});return function(L){return M.apply(this,arguments)}}()),je(Le(d),"handleNativeAudioFocusChange",function(M){d.disableReactNativeAutoDeviceManagement("audio")||(d._hasNativeAudioFocus=M,d.toggleParticipantAudioBasedOnNativeAudioFocus(),d._hasNativeAudioFocus?d.micUnmutedBeforeLosingNativeAudioFocus&&d.setLocalAudio(!0):(d.micUnmutedBeforeLosingNativeAudioFocus=d.localAudio(),d.setLocalAudio(!1)))}),je(Le(d),"handleNativeSystemScreenCaptureStop",function(){d.stopScreenShare()}),d.strictMode=f.strictMode===void 0||f.strictMode,d.allowMultipleCallInstances=(u=f.allowMultipleCallInstances)!==null&&u!==void 0&&u,Object.keys(nt).length&&(d._logDuplicateInstanceAttempt(),!d.allowMultipleCallInstances)){if(d.strictMode)throw new Error("Duplicate DailyIframe instances are not allowed");console.warn("Using strictMode: false to allow multiple call instances is now deprecated. Set `allowMultipleCallInstances: true`")}if(window._daily||(window._daily={pendings:[],instances:{}}),d.callClientId=Mn(),m=Le(d),nt[m.callClientId]=m,window._daily.instances[d.callClientId]={},d._sharedTracks={},window._daily.instances[d.callClientId].tracks=d._sharedTracks,f.dailyJsVersion=ae.version(),d._iframe=s,d._callObjectMode=f.layout==="none"&&!d._iframe,d._preloadCache={subscribeToTracksAutomatically:!0,audioDeviceId:null,videoDeviceId:null,outputDeviceId:null,inputSettings:null,sendSettings:null,videoTrackForNetworkConnectivityTest:null,videoTrackForConnectionQualityTest:null},f.showLocalVideo!==void 0?d._callObjectMode?console.error("showLocalVideo is not available in call object mode"):d._showLocalVideo=!!f.showLocalVideo:d._showLocalVideo=!0,f.showParticipantsBar!==void 0?d._callObjectMode?console.error("showParticipantsBar is not available in call object mode"):d._showParticipantsBar=!!f.showParticipantsBar:d._showParticipantsBar=!0,f.customIntegrations!==void 0?d._callObjectMode?console.error("customIntegrations is not available in call object mode"):d._customIntegrations=f.customIntegrations:d._customIntegrations={},f.customTrayButtons!==void 0?d._callObjectMode?console.error("customTrayButtons is not available in call object mode"):d._customTrayButtons=f.customTrayButtons:d._customTrayButtons={},f.activeSpeakerMode!==void 0?d._callObjectMode?console.error("activeSpeakerMode is not available in call object mode"):d._activeSpeakerMode=!!f.activeSpeakerMode:d._activeSpeakerMode=!1,f.receiveSettings?d._callObjectMode?d._receiveSettings=f.receiveSettings:console.error("receiveSettings is only available in call object mode"):d._receiveSettings={},d.validateProperties(f),d.properties=I({},f),d._preloadCache.inputSettings||(d._preloadCache.inputSettings={}),f.inputSettings&&f.inputSettings.audio&&(d._preloadCache.inputSettings.audio=f.inputSettings.audio),f.inputSettings&&f.inputSettings.video&&(d._preloadCache.inputSettings.video=f.inputSettings.video),d._callObjectLoader=d._callObjectMode?new Bl(d.callClientId):null,d._callState=ra,d._isPreparingToJoin=!1,d._accessState={access:Vn},d._meetingSessionSummary={},d._finalSummaryOfPrevSession={},d._meetingSessionState=Zn(ja,d._callObjectMode),d._nativeInCallAudioMode=xa,d._participants={},d._isScreenSharing=!1,d._participantCounts=Da,d._rmpPlayerState={},d._waitingParticipants={},d._network={threshold:"good",quality:100},d._activeSpeaker={},d._localAudioLevel=0,d._isLocalAudioLevelObserverRunning=!1,d._remoteParticipantsAudioLevel={},d._isRemoteParticipantsAudioLevelObserverRunning=!1,d._maxAppMessageSize=Wn,d._messageChannel=q()?new Il:new jl,d._iframe&&(d._iframe.requestFullscreen?d._iframe.addEventListener("fullscreenchange",function(){document.fullscreenElement===d._iframe?(d.emitDailyJSEvent({action:rn}),d.sendMessageToCallMachine({action:rn})):(d.emitDailyJSEvent({action:an}),d.sendMessageToCallMachine({action:an}))}):d._iframe.webkitRequestFullscreen&&d._iframe.addEventListener("webkitfullscreenchange",function(){document.webkitFullscreenElement===d._iframe?(d.emitDailyJSEvent({action:rn}),d.sendMessageToCallMachine({action:rn})):(d.emitDailyJSEvent({action:an}),d.sendMessageToCallMachine({action:an}))})),q()){var y=d.nativeUtils();y.addAudioFocusChangeListener&&y.removeAudioFocusChangeListener&&y.addAppStateChangeListener&&y.removeAppStateChangeListener&&y.addSystemScreenCaptureStopListener&&y.removeSystemScreenCaptureStopListener||console.warn("expected (add|remove)(AudioFocusChange|AppActiveStateChange|SystemScreenCaptureStop)Listener to be available in React Native"),d._hasNativeAudioFocus=!0,y.addAudioFocusChangeListener(d.handleNativeAudioFocusChange),y.addAppStateChangeListener(d.handleNativeAppStateChange),y.addSystemScreenCaptureStopListener(d.handleNativeSystemScreenCaptureStop)}return d._callObjectMode&&d.startListeningForDeviceChanges(),d._messageChannel.addListenerForMessagesFromCallMachine(d.handleMessageFromCallMachine,d.callClientId,Le(d)),d}return ke(ae,[{key:"destroy",value:(Xe=D(function*(){var s,u;try{yield this.leave()}catch{}var d=this._iframe;if(d){var m=d.parentElement;m&&m.removeChild(d)}if(this._messageChannel.removeListener(this.handleMessageFromCallMachine),q()){var f=this.nativeUtils();f.removeAudioFocusChangeListener(this.handleNativeAudioFocusChange),f.removeAppStateChangeListener(this.handleNativeAppStateChange),f.removeSystemScreenCaptureStopListener(this.handleNativeSystemScreenCaptureStop)}this._callObjectMode&&this.stopListeningForDeviceChanges(),this.resetMeetingDependentVars(),this._destroyed=!0,this.emitDailyJSEvent({action:"call-instance-destroyed"}),delete nt[this.callClientId],!((s=window)===null||s===void 0||(u=s._daily)===null||u===void 0)&&u.instances&&delete window._daily.instances[this.callClientId],this.strictMode&&(this.callClientId=void 0)}),function(){return Xe.apply(this,arguments)})},{key:"isDestroyed",value:function(){return!!this._destroyed}},{key:"loadCss",value:function(s){var u=s.bodyClass,d=s.cssFile,m=s.cssText;return U(),this.sendMessageToCallMachine({action:"load-css",cssFile:this.absoluteUrl(d),bodyClass:u,cssText:m}),this}},{key:"iframe",value:function(){return U(),this._iframe}},{key:"meetingState",value:function(){return this._callState}},{key:"accessState",value:function(){return ve(this._callObjectMode,"accessState()"),this._accessState}},{key:"participants",value:function(){return this._participants}},{key:"participantCounts",value:function(){return this._participantCounts}},{key:"waitingParticipants",value:function(){return ve(this._callObjectMode,"waitingParticipants()"),this._waitingParticipants}},{key:"validateParticipantProperties",value:function(s,u){for(var d in u){if(!cn[d])throw new Error("unrecognized updateParticipant property ".concat(d));if(cn[d].validate&&!cn[d].validate(u[d],this,this._participants[s]))throw new Error(cn[d].help)}}},{key:"updateParticipant",value:function(s,u){return this._participants.local&&this._participants.local.session_id===s&&(s="local"),s&&u&&(this.validateParticipantProperties(s,u),this.sendMessageToCallMachine({action:"update-participant",id:s,properties:u})),this}},{key:"updateParticipants",value:function(s){var u=this._participants.local&&this._participants.local.session_id;for(var d in s)d===u&&(d="local"),d&&s[d]&&this.validateParticipantProperties(d,s[d]);return this.sendMessageToCallMachine({action:"update-participants",participants:s}),this}},{key:"updateWaitingParticipant",value:(Lt=D(function*(){var s=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ve(this._callObjectMode,"updateWaitingParticipant()"),H(this._callState,"updateWaitingParticipant()"),typeof u!="string"||z(d)!=="object")throw new Error("updateWaitingParticipant() must take an id string and a updates object");return new Promise(function(m,f){s.sendMessageToCallMachine({action:"daily-method-update-waiting-participant",id:u,updates:d},function(y){y.error&&f(y.error),y.id||f(new Error("unknown error in updateWaitingParticipant()")),m({id:y.id})})})}),function(){return Lt.apply(this,arguments)})},{key:"updateWaitingParticipants",value:(Ye=D(function*(){var s=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ve(this._callObjectMode,"updateWaitingParticipants()"),H(this._callState,"updateWaitingParticipants()"),z(u)!=="object")throw new Error("updateWaitingParticipants() must take a mapping between ids and update objects");return new Promise(function(d,m){s.sendMessageToCallMachine({action:"daily-method-update-waiting-participants",updatesById:u},function(f){f.error&&m(f.error),f.ids||m(new Error("unknown error in updateWaitingParticipants()")),d({ids:f.ids})})})}),function(){return Ye.apply(this,arguments)})},{key:"requestAccess",value:(Pt=D(function*(){var s=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=u.access,m=d===void 0?{level:Oc}:d,f=u.name,y=f===void 0?"":f;return ve(this._callObjectMode,"requestAccess()"),H(this._callState,"requestAccess()"),new Promise(function(M,L){s.sendMessageToCallMachine({action:"daily-method-request-access",access:m,name:y},function($){$.error&&L($.error),$.access||L(new Error("unknown error in requestAccess()")),M({access:$.access,granted:$.granted})})})}),function(){return Pt.apply(this,arguments)})},{key:"localAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.audio.state):null}},{key:"localVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.video.state):null}},{key:"setLocalAudio",value:function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"forceDiscardTrack"in u&&(q()?(console.warn("forceDiscardTrack option not supported in React Native; ignoring"),u={}):s&&(console.warn("forceDiscardTrack option only supported when calling setLocalAudio(false); ignoring"),u={})),this.sendMessageToCallMachine({action:"local-audio",state:s,options:u}),this}},{key:"localScreenAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenAudio.state):null}},{key:"localScreenVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenVideo.state):null}},{key:"updateScreenShare",value:function(s){if(this._isScreenSharing)return this.sendMessageToCallMachine({action:"local-screen-update",options:s}),this;console.warn("There is no screen share in progress. Try calling startScreenShare first.")}},{key:"setLocalVideo",value:function(s){return this.sendMessageToCallMachine({action:"local-video",state:s}),this}},{key:"getReceiveSettings",value:(Ke=D(function*(s){var u=this,d=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).showInheritedValues,m=d!==void 0&&d;if(ve(this._callObjectMode,"getReceiveSettings()"),!this._callMachineInitialized)return this._receiveSettings;switch(z(s)){case"string":return new Promise(function(f){u.sendMessageToCallMachine({action:"get-single-participant-receive-settings",id:s,showInheritedValues:m},function(y){f(y.receiveSettings)})});case"undefined":return this._receiveSettings;default:throw new Error('first argument to getReceiveSettings() must be a participant id (or "base"), or there should be no arguments')}}),function(s){return Ke.apply(this,arguments)})},{key:"updateReceiveSettings",value:(At=D(function*(s){var u=this;if(ve(this._callObjectMode,"updateReceiveSettings()"),!Ls(s,{allowAllParticipantsKey:!0}))throw new Error(Ds({allowAllParticipantsKey:!0}));return H(this._callState,"updateReceiveSettings()","To specify receive settings earlier, use the receiveSettings config property."),new Promise(function(d){u.sendMessageToCallMachine({action:"update-receive-settings",receiveSettings:s},function(m){d({receiveSettings:m.receiveSettings})})})}),function(s){return At.apply(this,arguments)})},{key:"_prepInputSettingsToPresentToUser",value:function(s){var u,d,m,f,y,M,L,$;if(s){var te={},Y=((u=s.audio)===null||u===void 0||(d=u.processor)===null||d===void 0?void 0:d.type)==="none"&&((m=s.audio)===null||m===void 0||(f=m.processor)===null||f===void 0?void 0:f._isDefaultWhenNone);if(s.audio&&!Y){var Oe=I({},s.audio.processor);delete Oe._isDefaultWhenNone,te.audio=I(I({},s.audio),{},{processor:Oe})}var Re=((y=s.video)===null||y===void 0||(M=y.processor)===null||M===void 0?void 0:M.type)==="none"&&((L=s.video)===null||L===void 0||($=L.processor)===null||$===void 0?void 0:$._isDefaultWhenNone);if(s.video&&!Re){var Ae=I({},s.video.processor);delete Ae._isDefaultWhenNone,te.video=I(I({},s.video),{},{processor:Ae})}return te}}},{key:"getInputSettings",value:function(){var s=this;return U(),new Promise(function(u){u(s._getInputSettings())})}},{key:"_getInputSettings",value:function(){var s,u,d,m,f,y,M,L,$={processor:{type:"none",_isDefaultWhenNone:!0}};this._inputSettings?(s=((d=this._inputSettings)===null||d===void 0?void 0:d.video)||$,u=((m=this._inputSettings)===null||m===void 0?void 0:m.audio)||$):(s=((f=this._preloadCache)===null||f===void 0||(y=f.inputSettings)===null||y===void 0?void 0:y.video)||$,u=((M=this._preloadCache)===null||M===void 0||(L=M.inputSettings)===null||L===void 0?void 0:L.audio)||$);var te={audio:u,video:s};return this._prepInputSettingsToPresentToUser(te)}},{key:"updateInputSettings",value:(Qe=D(function*(s){var u=this;return U(),xs(s)?(s&&(this._preloadCache.inputSettings||(this._preloadCache.inputSettings={}),js(s,this.properties.dailyConfig),s.audio&&(this._preloadCache.inputSettings.audio=s.audio),s.video&&(this._preloadCache.inputSettings.video=s.video)),s.video||s.audio?this._callObjectMode&&!this._callMachineInitialized?this._getInputSettings():new Promise(function(d,m){u.sendMessageToCallMachine({action:"update-input-settings",inputSettings:s},function(f){f.error?m(f.error):d({inputSettings:u._prepInputSettingsToPresentToUser(f.inputSettings)})})}):this._getInputSettings()):(console.error(kr()),Promise.reject(kr()))}),function(s){return Qe.apply(this,arguments)})},{key:"setBandwidth",value:function(s){var u=s.kbs,d=s.trackConstraints;if(U(),this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-bandwidth",kbs:u,trackConstraints:d}),this}},{key:"getDailyLang",value:function(){var s=this;if(U(),this._callMachineInitialized)return new Promise(function(u){s.sendMessageToCallMachine({action:"get-daily-lang"},function(d){delete d.action,delete d.callbackStamp,u(d)})})}},{key:"setDailyLang",value:function(s){return U(),this.sendMessageToCallMachine({action:"set-daily-lang",lang:s}),this}},{key:"setProxyUrl",value:function(s){return this.sendMessageToCallMachine({action:"set-proxy-url",proxyUrl:s}),this}},{key:"setIceConfig",value:function(s){return this.sendMessageToCallMachine({action:"set-ice-config",iceConfig:s}),this}},{key:"meetingSessionSummary",value:function(){return[tt,Be].includes(this._callState)?this._finalSummaryOfPrevSession:this._meetingSessionSummary}},{key:"getMeetingSession",value:(He=D(function*(){var s=this;return console.warn("getMeetingSession() is deprecated: use meetingSessionSummary(), which will return immediately"),H(this._callState,"getMeetingSession()"),new Promise(function(u){s.sendMessageToCallMachine({action:"get-meeting-session"},function(d){delete d.action,delete d.callbackStamp,u(d)})})}),function(){return He.apply(this,arguments)})},{key:"meetingSessionState",value:function(){return H(this._callState,"meetingSessionState"),this._meetingSessionState}},{key:"setMeetingSessionData",value:function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"replace";ve(this._callObjectMode,"setMeetingSessionData()"),H(this._callState,"setMeetingSessionData");try{(function(d,m){new Nl({data:d,mergeStrategy:m})})(s,u)}catch(d){throw console.error(d),d}try{this.sendMessageToCallMachine({action:"set-session-data",data:s,mergeStrategy:u})}catch(d){throw new Error("Error setting meeting session data: ".concat(d))}}},{key:"setUserName",value:function(s,u){var d=this;return this.properties.userName=s,new Promise(function(m){d.sendMessageToCallMachine({action:"set-user-name",name:s??"",thisMeetingOnly:q()||!!u&&!!u.thisMeetingOnly},function(f){delete f.action,delete f.callbackStamp,m(f)})})}},{key:"setUserData",value:(Ce=D(function*(s){var u=this;try{Ps(s)}catch(d){throw console.error(d),d}if(this.properties.userData=s,this._callMachineInitialized)return new Promise(function(d){try{u.sendMessageToCallMachine({action:"set-user-data",userData:s},function(m){delete m.action,delete m.callbackStamp,d(m)})}catch(m){throw new Error("Error setting user data: ".concat(m))}})}),function(s){return Ce.apply(this,arguments)})},{key:"validateAudioLevelInterval",value:function(s){if(s&&(s<100||typeof s!="number"))throw new Error("The interval must be a number greater than or equal to 100 milliseconds.")}},{key:"startLocalAudioLevelObserver",value:function(s){var u=this;if(typeof AudioWorkletNode>"u"&&!q())throw new Error("startLocalAudioLevelObserver() is not supported on this browser");if(this.validateAudioLevelInterval(s),this._callMachineInitialized)return this._isLocalAudioLevelObserverRunning=!0,new Promise(function(d,m){u.sendMessageToCallMachine({action:"start-local-audio-level-observer",interval:s},function(f){u._isLocalAudioLevelObserverRunning=!f.error,f.error?m({error:f.error}):d()})});this._preloadCache.localAudioLevelObserver={enabled:!0,interval:s}}},{key:"isLocalAudioLevelObserverRunning",value:function(){return this._isLocalAudioLevelObserverRunning}},{key:"stopLocalAudioLevelObserver",value:function(){this._preloadCache.localAudioLevelObserver=null,this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-local-audio-level-observer"})}},{key:"startRemoteParticipantsAudioLevelObserver",value:function(s){var u=this;if(this.validateAudioLevelInterval(s),this._callMachineInitialized)return this._isRemoteParticipantsAudioLevelObserverRunning=!0,new Promise(function(d,m){u.sendMessageToCallMachine({action:"start-remote-participants-audio-level-observer",interval:s},function(f){u._isRemoteParticipantsAudioLevelObserverRunning=!f.error,f.error?m({error:f.error}):d()})});this._preloadCache.remoteParticipantsAudioLevelObserver={enabled:!0,interval:s}}},{key:"isRemoteParticipantsAudioLevelObserverRunning",value:function(){return this._isRemoteParticipantsAudioLevelObserverRunning}},{key:"stopRemoteParticipantsAudioLevelObserver",value:function(){this._preloadCache.remoteParticipantsAudioLevelObserver=null,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-remote-participants-audio-level-observer"})}},{key:"startCamera",value:(ge=D(function*(){var s=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ve(this._callObjectMode,"startCamera()"),Yn(this._callState,this._isPreparingToJoin,"startCamera()","Did you mean to use setLocalAudio() and/or setLocalVideo() instead?"),this.needsLoad())try{yield this.load(u)}catch(d){return Promise.reject(d)}else{if(this._didPreAuth){if(u.url&&u.url!==this.properties.url)return console.error("url in startCamera() is different than the one used in preAuth()"),Promise.reject();if(u.token&&u.token!==this.properties.token)return console.error("token in startCamera() is different than the one used in preAuth()"),Promise.reject()}this.validateProperties(u),this.properties=I(I({},this.properties),u)}return new Promise(function(d){s.sendMessageToCallMachine({action:"start-camera",properties:vt(s.properties,s.callClientId),preloadCache:vt(s._preloadCache,s.callClientId)},function(m){delete m.action,delete m.callbackStamp,d(m)})})}),function(){return ge.apply(this,arguments)})},{key:"validateCustomTrack",value:function(s,u,d){if(d&&d.length>50)throw new Error("Custom track `trackName` must not be more than 50 characters");if(u&&u!=="music"&&u!=="speech"&&!(u instanceof Object))throw new Error("Custom track `mode` must be either `music` | `speech` | `DailyMicAudioModeSettings` or `undefined`");if(d&&["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo","customVideoDefaults"].includes(d))throw new Error("Custom track `trackName` must not match a track name already used by daily: cam-audio, cam-video, customVideoDefaults, screen-video, screen-audio, rmpAudio, rmpVideo");if(!(s instanceof MediaStreamTrack))throw new Error("Custom tracks provided must be instances of MediaStreamTrack")}},{key:"startCustomTrack",value:function(){var s=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{track,mode,trackName};return U(),H(this._callState,"startCustomTrack()"),this.validateCustomTrack(u.track,u.mode,u.trackName),new Promise(function(d,m){s._sharedTracks.customTrack=u.track,u.track=Bt,s.sendMessageToCallMachine({action:"start-custom-track",properties:u},function(f){f.error?m({error:f.error}):d(f.mediaTag)})})}},{key:"stopCustomTrack",value:function(s){var u=this;return U(),H(this._callState,"stopCustomTrack()"),new Promise(function(d){u.sendMessageToCallMachine({action:"stop-custom-track",mediaTag:s},function(m){d(m.mediaTag)})})}},{key:"setCamera",value:function(s){var u=this;return Nt(),ln(this._callMachineInitialized,"setCamera()"),new Promise(function(d){u.sendMessageToCallMachine({action:"set-camera",cameraDeviceId:s},function(m){d({device:m.device})})})}},{key:"setAudioDevice",value:(ee=D(function*(s){return Nt(),this.nativeUtils().setAudioDevice(s),{deviceId:yield this.nativeUtils().getAudioDevice()}}),function(s){return ee.apply(this,arguments)})},{key:"cycleCamera",value:function(){var s=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise(function(d){s.sendMessageToCallMachine({action:"cycle-camera",properties:u},function(m){d({device:m.device})})})}},{key:"cycleMic",value:function(){var s=this;return U(),new Promise(function(u){s.sendMessageToCallMachine({action:"cycle-mic"},function(d){u({device:d.device})})})}},{key:"getCameraFacingMode",value:function(){var s=this;return Nt(),new Promise(function(u){s.sendMessageToCallMachine({action:"get-camera-facing-mode"},function(d){u(d.facingMode)})})}},{key:"setInputDevicesAsync",value:(R=D(function*(s){var u=this,d=s.audioDeviceId,m=s.videoDeviceId,f=s.audioSource,y=s.videoSource;return U(),f!==void 0&&(d=f),y!==void 0&&(m=y),d&&(this._preloadCache.audioDeviceId=d,this._sharedTracks.audioDeviceId=d),m&&(this._preloadCache.videoDeviceId=m,this._sharedTracks.videoDeviceId=m),this._callObjectMode&&this.needsLoad()?{camera:{deviceId:this._preloadCache.videoDeviceId},mic:{deviceId:this._preloadCache.audioDeviceId},speaker:{deviceId:this._preloadCache.outputDeviceId}}:(d instanceof MediaStreamTrack&&(d=Bt),m instanceof MediaStreamTrack&&(m=Bt),new Promise(function(M){u.sendMessageToCallMachine({action:"set-input-devices",audioDeviceId:d,videoDeviceId:m},function(L){delete L.action,delete L.callbackStamp,L.returnPreloadCache?M({camera:{deviceId:u._preloadCache.videoDeviceId},mic:{deviceId:u._preloadCache.audioDeviceId},speaker:{deviceId:u._preloadCache.outputDeviceId}}):M(L)})}))}),function(s){return R.apply(this,arguments)})},{key:"setOutputDeviceAsync",value:(F=D(function*(s){var u=this,d=s.outputDeviceId;return U(),d&&(this._preloadCache.outputDeviceId=d),this._callObjectMode&&this.needsLoad()?{camera:{deviceId:this._preloadCache.videoDeviceId},mic:{deviceId:this._preloadCache.audioDeviceId},speaker:{deviceId:this._preloadCache.outputDeviceId}}:new Promise(function(m){u.sendMessageToCallMachine({action:"set-output-device",outputDeviceId:d},function(f){delete f.action,delete f.callbackStamp,f.returnPreloadCache?m({camera:{deviceId:u._preloadCache.videoDeviceId},mic:{deviceId:u._preloadCache.audioDeviceId},speaker:{deviceId:u._preloadCache.outputDeviceId}}):m(f)})})}),function(s){return F.apply(this,arguments)})},{key:"getInputDevices",value:(P=D(function*(){var s=this;return this._callObjectMode&&this.needsLoad()?{camera:{deviceId:this._preloadCache.videoDeviceId},mic:{deviceId:this._preloadCache.audioDeviceId},speaker:{deviceId:this._preloadCache.outputDeviceId}}:new Promise(function(u){s.sendMessageToCallMachine({action:"get-input-devices"},function(d){delete d.action,delete d.callbackStamp,d.returnPreloadCache?u({camera:{deviceId:s._preloadCache.videoDeviceId},mic:{deviceId:s._preloadCache.audioDeviceId},speaker:{deviceId:s._preloadCache.outputDeviceId}}):u(d)})})}),function(){return P.apply(this,arguments)})},{key:"nativeInCallAudioMode",value:function(){return Nt(),this._nativeInCallAudioMode}},{key:"setNativeInCallAudioMode",value:function(s){if(Nt(),[xa,nu].includes(s)){if(s!==this._nativeInCallAudioMode)return this._nativeInCallAudioMode=s,!this.disableReactNativeAutoDeviceManagement("audio")&&fn(this._callState,this._isPreparingToJoin)&&this.nativeUtils().setAudioMode(this._nativeInCallAudioMode),this}else console.error("invalid in-call audio mode specified: ",s)}},{key:"preAuth",value:(T=D(function*(){var s=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ve(this._callObjectMode,"preAuth()"),Yn(this._callState,this._isPreparingToJoin,"preAuth()"),this.needsLoad()&&(yield this.load(u)),!u.url)throw new Error("preAuth() requires at least a url to be provided");return this.validateProperties(u),this.properties=I(I({},this.properties),u),new Promise(function(d,m){s.sendMessageToCallMachine({action:"daily-method-preauth",properties:vt(s.properties,s.callClientId),preloadCache:vt(s._preloadCache,s.callClientId)},function(f){return f.error?m(f.error):f.access?(s._didPreAuth=!0,void d({access:f.access})):m(new Error("unknown error in preAuth()"))})})}),function(){return T.apply(this,arguments)})},{key:"load",value:(E=D(function*(s){var u=this;if(this.needsLoad()){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");if(s&&(this.validateProperties(s),this.properties=I(I({},this.properties),s)),!this._callObjectMode&&!this.properties.url)throw new Error("can't load iframe meeting because url property isn't set");return this._updateCallState(ia),this.emitDailyJSEvent({action:Ic}),this._callObjectMode?new Promise(function(d,m){u._callObjectLoader.cancel();var f=Date.now();u._callObjectLoader.load(u.properties.dailyConfig,function(y){u._bundleLoadTime=y?"no-op":Date.now()-f,u._updateCallState(aa),y&&u.emitDailyJSEvent({action:oa}),d()},function(y,M){if(u.emitDailyJSEvent({action:Nc}),!M){u._updateCallState(Be),u.resetMeetingDependentVars();var L={action:da,errorMsg:y.msg,error:{type:"connection-error",msg:"Failed to load call object bundle.",details:{on:"load",sourceError:y,bundleUrl:mn(u.properties.dailyConfig)}}};u._maybeSendToSentry(L),u.emitDailyJSEvent(L),m(y.msg)}})}):(this._iframe.src=ss(this.assembleMeetingUrl(),this.properties.dailyConfig),new Promise(function(d,m){u._loadedCallback=function(f){u._callState!==Be?(u._updateCallState(aa),(u.properties.cssFile||u.properties.cssText)&&u.loadCss(u.properties),d()):m(f)}}))}}),function(s){return E.apply(this,arguments)})},{key:"join",value:(b=D(function*(){var s=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._testCallInProgress&&this.stopTestCallQuality();var d=!1;if(this.needsLoad()){this.updateIsPreparingToJoin(!0);try{yield this.load(u)}catch(m){return this.updateIsPreparingToJoin(!1),Promise.reject(m)}}else{if(d=!(!this.properties.cssFile&&!this.properties.cssText),this._didPreAuth){if(u.url&&u.url!==this.properties.url)return console.error("url in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject();if(u.token&&u.token!==this.properties.token)return console.error("token in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject()}if(u.url&&!this._callObjectMode&&u.url&&u.url!==this.properties.url)return console.error("url in join() is different than the one used in load() (".concat(this.properties.url," -> ").concat(u.url,")")),this.updateIsPreparingToJoin(!1),Promise.reject();this.validateProperties(u),this.properties=I(I({},this.properties),u)}return u.showLocalVideo!==void 0&&(this._callObjectMode?console.error("showLocalVideo is not available in callObject mode"):this._showLocalVideo=!!u.showLocalVideo),u.showParticipantsBar!==void 0&&(this._callObjectMode?console.error("showParticipantsBar is not available in callObject mode"):this._showParticipantsBar=!!u.showParticipantsBar),this._callState===at||this._callState===gr?(console.warn("already joined meeting, call leave() before joining again"),void this.updateIsPreparingToJoin(!1)):(this._updateCallState(gr,!1),this.emitDailyJSEvent({action:Fc}),this._preloadCache.inputSettings||(this._preloadCache.inputSettings={}),u.inputSettings&&u.inputSettings.audio&&(this._preloadCache.inputSettings.audio=u.inputSettings.audio),u.inputSettings&&u.inputSettings.video&&(this._preloadCache.inputSettings.video=u.inputSettings.video),this.sendMessageToCallMachine({action:"join-meeting",properties:vt(this.properties,this.callClientId),preloadCache:vt(this._preloadCache,this.callClientId)}),new Promise(function(m,f){s._joinedCallback=function(y,M){if(s._callState!==Be){if(s._updateCallState(at),y)for(var L in y){if(s._callObjectMode){var $=s._callMachine().store;Ca(y[L],$),Ea(y[L],$),Ma(y[L],s._participants[L],$)}s._participants[L]=I({},y[L]),s.toggleParticipantAudioBasedOnNativeAudioFocus()}d&&s.loadCss(s.properties),m(y)}else f(M)}}))}),function(){return b.apply(this,arguments)})},{key:"leave",value:(k=D(function*(){var s=this;return this._testCallInProgress&&this.stopTestCallQuality(),new Promise(function(u){s._callState===tt||s._callState===Be?u():s._callObjectLoader&&!s._callObjectLoader.loaded?(s._callObjectLoader.cancel(),s._updateCallState(tt),s.resetMeetingDependentVars(),s.emitDailyJSEvent({action:tt}),u()):(s._resolveLeave=u,s.sendMessageToCallMachine({action:"leave-meeting"}))})}),function(){return k.apply(this,arguments)})},{key:"startScreenShare",value:(N=D(function*(){var s=this,u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ln(this._callMachineInitialized,"startScreenShare()"),u.screenVideoSendSettings&&this._validateVideoSendSettings("screenVideo",u.screenVideoSendSettings),u.mediaStream&&(this._sharedTracks.screenMediaStream=u.mediaStream,u.mediaStream=Bt),typeof DailyNativeUtils<"u"&&DailyNativeUtils.isIOS!==void 0&&DailyNativeUtils.isIOS){var d=this.nativeUtils();if(yield d.isScreenBeingCaptured())return void this.emitDailyJSEvent({action:ua,type:"screen-share-error",errorMsg:"Could not start the screen sharing. The screen is already been captured!"});d.setSystemScreenCaptureStartCallback(function(){d.setSystemScreenCaptureStartCallback(null),s.sendMessageToCallMachine({action:pa,captureOptions:u})}),d.presentSystemScreenCapturePrompt()}else this.sendMessageToCallMachine({action:pa,captureOptions:u})}),function(){return N.apply(this,arguments)})},{key:"stopScreenShare",value:function(){ln(this._callMachineInitialized,"stopScreenShare()"),this.sendMessageToCallMachine({action:"local-screen-stop"})}},{key:"startRecording",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(I({action:"local-recording-start"},s))}},{key:"updateRecording",value:function(s){var u=s.layout,d=u===void 0?{preset:"default"}:u,m=s.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-recording",layout:d,instanceId:m})}},{key:"stopRecording",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(I({action:"local-recording-stop"},s))}},{key:"startLiveStreaming",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(I({action:"daily-method-start-live-streaming"},s))}},{key:"updateLiveStreaming",value:function(s){var u=s.layout,d=u===void 0?{preset:"default"}:u,m=s.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-live-streaming",layout:d,instanceId:m})}},{key:"addLiveStreamingEndpoints",value:function(s){var u=s.endpoints,d=s.instanceId;this.sendMessageToCallMachine({action:fa,endpointsOp:Ol,endpoints:u,instanceId:d})}},{key:"removeLiveStreamingEndpoints",value:function(s){var u=s.endpoints,d=s.instanceId;this.sendMessageToCallMachine({action:fa,endpointsOp:Al,endpoints:u,instanceId:d})}},{key:"stopLiveStreaming",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(I({action:"daily-method-stop-live-streaming"},s))}},{key:"validateDailyConfig",value:function(s){s.camSimulcastEncodings&&(console.warn("camSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide camera simulcast settings."),this.validateSimulcastEncodings(s.camSimulcastEncodings)),s.screenSimulcastEncodings&&console.warn("screenSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide screen simulcast settings."),Cs()&&s.noAutoDefaultDeviceChange&&console.warn("noAutoDefaultDeviceChange is not supported on Android, and will be ignored.")}},{key:"validateSimulcastEncodings",value:function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,d=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(s){if(!(s instanceof Array||Array.isArray(s)))throw new Error("encodings must be an Array");if(!Ua(s.length,1,3))throw new Error("encodings must be an Array with between 1 to ".concat(3," layers"));for(var m=0;m<s.length;m++){var f=s[m];for(var y in this._validateEncodingLayerHasValidProperties(f),f)if(Kn.includes(y)){if(typeof f[y]!="number")throw new Error("".concat(y," must be a number"));if(u){var M=u[y],L=M.min,$=M.max;if(!Ua(f[y],L,$))throw new Error("".concat(y," value not in range. valid range: ").concat(L," to ").concat($))}}else if(!["active","scalabilityMode"].includes(y))throw new Error("Invalid key ".concat(y,", valid keys are:")+Object.values(Kn));if(d&&!f.hasOwnProperty("maxBitrate"))throw new Error("maxBitrate is not specified")}}}},{key:"startRemoteMediaPlayer",value:(x=D(function*(s){var u=this,d=s.url,m=s.settings,f=m===void 0?{state:vr.PLAY}:m;try{(function(y){if(typeof y!="string")throw new Error('url parameter must be "string" type')})(d),Fa(f),function(y){for(var M in y)if(!Ia.includes(M))throw new Error("Invalid key ".concat(M,", valid keys are: ").concat(Ia));y.simulcastEncodings&&this.validateSimulcastEncodings(y.simulcastEncodings,As,!0)}(f)}catch(y){throw console.error("invalid argument Error: ".concat(y)),console.error(`startRemoteMediaPlayer arguments must be of the form:
  { url: "playback url",
  settings?:
  {state: "play"|"pause", simulcastEncodings?: [{}] } }`),y}return new Promise(function(y,M){u.sendMessageToCallMachine({action:"daily-method-start-remote-media-player",url:d,settings:f},function(L){L.error?M({error:L.error,errorMsg:L.errorMsg}):y({session_id:L.session_id,remoteMediaPlayerState:{state:L.state,settings:L.settings}})})})}),function(s){return x.apply(this,arguments)})},{key:"stopRemoteMediaPlayer",value:(A=D(function*(s){var u=this;if(typeof s!="string")throw new Error(" remotePlayerID must be of type string");return new Promise(function(d,m){u.sendMessageToCallMachine({action:"daily-method-stop-remote-media-player",session_id:s},function(f){f.error?m({error:f.error,errorMsg:f.errorMsg}):d()})})}),function(s){return A.apply(this,arguments)})},{key:"updateRemoteMediaPlayer",value:(O=D(function*(s){var u=this,d=s.session_id,m=s.settings;try{Fa(m)}catch(f){throw console.error("invalid argument Error: ".concat(f)),console.error(`updateRemoteMediaPlayer arguments must be of the form:
  session_id: "participant session",
  { settings?: {state: "play"|"pause"} }`),f}return new Promise(function(f,y){u.sendMessageToCallMachine({action:"daily-method-update-remote-media-player",session_id:d,settings:m},function(M){M.error?y({error:M.error,errorMsg:M.errorMsg}):f({session_id:M.session_id,remoteMediaPlayerState:{state:M.state,settings:M.settings}})})})}),function(s){return O.apply(this,arguments)})},{key:"startTranscription",value:function(s){H(this._callState,"startTranscription()"),this.sendMessageToCallMachine(I({action:"daily-method-start-transcription"},s))}},{key:"updateTranscription",value:function(s){if(H(this._callState,"updateTranscription()"),!s)throw new Error("updateTranscription Error: options is mandatory");if(z(s)!=="object")throw new Error("updateTranscription Error: options must be object type");if(s.participants&&!Array.isArray(s.participants))throw new Error("updateTranscription Error: participants must be an array");this.sendMessageToCallMachine(I({action:"daily-method-update-transcription"},s))}},{key:"stopTranscription",value:function(s){if(H(this._callState,"stopTranscription()"),s&&z(s)!=="object")throw new Error("stopTranscription Error: options must be object type");if(s&&!s.instanceId)throw new Error('"instanceId" not provided');this.sendMessageToCallMachine(I({action:"daily-method-stop-transcription"},s))}},{key:"startDialOut",value:(w=D(function*(s){var u=this;H(this._callState,"startDialOut()");var d=function(m){if(m){if(!Array.isArray(m))throw new Error("Error starting dial out: audio codec must be an array");if(m.length<=0)throw new Error("Error starting dial out: audio codec array specified but empty");m.forEach(function(f){if(typeof f!="string")throw new Error("Error starting dial out: audio codec must be a string");if(f!=="OPUS"&&f!=="PCMU"&&f!=="PCMA"&&f!=="G722")throw new Error("Error starting dial out: audio codec must be one of OPUS, PCMU, PCMA, G722")})}};if(!s.sipUri&&!s.phoneNumber)throw new Error("Error starting dial out: either a sip uri or phone number must be provided");if(s.sipUri&&s.phoneNumber)throw new Error("Error starting dial out: only one of sip uri or phone number must be provided");if(s.sipUri){if(typeof s.sipUri!="string")throw new Error("Error starting dial out: sipUri must be a string");if(!s.sipUri.startsWith("sip:"))throw new Error("Error starting dial out: Invalid SIP URI, must start with 'sip:'");if(s.video&&typeof s.video!="boolean")throw new Error("Error starting dial out: video must be a boolean value");(function(m){if(m&&(d(m.audio),m.video)){if(!Array.isArray(m.video))throw new Error("Error starting dial out: video codec must be an array");if(m.video.length<=0)throw new Error("Error starting dial out: video codec array specified but empty");m.video.forEach(function(f){if(typeof f!="string")throw new Error("Error starting dial out: video codec must be a string");if(f!=="H264"&&f!=="VP8")throw new Error("Error starting dial out: video codec must be H264 or VP8")})}})(s.codecs)}if(s.phoneNumber){if(typeof s.phoneNumber!="string")throw new Error("Error starting dial out: phoneNumber must be a string");if(!/^\+\d{1,}$/.test(s.phoneNumber))throw new Error("Error starting dial out: Invalid phone number, must be valid phone number as per E.164");s.codecs&&d(s.codecs.audio)}if(s.callerId){if(typeof s.callerId!="string")throw new Error("Error starting dial out: callerId must be a string");if(s.sipUri)throw new Error("Error starting dial out: callerId not allowed with sipUri")}if(s.displayName){if(typeof s.displayName!="string")throw new Error("Error starting dial out: displayName must be a string");if(s.displayName.length>=200)throw new Error("Error starting dial out: displayName length must be less than 200")}if(s.userId){if(typeof s.userId!="string")throw new Error("Error starting dial out: userId must be a string");if(s.userId.length>36)throw new Error("Error starting dial out: userId length must be less than or equal to 36")}return new Promise(function(m,f){u.sendMessageToCallMachine(I({action:"dialout-start"},s),function(y){y.error?f(y.error):m(y)})})}),function(s){return w.apply(this,arguments)})},{key:"stopDialOut",value:function(s){var u=this;return H(this._callState,"stopDialOut()"),new Promise(function(d,m){u.sendMessageToCallMachine(I({action:"dialout-stop"},s),function(f){f.error?m(f.error):d(f)})})}},{key:"sipCallTransfer",value:(v=D(function*(s){var u=this;if(H(this._callState,"sipCallTransfer()"),!s)throw new Error("sipCallTransfer() requires a sessionId and toEndPoint");return s.useSipRefer=!1,Ba(s,"sipCallTransfer"),new Promise(function(d,m){u.sendMessageToCallMachine(I({action:ma},s),function(f){f.error?m(f.error):d(f)})})}),function(s){return v.apply(this,arguments)})},{key:"sipRefer",value:(C=D(function*(s){var u=this;if(H(this._callState,"sipRefer()"),!s)throw new Error("sessionId and toEndPoint are mandatory parameter");return s.useSipRefer=!0,Ba(s,"sipRefer"),new Promise(function(d,m){u.sendMessageToCallMachine(I({action:ma},s),function(f){f.error?m(f.error):d(f)})})}),function(s){return C.apply(this,arguments)})},{key:"sendDTMF",value:(_=D(function*(s){var u=this;return H(this._callState,"sendDTMF()"),function(d){var m=d.sessionId,f=d.tones;if(!m||!f)throw new Error("sessionId and tones are mandatory parameter");if(typeof m!="string"||typeof f!="string")throw new Error("sessionId and tones should be of string type");if(f.length>20)throw new Error("tones string must be upto 20 characters");var y=/[^0-9A-D*#]/g,M=f.match(y);if(M&&M[0])throw new Error("".concat(M[0]," is not valid DTMF tone"))}(s),new Promise(function(d,m){u.sendMessageToCallMachine(I({action:"send-dtmf"},s),function(f){f.error?m(f.error):d(f)})})}),function(s){return _.apply(this,arguments)})},{key:"getNetworkStats",value:function(){var s=this;return this._callState!==at?{stats:{latest:{}}}:new Promise(function(u){s.sendMessageToCallMachine({action:"get-calc-stats"},function(d){u(I({stats:d.stats},s._network))})})}},{key:"testWebsocketConnectivity",value:(g=D(function*(){var s=this;if(Xn(this._testCallInProgress,"testWebsocketConnectivity()"),this.needsLoad())try{yield this.load()}catch(u){return Promise.reject(u)}return new Promise(function(u,d){s.sendMessageToCallMachine({action:"test-websocket-connectivity"},function(m){m.error?d(m.error):u(m.results)})})}),function(){return g.apply(this,arguments)})},{key:"abortTestWebsocketConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-websocket-connectivity"})}},{key:"_validateVideoTrackForNetworkTests",value:function(s){return s?s instanceof MediaStreamTrack?!!Xl(s)||(console.error("Video track is not playable. This test needs a live video track."),!1):(console.error("Video track needs to be of type `MediaStreamTrack`."),!1):(console.error("Missing video track. You must provide a video track in order to run this test."),!1)}},{key:"testCallQuality",value:(p=D(function*(){var s=this;U(),ve(this._callObjectMode,"testCallQuality()"),ln(this._callMachineInitialized,"testCallQuality()",null,!0),Yn(this._callState,this._isPreparingToJoin,"testCallQuality()");var u=this._testCallAlreadyInProgress,d=function(f){u||(s._testCallInProgress=f)};if(d(!0),this.needsLoad())try{var m=this._callState;yield this.load(),this._callState=m}catch(f){return d(!1),Promise.reject(f)}return new Promise(function(f){s.sendMessageToCallMachine({action:"test-call-quality",dailyJsVersion:s.properties.dailyJsVersion},function(y){var M=y.results,L=M.result,$=Hr(M,Zl);if(L==="failed"){var te,Y=I({},$);(te=$.error)!==null&&te!==void 0&&te.details?($.error.details=JSON.parse($.error.details),Y.error=I(I({},Y.error),{},{details:I({},Y.error.details)}),Y.error.details.duringTest="testCallQuality"):(Y.error=Y.error?I({},Y.error):{},Y.error.details={duringTest:"testCallQuality"}),s._maybeSendToSentry(Y)}d(!1),f(I({result:L},$))})})}),function(){return p.apply(this,arguments)})},{key:"stopTestCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-call-quality"})}},{key:"testConnectionQuality",value:(h=D(function*(s){var u;q()?(console.warn("testConnectionQuality() is deprecated: use testPeerToPeerCallQuality() instead"),u=yield this.testPeerToPeerCallQuality(s)):(console.warn("testConnectionQuality() is deprecated: use testCallQuality() instead"),u=yield this.testCallQuality());var d={result:u.result,secondsElapsed:u.secondsElapsed};return u.data&&(d.data={maxRTT:u.data.maxRoundTripTime,packetLoss:u.data.avgRecvPacketLoss}),d}),function(s){return h.apply(this,arguments)})},{key:"testPeerToPeerCallQuality",value:(c=D(function*(s){var u=this;if(Xn(this._testCallInProgress,"testPeerToPeerCallQuality()"),this.needsLoad())try{yield this.load()}catch(f){return Promise.reject(f)}var d=s.videoTrack,m=s.duration;if(!this._validateVideoTrackForNetworkTests(d))throw new Error("Video track error");return this._sharedTracks.videoTrackForConnectionQualityTest=d,new Promise(function(f,y){u.sendMessageToCallMachine({action:"test-p2p-call-quality",duration:m},function(M){M.error?y(M.error):f(M.results)})})}),function(s){return c.apply(this,arguments)})},{key:"stopTestConnectionQuality",value:function(){q()?(console.warn("stopTestConnectionQuality() is deprecated: use testPeerToPeerCallQuality() and stopTestPeerToPeerCallQuality() instead"),this.stopTestPeerToPeerCallQuality()):(console.warn("stopTestConnectionQuality() is deprecated: use testCallQuality() and stopTestCallQuality() instead"),this.stopTestCallQuality())}},{key:"stopTestPeerToPeerCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-p2p-call-quality"})}},{key:"testNetworkConnectivity",value:(l=D(function*(s){var u=this;if(Xn(this._testCallInProgress,"testNetworkConnectivity()"),this.needsLoad())try{yield this.load()}catch(d){return Promise.reject(d)}if(!this._validateVideoTrackForNetworkTests(s))throw new Error("Video track error");return this._sharedTracks.videoTrackForNetworkConnectivityTest=s,new Promise(function(d,m){u.sendMessageToCallMachine({action:"test-network-connectivity"},function(f){f.error?m(f.error):d(f.results)})})}),function(s){return l.apply(this,arguments)})},{key:"abortTestNetworkConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-network-connectivity"})}},{key:"getCpuLoadStats",value:function(){var s=this;return new Promise(function(u){s._callState===at?s.sendMessageToCallMachine({action:"get-cpu-load-stats"},function(d){u(d.cpuStats)}):u({cpuLoadState:void 0,cpuLoadStateReason:void 0,stats:{}})})}},{key:"_validateEncodingLayerHasValidProperties",value:function(s){var u;if(!(((u=Object.keys(s))===null||u===void 0?void 0:u.length)>0))throw new Error("Empty encoding is not allowed. At least one of these valid keys should be specified:"+Object.values(Kn))}},{key:"_validateVideoSendSettings",value:function(s,u){var d=s==="screenVideo"?["default-screen-video","detail-optimized","motion-optimized","motion-and-detail-balanced"]:["default-video","bandwidth-optimized","bandwidth-and-quality-balanced","quality-optimized","adaptive-2-layers","adaptive-3-layers"],m="Video send settings should be either an object or one of the supported presets: ".concat(d.join());if(typeof u=="string"){if(!d.includes(u))throw new Error(m)}else{if(z(u)!=="object")throw new Error(m);if(!u.maxQuality&&!u.encodings&&u.allowAdaptiveLayers===void 0)throw new Error("Video send settings must contain at least maxQuality, allowAdaptiveLayers or encodings attribute");if(u.maxQuality&&["low","medium","high"].indexOf(u.maxQuality)===-1)throw new Error("maxQuality must be either low, medium or high");if(u.encodings){var f=!1;switch(Object.keys(u.encodings).length){case 1:f=!u.encodings.low;break;case 2:f=!u.encodings.low||!u.encodings.medium;break;case 3:f=!u.encodings.low||!u.encodings.medium||!u.encodings.high;break;default:f=!0}if(f)throw new Error("Encodings must be defined as: low, low and medium, or low, medium and high.");u.encodings.low&&this._validateEncodingLayerHasValidProperties(u.encodings.low),u.encodings.medium&&this._validateEncodingLayerHasValidProperties(u.encodings.medium),u.encodings.high&&this._validateEncodingLayerHasValidProperties(u.encodings.high)}}}},{key:"validateUpdateSendSettings",value:function(s){var u=this;if(!s||Object.keys(s).length===0)throw new Error("Send settings must contain at least information for one track!");Object.entries(s).forEach(function(d){var m=ut(d,2),f=m[0],y=m[1];u._validateVideoSendSettings(f,y)})}},{key:"updateSendSettings",value:function(s){var u=this;return this.validateUpdateSendSettings(s),this.needsLoad()?(this._preloadCache.sendSettings=s,{sendSettings:this._preloadCache.sendSettings}):new Promise(function(d,m){u.sendMessageToCallMachine({action:"update-send-settings",sendSettings:s},function(f){f.error?m(f.error):d(f.sendSettings)})})}},{key:"getSendSettings",value:function(){return this._sendSettings||this._preloadCache.sendSettings}},{key:"getLocalAudioLevel",value:function(){return this._localAudioLevel}},{key:"getRemoteParticipantsAudioLevel",value:function(){return this._remoteParticipantsAudioLevel}},{key:"getActiveSpeaker",value:function(){return U(),this._activeSpeaker}},{key:"setActiveSpeakerMode",value:function(s){return U(),this.sendMessageToCallMachine({action:"set-active-speaker-mode",enabled:s}),this}},{key:"activeSpeakerMode",value:function(){return U(),this._activeSpeakerMode}},{key:"subscribeToTracksAutomatically",value:function(){return this._preloadCache.subscribeToTracksAutomatically}},{key:"setSubscribeToTracksAutomatically",value:function(s){return H(this._callState,"setSubscribeToTracksAutomatically()","Use the subscribeToTracksAutomatically configuration property."),this._preloadCache.subscribeToTracksAutomatically=s,this.sendMessageToCallMachine({action:"daily-method-subscribe-to-tracks-automatically",enabled:s}),this}},{key:"enumerateDevices",value:(o=D(function*(){var s=this;if(this._callObjectMode){var u=yield navigator.mediaDevices.enumerateDevices();return ft()==="Firefox"&&qt().major>115&&qt().major<123&&(u=u.filter(function(d){return d.kind!=="audiooutput"})),{devices:u.map(function(d){var m=JSON.parse(JSON.stringify(d));if(!q()&&d.kind==="videoinput"&&d.getCapabilities){var f,y=d.getCapabilities();m.facing=(y==null||(f=y.facingMode)===null||f===void 0?void 0:f.length)>=1?y.facingMode[0]:void 0}return m})}}return new Promise(function(d){s.sendMessageToCallMachine({action:"enumerate-devices"},function(m){d({devices:m.devices})})})}),function(){return o.apply(this,arguments)})},{key:"sendAppMessage",value:function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"*";if(H(this._callState,"sendAppMessage()"),JSON.stringify(s).length>this._maxAppMessageSize)throw new Error("Message data too large. Max size is "+this._maxAppMessageSize);return this.sendMessageToCallMachine({action:"app-msg",data:s,to:u}),this}},{key:"addFakeParticipant",value:function(s){return U(),H(this._callState,"addFakeParticipant()"),this.sendMessageToCallMachine(I({action:"add-fake-participant"},s)),this}},{key:"setShowNamesMode",value:function(s){return de(this._callObjectMode,"setShowNamesMode()"),U(),s&&s!=="always"&&s!=="never"?(console.error('setShowNamesMode argument should be "always", "never", or false'),this):(this.sendMessageToCallMachine({action:"set-show-names",mode:s}),this)}},{key:"setShowLocalVideo",value:function(){var s=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return de(this._callObjectMode,"setShowLocalVideo()"),U(),H(this._callState,"setShowLocalVideo()"),typeof s!="boolean"?(console.error("setShowLocalVideo only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-local-video",show:s}),this._showLocalVideo=s,this)}},{key:"showLocalVideo",value:function(){return de(this._callObjectMode,"showLocalVideo()"),U(),this._showLocalVideo}},{key:"setShowParticipantsBar",value:function(){var s=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return de(this._callObjectMode,"setShowParticipantsBar()"),U(),H(this._callState,"setShowParticipantsBar()"),typeof s!="boolean"?(console.error("setShowParticipantsBar only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-participants-bar",show:s}),this._showParticipantsBar=s,this)}},{key:"showParticipantsBar",value:function(){return de(this._callObjectMode,"showParticipantsBar()"),U(),this._showParticipantsBar}},{key:"customIntegrations",value:function(){return U(),de(this._callObjectMode,"customIntegrations()"),this._customIntegrations}},{key:"setCustomIntegrations",value:function(s){return U(),de(this._callObjectMode,"setCustomIntegrations()"),H(this._callState,"setCustomIntegrations()"),Rs(s)?(this.sendMessageToCallMachine({action:"set-custom-integrations",integrations:s}),this._customIntegrations=s,this):this}},{key:"startCustomIntegrations",value:function(s){var u=this;if(U(),de(this._callObjectMode,"startCustomIntegrations()"),H(this._callState,"startCustomIntegrations()"),Array.isArray(s)&&s.some(function(f){return typeof f!="string"})||!Array.isArray(s)&&typeof s!="string")return console.error("startCustomIntegrations() only accepts string | string[]"),this;var d=typeof s=="string"?[s]:s,m=d.filter(function(f){return!(f in u._customIntegrations)});return m.length?(console.error(`Can't find custom integration(s): "`.concat(m.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"start-custom-integrations",ids:d}),this)}},{key:"stopCustomIntegrations",value:function(s){var u=this;if(U(),de(this._callObjectMode,"stopCustomIntegrations()"),H(this._callState,"stopCustomIntegrations()"),Array.isArray(s)&&s.some(function(f){return typeof f!="string"})||!Array.isArray(s)&&typeof s!="string")return console.error("stopCustomIntegrations() only accepts string | string[]"),this;var d=typeof s=="string"?[s]:s,m=d.filter(function(f){return!(f in u._customIntegrations)});return m.length?(console.error(`Can't find custom integration(s): "`.concat(m.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"stop-custom-integrations",ids:d}),this)}},{key:"customTrayButtons",value:function(){return de(this._callObjectMode,"customTrayButtons()"),U(),this._customTrayButtons}},{key:"updateCustomTrayButtons",value:function(s){return de(this._callObjectMode,"updateCustomTrayButtons()"),U(),H(this._callState,"updateCustomTrayButtons()"),Ns(s)?(this.sendMessageToCallMachine({action:"update-custom-tray-buttons",btns:s}),this._customTrayButtons=s,this):(console.error("updateCustomTrayButtons only accepts a dictionary of the type ".concat(JSON.stringify(kn))),this)}},{key:"theme",value:function(){return de(this._callObjectMode,"theme()"),this.properties.theme}},{key:"setTheme",value:function(s){var u=this;return de(this._callObjectMode,"setTheme()"),new Promise(function(d,m){try{u.validateProperties({theme:s}),u.properties.theme=I({},s),u.sendMessageToCallMachine({action:"set-theme",theme:u.properties.theme});try{u.emitDailyJSEvent({action:Dc,theme:u.properties.theme})}catch(f){console.log("could not emit 'theme-updated'",f)}d(u.properties.theme)}catch(f){m(f)}})}},{key:"requestFullscreen",value:(a=D(function*(){if(U(),this._iframe&&!document.fullscreenElement&&ga())try{(yield this._iframe.requestFullscreen)?this._iframe.requestFullscreen():this._iframe.webkitRequestFullscreen()}catch(s){console.log("could not make video call fullscreen",s)}}),function(){return a.apply(this,arguments)})},{key:"exitFullscreen",value:function(){U(),document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement&&document.webkitExitFullscreen()}},{key:"getSidebarView",value:(i=D(function*(){var s=this;return this._callObjectMode?(console.error("getSidebarView is not available in callObject mode"),Promise.resolve(null)):new Promise(function(u){s.sendMessageToCallMachine({action:"get-sidebar-view"},function(d){u(d.view)})})}),function(){return i.apply(this,arguments)})},{key:"setSidebarView",value:function(s){return this._callObjectMode?(console.error("setSidebarView is not available in callObject mode"),this):(this.sendMessageToCallMachine({action:"set-sidebar-view",view:s}),this)}},{key:"room",value:(r=D(function*(){var s=this,u=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).includeRoomConfigDefaults,d=u===void 0||u;return this._accessState.access===Vn||this.needsLoad()?this.properties.url?{roomUrlPendingJoin:this.properties.url}:null:new Promise(function(m){s.sendMessageToCallMachine({action:"lib-room-info",includeRoomConfigDefaults:d},function(f){delete f.action,delete f.callbackStamp,m(f)})})}),function(){return r.apply(this,arguments)})},{key:"geo",value:(n=D(function*(){try{var s=yield fetch("https://gs.daily.co/_ks_/x-swsl/:");return{current:(yield s.json()).geo}}catch(u){return console.error("geo lookup failed",u),{current:""}}}),function(){return n.apply(this,arguments)})},{key:"setNetworkTopology",value:(e=D(function*(s){var u=this;return U(),H(this._callState,"setNetworkTopology()"),new Promise(function(d,m){u.sendMessageToCallMachine({action:"set-network-topology",opts:s},function(f){f.error?m({error:f.error}):d({workerId:f.workerId})})})}),function(s){return e.apply(this,arguments)})},{key:"getNetworkTopology",value:(t=D(function*(){var s=this;return new Promise(function(u,d){s.needsLoad()&&u({topology:"none"}),s.sendMessageToCallMachine({action:"get-network-topology"},function(m){m.error?d({error:m.error}):u({topology:m.topology})})})}),function(){return t.apply(this,arguments)})},{key:"setPlayNewParticipantSound",value:function(s){if(U(),typeof s!="number"&&s!==!0&&s!==!1)throw new Error("argument to setShouldPlayNewParticipantSound should be true, false, or a number, but is ".concat(s));this.sendMessageToCallMachine({action:"daily-method-set-play-ding",arg:s})}},{key:"on",value:function(s,u){return De.prototype.on.call(this,s,u)}},{key:"once",value:function(s,u){return De.prototype.once.call(this,s,u)}},{key:"off",value:function(s,u){return De.prototype.off.call(this,s,u)}},{key:"validateProperties",value:function(s){for(var u in s){if(!rt[u])throw new Error("unrecognized property '".concat(u,"'"));if(rt[u].validate&&!rt[u].validate(s[u],this))throw new Error("property '".concat(u,"': ").concat(rt[u].help))}}},{key:"assembleMeetingUrl",value:function(){var s,u,d=I(I({},this.properties),{},{emb:this.callClientId,embHref:encodeURIComponent(window.location.href),proxy:(s=this.properties.dailyConfig)!==null&&s!==void 0&&s.proxyUrl?encodeURIComponent((u=this.properties.dailyConfig)===null||u===void 0?void 0:u.proxyUrl):void 0}),m=d.url.match(/\?/)?"&":"?";return d.url+m+Object.keys(rt).filter(function(f){return rt[f].queryString&&d[f]!==void 0}).map(function(f){return"".concat(rt[f].queryString,"=").concat(d[f])}).join("&")}},{key:"needsLoad",value:function(){return[ra,ia,tt,Be].includes(this._callState)}},{key:"sendMessageToCallMachine",value:function(s,u){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");this._messageChannel.sendMessageToCallMachine(s,u,this.callClientId,this._iframe)}},{key:"forwardPackagedMessageToCallMachine",value:function(s){this._messageChannel.forwardPackagedMessageToCallMachine(s,this._iframe,this.callClientId)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(s){return this._messageChannel.addListenerForPackagedMessagesFromCallMachine(s,this.callClientId)}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(s){this._messageChannel.removeListenerForPackagedMessagesFromCallMachine(s)}},{key:"handleMessageFromCallMachine",value:function(s){switch(s.action){case xc:this.sendMessageToCallMachine(I({action:jc},this.properties));break;case"call-machine-initialized":this._callMachineInitialized=!0;var u={action:sn,level:"log",code:1011,stats:{event:"bundle load",time:this._bundleLoadTime==="no-op"?0:this._bundleLoadTime,preLoaded:this._bundleLoadTime==="no-op",url:mn(this.properties.dailyConfig)}};this.sendMessageToCallMachine(u),this._delayDuplicateInstanceLog&&this._logDuplicateInstanceAttempt();break;case oa:this._loadedCallback&&(this._loadedCallback(),this._loadedCallback=null),this.emitDailyJSEvent(s);break;case Uc:var d,m=I({},s);delete m.internal,this._maxAppMessageSize=((d=s.internal)===null||d===void 0?void 0:d._maxAppMessageSize)||Wn,this._joinedCallback&&(this._joinedCallback(s.participants),this._joinedCallback=null),this.emitDailyJSEvent(m);break;case Jc:case qc:if(this._callState===tt)return;if(s.participant&&s.participant.session_id){var f=s.participant.local?"local":s.participant.session_id;if(this._callObjectMode){var y=this._callMachine().store;Ca(s.participant,y),Ea(s.participant,y),Ma(s.participant,this._participants[f],y)}try{this.maybeParticipantTracksStopped(this._participants[f],s.participant),this.maybeParticipantTracksStarted(this._participants[f],s.participant),this.maybeEventRecordingStopped(this._participants[f],s.participant),this.maybeEventRecordingStarted(this._participants[f],s.participant)}catch(Ln){console.error("track events error",Ln)}this.compareEqualForParticipantUpdateEvent(s.participant,this._participants[f])||(this._participants[f]=I({},s.participant),this.toggleParticipantAudioBasedOnNativeAudioFocus(),this.emitDailyJSEvent(s))}break;case Vc:if(s.participant&&s.participant.session_id){var M=this._participants[s.participant.session_id];M&&this.maybeParticipantTracksStopped(M,null),delete this._participants[s.participant.session_id],this.emitDailyJSEvent(s)}break;case Wc:le(this._participantCounts,s.participantCounts)||(this._participantCounts=s.participantCounts,this.emitDailyJSEvent(s));break;case zc:var L={access:s.access};s.awaitingAccess&&(L.awaitingAccess=s.awaitingAccess),le(this._accessState,L)||(this._accessState=L,this.emitDailyJSEvent(s));break;case Gc:if(s.meetingSession){this._meetingSessionSummary=s.meetingSession,this.emitDailyJSEvent(s);var $=I(I({},s),{},{action:"meeting-session-updated"});this.emitDailyJSEvent($)}break;case da:var te;this._iframe&&!s.preserveIframe&&(this._iframe.src=""),this._updateCallState(Be),this.resetMeetingDependentVars(),this._loadedCallback&&(this._loadedCallback(s.errorMsg),this._loadedCallback=null),s.preserveIframe;var Y=Hr(s,eu);Y!=null&&(te=Y.error)!==null&&te!==void 0&&te.details&&(Y.error.details=JSON.parse(Y.error.details)),this._maybeSendToSentry(s),this._joinedCallback&&(this._joinedCallback(null,Y),this._joinedCallback=null),this.emitDailyJSEvent(Y);break;case $c:this._callState!==Be&&this._updateCallState(tt),this.resetMeetingDependentVars(),this._resolveLeave&&(this._resolveLeave(),this._resolveLeave=null),this.emitDailyJSEvent(s);break;case"selected-devices-updated":s.devices&&this.emitDailyJSEvent(s);break;case vl:var Oe=s.threshold,Re=s.quality;Oe===this._network.threshold&&Re===this._network.quality||(this._network.quality=Re,this._network.threshold=Oe,this.emitDailyJSEvent(s));break;case _l:s&&s.cpuLoadState&&this.emitDailyJSEvent(s);break;case bl:s&&s.faceCounts!==void 0&&this.emitDailyJSEvent(s);break;case ml:var Ae=s.activeSpeaker;this._activeSpeaker.peerId!==Ae.peerId&&(this._activeSpeaker.peerId=Ae.peerId,this.emitDailyJSEvent({action:s.action,activeSpeaker:this._activeSpeaker}));break;case"show-local-video-changed":if(this._callObjectMode)return;var Gt=s.show;this._showLocalVideo=Gt,this.emitDailyJSEvent({action:s.action,show:Gt});break;case gl:var xt=s.enabled;this._activeSpeakerMode!==xt&&(this._activeSpeakerMode=xt,this.emitDailyJSEvent({action:s.action,enabled:this._activeSpeakerMode}));break;case Qc:case Kc:case Yc:this._waitingParticipants=s.allWaitingParticipants,this.emitDailyJSEvent({action:s.action,participant:s.participant});break;case Ml:le(this._receiveSettings,s.receiveSettings)||(this._receiveSettings=s.receiveSettings,this.emitDailyJSEvent({action:s.action,receiveSettings:s.receiveSettings}));break;case Tl:if(!le(this._inputSettings,s.inputSettings)){var se=this._getInputSettings();this._inputSettings=s.inputSettings,this._preloadCache.inputSettings={},le(se,this._getInputSettings())||this.emitDailyJSEvent({action:s.action,inputSettings:this._getInputSettings()})}break;case"send-settings-updated":le(this._sendSettings,s.sendSettings)||(this._sendSettings=s.sendSettings,this._preloadCache.sendSettings=null,this.emitDailyJSEvent({action:s.action,sendSettings:s.sendSettings}));break;case"local-audio-level":this._localAudioLevel=s.audioLevel,this._preloadCache.localAudioLevelObserver=null,this.emitDailyJSEvent(s);break;case"remote-participants-audio-level":this._remoteParticipantsAudioLevel=s.participantsAudioLevel,this._preloadCache.remoteParticipantsAudioLevelObserver=null,this.emitDailyJSEvent(s);break;case ll:var Pe=s.session_id;this._rmpPlayerState[Pe]=s.playerState,this.emitDailyJSEvent(s);break;case dl:delete this._rmpPlayerState[s.session_id],this.emitDailyJSEvent(s);break;case ul:var Ze=s.session_id,jt=this._rmpPlayerState[Ze];jt&&this.compareEqualForRMPUpdateEvent(jt,s.remoteMediaPlayerState)||(this._rmpPlayerState[Ze]=s.remoteMediaPlayerState,this.emitDailyJSEvent(s));break;case"custom-button-click":case"sidebar-view-changed":this.emitDailyJSEvent(s);break;case Hc:var Pn=this._meetingSessionState.topology!==(s.meetingSessionState&&s.meetingSessionState.topology);this._meetingSessionState=Zn(s.meetingSessionState,this._callObjectMode),(this._callObjectMode||Pn)&&this.emitDailyJSEvent(s);break;case hl:this._isScreenSharing=!0,this.emitDailyJSEvent(s);break;case pl:case fl:this._isScreenSharing=!1,this.emitDailyJSEvent(s);break;case ca:case la:case rl:case il:case al:case el:case tl:case nl:case Rc:case Bc:case ol:case cl:case"test-completed":case yl:case sl:case Sl:case wl:case kl:case Cl:case ua:case El:case"dialin-ready":case"dialin-connected":case"dialin-error":case"dialin-stopped":case"dialin-warning":case"dialout-connected":case"dialout-answered":case"dialout-error":case"dialout-stopped":case"dialout-warning":this.emitDailyJSEvent(s);break;case"request-fullscreen":this.requestFullscreen();break;case"request-exit-fullscreen":this.exitFullscreen()}}},{key:"maybeEventRecordingStopped",value:function(s,u){var d="record";s&&(u.local||u[d]!==!1||s[d]===u[d]||this.emitDailyJSEvent({action:la}))}},{key:"maybeEventRecordingStarted",value:function(s,u){var d="record";s&&(u.local||u[d]!==!0||s[d]===u[d]||this.emitDailyJSEvent({action:ca}))}},{key:"maybeEventTrackStopped",value:function(s,u,d,m){s&&(s.readyState!=="ended"&&u&&s.id===u.id||this.emitDailyJSEvent({action:Zc,track:s,participant:d,type:m}))}},{key:"maybeEventTrackStarted",value:function(s,u,d,m){u&&(s&&s.readyState!=="ended"&&u.id===s.id||this.emitDailyJSEvent({action:Xc,track:u,participant:d,type:m}))}},{key:"maybeParticipantTracksStopped",value:function(s,u){if(s)for(var d in s.tracks)this.maybeEventTrackStopped(s.tracks[d].track,u&&u.tracks[d]?u.tracks[d].track:null,u,d)}},{key:"maybeParticipantTracksStarted",value:function(s,u){if(u)for(var d in u.tracks)this.maybeEventTrackStarted(s&&s.tracks[d]?s.tracks[d].track:null,u.tracks[d].track,u,d)}},{key:"compareEqualForRMPUpdateEvent",value:function(s,u){var d,m;return s.state===u.state&&((d=s.settings)===null||d===void 0?void 0:d.volume)===((m=u.settings)===null||m===void 0?void 0:m.volume)}},{key:"emitDailyJSEvent",value:function(s){try{s.callClientId=this.callClientId,this.emit(s.action,s)}catch(u){console.log("could not emit",s,u)}}},{key:"compareEqualForParticipantUpdateEvent",value:function(s,u){return!!le(s,u)&&(!s.videoTrack||!u.videoTrack||s.videoTrack.id===u.videoTrack.id&&s.videoTrack.muted===u.videoTrack.muted&&s.videoTrack.enabled===u.videoTrack.enabled)&&(!s.audioTrack||!u.audioTrack||s.audioTrack.id===u.audioTrack.id&&s.audioTrack.muted===u.audioTrack.muted&&s.audioTrack.enabled===u.audioTrack.enabled)}},{key:"nativeUtils",value:function(){return q()?typeof DailyNativeUtils>"u"?(console.warn("in React Native, DailyNativeUtils is expected to be available"),null):DailyNativeUtils:null}},{key:"updateIsPreparingToJoin",value:function(s){this._updateCallState(this._callState,s)}},{key:"_updateCallState",value:function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._isPreparingToJoin;if(s!==this._callState||u!==this._isPreparingToJoin){var d=this._callState,m=this._isPreparingToJoin;this._callState=s,this._isPreparingToJoin=u;var f=this._callState===at;this.updateShowAndroidOngoingMeetingNotification(f);var y=fn(d,m),M=fn(this._callState,this._isPreparingToJoin);y!==M&&(this.updateKeepDeviceAwake(M),this.updateDeviceAudioMode(M),this.updateNoOpRecordingEnsuringBackgroundContinuity(M))}}},{key:"resetMeetingDependentVars",value:function(){this._participants={},this._participantCounts=Da,this._waitingParticipants={},this._activeSpeaker={},this._activeSpeakerMode=!1,this._didPreAuth=!1,this._accessState={access:Vn},this._finalSummaryOfPrevSession=this._meetingSessionSummary,this._meetingSessionSummary={},this._meetingSessionState=Zn(ja,this._callObjectMode),this._isScreenSharing=!1,this._receiveSettings={},this._inputSettings=void 0,this._sendSettings={},this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this._maxAppMessageSize=Wn,this._callMachineInitialized=!1,this._bundleLoadTime=void 0,this._preloadCache}},{key:"updateKeepDeviceAwake",value:function(s){q()&&this.nativeUtils().setKeepDeviceAwake(s,this.callClientId)}},{key:"updateDeviceAudioMode",value:function(s){if(q()&&!this.disableReactNativeAutoDeviceManagement("audio")){var u=s?this._nativeInCallAudioMode:"idle";this.nativeUtils().setAudioMode(u)}}},{key:"updateShowAndroidOngoingMeetingNotification",value:function(s){if(q()&&this.nativeUtils().setShowOngoingMeetingNotification){var u,d,m,f;if(this.properties.reactNativeConfig&&this.properties.reactNativeConfig.androidInCallNotification){var y=this.properties.reactNativeConfig.androidInCallNotification;u=y.title,d=y.subtitle,m=y.iconName,f=y.disableForCustomOverride}f&&(s=!1),this.nativeUtils().setShowOngoingMeetingNotification(s,u,d,m,this.callClientId)}}},{key:"updateNoOpRecordingEnsuringBackgroundContinuity",value:function(s){q()&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity(s)}},{key:"toggleParticipantAudioBasedOnNativeAudioFocus",value:function(){var s,u;if(q()){var d=(s=this._callMachine())===null||s===void 0||(u=s.store)===null||u===void 0?void 0:u.getState();for(var m in d==null?void 0:d.streams){var f=d.streams[m];f&&f.pendingTrack&&f.pendingTrack.kind==="audio"&&(f.pendingTrack.enabled=this._hasNativeAudioFocus)}}}},{key:"disableReactNativeAutoDeviceManagement",value:function(s){return this.properties.reactNativeConfig&&this.properties.reactNativeConfig.disableAutoDeviceManagement&&this.properties.reactNativeConfig.disableAutoDeviceManagement[s]}},{key:"absoluteUrl",value:function(s){if(s!==void 0){var u=document.createElement("a");return u.href=s,u.href}}},{key:"sayHello",value:function(){var s="hello, world.";return console.log(s),s}},{key:"_logUseAfterDestroy",value:function(){var s=Object.values(nt)[0];if(this.needsLoad())if(s&&!s.needsLoad()){var u={action:sn,level:"error",code:this.strictMode?9995:9997};s.sendMessageToCallMachine(u)}else this.strictMode||console.error("You are are attempting to use a call instance that was previously destroyed, which is unsupported. Please remove `strictMode: false` from your constructor properties to enable strict mode to track down and fix this unsupported usage.");else{var d={action:sn,level:"error",code:this.strictMode?9995:9997};this._messageChannel.sendMessageToCallMachine(d,null,this.callClientId,this._iframe)}}},{key:"_logDuplicateInstanceAttempt",value:function(){for(var s=0,u=Object.values(nt);s<u.length;s++){var d=u[s];d._callMachineInitialized?(d.sendMessageToCallMachine({action:sn,level:"warn",code:this.allowMultipleCallInstances?9993:9992}),d._delayDuplicateInstanceLog=!1):d._delayDuplicateInstanceLog=!0}}},{key:"_maybeSendToSentry",value:function(s){var u,d,m,f,y,M;if(!((u=s.error)!==null&&u!==void 0&&u.type&&(![Lc,Pc,sa].includes(s.error.type)||s.error.type===sa&&s.error.msg.includes("deleted")))){var L=(d=this.properties)!==null&&d!==void 0&&d.url?new URL(this.properties.url):void 0,$="production";L&&L.host.includes(".staging.daily")&&($="staging");var te,Y,Oe,Re,Ae,Gt=[tc(),Zo(),Sc(),_c(),Ec(),Tc(),nc(),Mc()].filter(function(Ln){return!["BrowserApiErrors","Breadcrumbs","GlobalHandlers"].includes(Ln.name)}),xt=new oc({dsn:"https://f10f1c81e5d44a4098416c0867a8b740@o77906.ingest.sentry.io/168844",transport:hc,stackParser:yc,integrations:Gt,environment:$}),se=new Ge;if(se.setClient(xt),xt.init(),this.session_id&&se.setExtra("sessionId",this.session_id),this.properties){var Pe=I({},this.properties);Pe.userName=Pe.userName?"[Filtered]":void 0,Pe.userData=Pe.userData?"[Filtered]":void 0,Pe.token=Pe.token?"[Filtered]":void 0,se.setExtra("properties",Pe)}if(L){var Ze=L.searchParams.get("domain");if(!Ze){var jt=L.host.match(/(.*?)\./);Ze=jt&&jt[1]||""}Ze&&se.setTag("domain",Ze)}s.error&&(se.setTag("fatalErrorType",s.error.type),se.setExtra("errorDetails",s.error.details),!((te=s.error.details)===null||te===void 0)&&te.uri&&se.setTag("serverAddress",s.error.details.uri),!((Y=s.error.details)===null||Y===void 0)&&Y.workerGroup&&se.setTag("workerGroup",s.error.details.workerGroup),!((Oe=s.error.details)===null||Oe===void 0)&&Oe.geoGroup&&se.setTag("geoGroup",s.error.details.geoGroup),!((Re=s.error.details)===null||Re===void 0)&&Re.on&&se.setTag("connectionAttempt",s.error.details.on),(Ae=s.error.details)!==null&&Ae!==void 0&&Ae.bundleUrl&&(se.setTag("bundleUrl",s.error.details.bundleUrl),se.setTag("bundleError",s.error.details.sourceError.type))),se.setTags({callMode:this._callObjectMode?q()?"reactNative":(m=this.properties)!==null&&m!==void 0&&(f=m.dailyConfig)!==null&&f!==void 0&&(y=f.callMode)!==null&&y!==void 0&&y.includes("prebuilt")?this.properties.dailyConfig.callMode:"custom":"prebuilt-frame",version:ae.version()});var Pn=((M=s.error)===null||M===void 0?void 0:M.msg)||s.errorMsg;se.captureException(new Error(Pn))}}},{key:"_callMachine",value:function(){var s,u,d;return(s=window._daily)===null||s===void 0||(u=s.instances)===null||u===void 0||(d=u[this.callClientId])===null||d===void 0?void 0:d.callMachine}}],[{key:"supportedBrowser",value:function(){if(q())return{supported:!0,mobile:!0,name:"React Native",version:null,supportsScreenShare:!0,supportsSfu:!0,supportsVideoProcessing:!1,supportsAudioProcessing:!1};var s=yo.getParser(me());return{supported:!!va(),mobile:s.getPlatformType()==="mobile",name:s.getBrowserName(),version:s.getBrowserVersion(),supportsFullscreen:!!ga(),supportsScreenShare:!!Pl(),supportsSfu:!!va(),supportsVideoProcessing:ws(),supportsAudioProcessing:ks()}}},{key:"version",value:function(){return"0.73.0"}},{key:"createCallObject",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.layout="none",new ae(null,s)}},{key:"wrap",value:function(s){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(U(),!s||!s.contentWindow||typeof s.src!="string")throw new Error("DailyIframe::Wrap needs an iframe-like first argument");return u.layout||(u.customLayout?u.layout="custom-v1":u.layout="browser"),new ae(s,u)}},{key:"createFrame",value:function(s,u){var d,m;U(),s&&u?(d=s,m=u):s&&s.append?(d=s,m={}):(d=document.body,m=s||{});var f=m.iframeStyle;f||(f=d===document.body?{position:"fixed",border:"1px solid black",backgroundColor:"white",width:"375px",height:"450px",right:"1em",bottom:"1em"}:{border:0,width:"100%",height:"100%"});var y=document.createElement("iframe");window.navigator&&window.navigator.userAgent.match(/Chrome\/61\./)?y.allow="microphone, camera":y.allow="microphone; camera; autoplay; display-capture; screen-wake-lock",y.style.visibility="hidden",d.appendChild(y),y.style.visibility=null,Object.keys(f).forEach(function(M){return y.style[M]=f[M]}),m.layout||(m.customLayout?m.layout="custom-v1":m.layout="browser");try{return new ae(y,m)}catch(M){throw d.removeChild(y),M}}},{key:"createTransparentFrame",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};U();var u=document.createElement("iframe");return u.allow="microphone; camera; autoplay",u.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
      pointer-events: none;
    `,document.body.appendChild(u),s.layout||(s.layout="custom-v1"),ae.wrap(u,s)}},{key:"getCallInstance",value:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return s?nt[s]:Object.values(nt)[0]}}]),ae}();function vt(t,e){var n={};for(var r in t)if(t[r]instanceof MediaStreamTrack)n[r]=Bt;else if(r==="dailyConfig"){if(t[r].modifyLocalSdpHook){var i=window._daily.instances[e].customCallbacks||{};i.modifyLocalSdpHook=t[r].modifyLocalSdpHook,window._daily.instances[e].customCallbacks=i,delete t[r].modifyLocalSdpHook}if(t[r].modifyRemoteSdpHook){var a=window._daily.instances[e].customCallbacks||{};a.modifyRemoteSdpHook=t[r].modifyRemoteSdpHook,window._daily.instances[e].customCallbacks=a,delete t[r].modifyRemoteSdpHook}n[r]=t[r]}else n[r]=t[r];return n}function H(t){var e=arguments.length>2?arguments[2]:void 0;if(t!==at){var n="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," only supported after join.");throw e&&(n+=" ".concat(e)),console.error(n),new Error(n)}}function fn(t,e){return[gr,at].includes(t)||e}function Yn(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"This daily-js method",r=arguments.length>3?arguments[3]:void 0;if(fn(t,e)){var i="".concat(n," not supported after joining a meeting.");throw r&&(i+=" ".concat(r)),console.error(i),new Error(i)}}function ln(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method",n=arguments.length>2?arguments[2]:void 0;if(!t){var r="".concat(e,arguments.length>3&&arguments[3]!==void 0&&arguments[3]?" requires preAuth() or startCamera() to initialize call state.":" requires preAuth(), startCamera(), or join() to initialize call state.");throw n&&(r+=" ".concat(n)),console.error(r),new Error(r)}}function Xn(t){if(t){var e="A pre-call quality test is in progress. Please try ".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," again once testing has completed. Use stopTestCallQuality() to end it early.");throw console.error(e),new Error(e)}}function ve(t){if(!t){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported on custom callObject instances");throw console.error(e),new Error(e)}}function de(t){if(t){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported as part of Daily's Prebuilt");throw console.error(e),new Error(e)}}function U(){if(q())throw new Error("This daily-js method is not currently supported in React Native")}function Nt(){if(!q())throw new Error("This daily-js method is only supported in React Native")}function Ps(t){if(t===void 0)return!0;var e;if(typeof t=="string")e=t;else try{e=JSON.stringify(t),le(JSON.parse(e),t)||console.warn("The userData provided will be modified when serialized.")}catch(n){throw Error("userData must be serializable to JSON: ".concat(n))}if(e.length>4096)throw Error("userData is too large (".concat(e.length," characters). Maximum size suppported is ").concat(4096,"."));return!0}function Ls(t,e){for(var n=e.allowAllParticipantsKey,r=function(g){var _=["local"];return n||_.push("*"),g&&!_.includes(g)},i=function(g){return!!(g.layer===void 0||Number.isInteger(g.layer)&&g.layer>=0||g.layer==="inherit")},a=function(g){return!!g&&!(g.video&&!i(g.video))&&!(g.screenVideo&&!i(g.screenVideo))},o=0,l=Object.entries(t);o<l.length;o++){var c=ut(l[o],2),h=c[0],p=c[1];if(!r(h)||!a(p))return!1}return!0}function xs(t){return z(t)==="object"&&!(t.video&&(z(t.video)!=="object"||!function(i){var a=["type","config"];return!i||z(i)!=="object"||!function(o){return typeof o!="string"?!1:Object.values(pn).includes(o)?!0:(console.error("inputSettings video processor type invalid"),!1)}(i.type)||i.config&&(z(i.config)!=="object"||!function(o,l){var c=Object.keys(l);if(c.length===0)return!0;var h="invalid object in inputSettings -> video -> processor -> config";switch(o){case pn.BGBLUR:return c.length>1||c[0]!=="strength"?(console.error(h),!1):!(typeof l.strength!="number"||l.strength<=0||l.strength>1||isNaN(l.strength))||(console.error("".concat(h,"; expected: {0 < strength <= 1}, got: ").concat(l.strength)),!1);case pn.BGIMAGE:return!(l.source!==void 0&&!function(p){if(p.source==="default")return p.type="default",!0;if(p.source instanceof ArrayBuffer)return!0;if(gn(p.source))return p.type="url",!!function(C){var v=new URL(C),w=v.pathname;if(v.protocol==="data:")try{var O=w.substring(w.indexOf(":")+1,w.indexOf(";")).split("/")[1];return Gn.includes(O)}catch(x){return console.error("failed to deduce blob content type",x),!1}var A=w.split(".").at(-1).toLowerCase().trim();return Gn.includes(A)}(p.source)||(console.error("invalid image type; supported types: [".concat(Gn.join(", "),"]")),!1);return g=p.source,_=Number(g),isNaN(_)||!Number.isInteger(_)||_<=0||_>10?(console.error("invalid image selection; must be an int, > 0, <= ".concat(10)),!1):(p.type="daily-preselect",!0);var g,_}(l));default:return!0}}(i.type,i.config))?!1:(Object.keys(i).filter(function(o){return!a.includes(o)}).forEach(function(o){console.warn("invalid key inputSettings -> video -> processor : ".concat(o)),delete i[o]}),!0)}(t.video.processor)))&&!(t.audio&&(z(t.audio)!=="object"||(n=t.audio.processor,r=["type"],!n||z(n)!=="object"||(Object.keys(n).filter(function(i){return!r.includes(i)}).forEach(function(i){console.warn("invalid key inputSettings -> audio -> processor : ".concat(i)),delete n[i]}),e=n.type,typeof e!="string"||!Object.values(bs).includes(e)&&(console.error("inputSettings audio processor type invalid"),1)))));var e,n,r}function js(t,e){var n,r=[];t.video&&!ws((n=e==null?void 0:e.useLegacyVideoProcessor)!==null&&n!==void 0&&n)&&(delete t.video,r.push("video")),t.audio&&!ks()&&(delete t.audio,r.push("audio")),r.length>0&&console.error("Ignoring settings for browser- or platform-unsupported input processor(s): ".concat(r.join(", ")))}function kr(){var t=Object.values(pn).join(" | "),e=Object.values(bs).join(" | ");return"inputSettings must be of the form: { video?: { processor: { type: [ ".concat(t," ], config?: {} } }, audio?: { processor: {type: [ ").concat(e," ] } } }")}function Ds(t){var e=t.allowAllParticipantsKey;return"receiveSettings must be of the form { [<remote participant id> | ".concat(Ac).concat(e?' | "'.concat("*",'"'):"","]: ")+'{ [video: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]], [screenVideo: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]] }}}'}function Is(){return"customIntegrations should be an object of type ".concat(JSON.stringify(wr),".")}function Ns(t){if(t&&z(t)!=="object"||Array.isArray(t))return console.error("customTrayButtons should be an Object of the type ".concat(JSON.stringify(kn),".")),!1;if(t)for(var e=0,n=Object.entries(t);e<n.length;e++)for(var r=ut(n[e],1)[0],i=0,a=Object.entries(t[r]);i<a.length;i++){var o=ut(a[i],2),l=o[0],c=o[1],h=kn.id[l];if(!h)return console.error("customTrayButton does not support key ".concat(l)),!1;switch(l){case"iconPath":case"iconPathDarkMode":if(!gn(c))return console.error("customTrayButton ".concat(l," should be a url.")),!1;break;case"visualState":if(!["default","sidebar-open","active"].includes(c))return console.error("customTrayButton ".concat(l," should be ").concat(h,". Got: ").concat(c)),!1;break;default:if(z(c)!==h)return console.error("customTrayButton ".concat(l," should be a ").concat(h,".")),!1}}return!0}function Rs(t){if(!t||t&&z(t)!=="object"||Array.isArray(t))return console.error(Is()),!1;for(var e=function(g){return"".concat(g," should be ").concat(wr.id[g])},n=function(g,_){return console.error("customIntegration ".concat(g,": ").concat(_))},r=0,i=Object.entries(t);r<i.length;r++){var a=ut(i[r],1)[0];if(!("label"in t[a]))return n(a,"label is required"),!1;if(!("location"in t[a]))return n(a,"location is required"),!1;if(!("src"in t[a])&&!("srcdoc"in t[a]))return n(a,"src or srcdoc is required"),!1;for(var o=0,l=Object.entries(t[a]);o<l.length;o++){var c=ut(l[o],2),h=c[0],p=c[1];switch(h){case"allow":case"csp":case"name":case"referrerPolicy":case"sandbox":if(typeof p!="string")return n(a,e(h)),!1;break;case"iconURL":if(!gn(p))return n(a,"".concat(h," should be a url")),!1;break;case"src":if("srcdoc"in t[a])return n(a,"cannot have both src and srcdoc"),!1;if(!gn(p))return n(a,'src "'.concat(p,'" is not a valid URL')),!1;break;case"srcdoc":if("src"in t[a])return n(a,"cannot have both src and srcdoc"),!1;if(typeof p!="string")return n(a,e(h)),!1;break;case"location":if(!["main","sidebar"].includes(p))return n(a,e(h)),!1;break;case"controlledBy":if(p!=="*"&&p!=="owners"&&(!Array.isArray(p)||p.some(function(g){return typeof g!="string"})))return n(a,e(h)),!1;break;case"shared":if((!Array.isArray(p)||p.some(function(g){return typeof g!="string"}))&&p!=="owners"&&typeof p!="boolean")return n(a,e(h)),!1;break;default:if(!wr.id[h])return console.error("customIntegration does not support key ".concat(h)),!1}}}return!0}function Bs(t,e){if(e===void 0)return!1;switch(z(e)){case"string":return z(t)===e;case"object":if(z(t)!=="object")return!1;for(var n in t)if(!Bs(t[n],e[n]))return!1;return!0;default:return!1}}function Ba(t,e){var n=t.sessionId,r=t.toEndPoint,i=t.useSipRefer;if(!n||!r)throw new Error("".concat(e,"() requires a sessionId and toEndPoint"));if(typeof n!="string"||typeof r!="string")throw new Error("Invalid paramater: sessionId and toEndPoint must be of type string");if(i&&!r.startsWith("sip:"))throw new Error('"toEndPoint" must be a "sip" address');if(!r.startsWith("sip:")&&!r.startsWith("+"))throw new Error("toEndPoint: ".concat(r,' must starts with either "sip:" or "+"'))}function Fa(t){if(z(t)!=="object")throw new Error('RemoteMediaPlayerSettings: must be "object" type');if(t.state&&!Object.values(vr).includes(t.state))throw new Error("Invalid value for RemoteMediaPlayerSettings.state, valid values are: "+JSON.stringify(vr));if(t.volume){if(typeof t.volume!="number")throw new Error('RemoteMediaPlayerSettings.volume: must be "number" type');if(t.volume<0||t.volume>2)throw new Error("RemoteMediaPlayerSettings.volume: must be between 0.0 - 2.0")}}function Ua(t,e,n){return!(typeof t!="number"||t<e||t>n)}function Zn(t,e){return t&&!e&&delete t.data,t}function ru(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}var iu={};ru(iu,"DailyTransport",()=>Fs);class Fs extends es{constructor({dailyFactoryOptions:e={}}={}){super(),this._botId="",this._selectedCam={},this._selectedMic={},this._selectedSpeaker={},this._dailyFactoryOptions=e}initialize(e,n){this._callbacks=e.callbacks??{},this._onMessage=n;const r=Ra.getCallInstance();r&&r.destroy(),this._daily=Ra.createCallObject({...this._dailyFactoryOptions,startVideoOff:e.enableCam!=!0,startAudioOff:e.enableMic==!1,allowMultipleCallInstances:!0}),this.attachEventListeners(),this.state="disconnected",Q.debug("[RTVI Transport] Initialized")}get state(){return this._state}set state(e){var n,r;this._state!==e&&(this._state=e,(r=(n=this._callbacks).onTransportStateChanged)==null||r.call(n,e))}async getAllCams(){const{devices:e}=await this._daily.enumerateDevices();return e.filter(n=>n.kind==="videoinput")}updateCam(e){this._daily.setInputDevicesAsync({videoDeviceId:e}).then(n=>{this._selectedCam=n.camera})}get selectedCam(){return this._selectedCam}async getAllMics(){const{devices:e}=await this._daily.enumerateDevices();return e.filter(n=>n.kind==="audioinput")}updateMic(e){this._daily.setInputDevicesAsync({audioDeviceId:e}).then(n=>{this._selectedMic=n.mic})}get selectedMic(){return this._selectedMic}async getAllSpeakers(){const{devices:e}=await this._daily.enumerateDevices();return e.filter(n=>n.kind==="audiooutput")}updateSpeaker(e){this._daily.setOutputDeviceAsync({outputDeviceId:e}).then(n=>{this._selectedSpeaker=n.speaker})}get selectedSpeaker(){return this._selectedSpeaker}enableMic(e){this._daily.setLocalAudio(e)}get isMicEnabled(){return this._daily.localAudio()}enableCam(e){this._daily.setLocalVideo(e)}get isCamEnabled(){return this._daily.localVideo()}enableScreenShare(e){e?this._daily.startScreenShare():this._daily.stopScreenShare()}get isSharingScreen(){return this._daily.localScreenAudio()||this._daily.localScreenVideo()}tracks(){var i,a,o,l,c,h,p,g,_,C,v,w,O,A,x,N,k;const e=((i=this._daily)==null?void 0:i.participants())??{},n=e==null?void 0:e[this._botId],r={local:{audio:(l=(o=(a=e==null?void 0:e.local)==null?void 0:a.tracks)==null?void 0:o.audio)==null?void 0:l.persistentTrack,screenAudio:(p=(h=(c=e==null?void 0:e.local)==null?void 0:c.tracks)==null?void 0:h.screenAudio)==null?void 0:p.persistentTrack,screenVideo:(C=(_=(g=e==null?void 0:e.local)==null?void 0:g.tracks)==null?void 0:_.screenVideo)==null?void 0:C.persistentTrack,video:(O=(w=(v=e==null?void 0:e.local)==null?void 0:v.tracks)==null?void 0:w.video)==null?void 0:O.persistentTrack}};return n&&(r.bot={audio:(x=(A=n==null?void 0:n.tracks)==null?void 0:A.audio)==null?void 0:x.persistentTrack,video:(k=(N=n==null?void 0:n.tracks)==null?void 0:N.video)==null?void 0:k.persistentTrack}),r}async initDevices(){var o,l,c,h,p,g,_,C,v,w,O,A;if(!this._daily)throw new fe("Transport instance not initialized");this.state="initializing";const e=await this._daily.startCamera(),{devices:n}=await this._daily.enumerateDevices(),r=n.filter(x=>x.kind==="videoinput"),i=n.filter(x=>x.kind==="audioinput"),a=n.filter(x=>x.kind==="audiooutput");(l=(o=this._callbacks).onAvailableCamsUpdated)==null||l.call(o,r),(h=(c=this._callbacks).onAvailableMicsUpdated)==null||h.call(c,i),(g=(p=this._callbacks).onAvailableSpeakersUpdated)==null||g.call(p,a),this._selectedCam=e.camera,(C=(_=this._callbacks).onCamUpdated)==null||C.call(_,e.camera),this._selectedMic=e.mic,(w=(v=this._callbacks).onMicUpdated)==null||w.call(v,e.mic),this._selectedSpeaker=e.speaker,(A=(O=this._callbacks).onSpeakerUpdated)==null||A.call(O,e.speaker),this._daily.isLocalAudioLevelObserverRunning()||await this._daily.startLocalAudioLevelObserver(100),this._daily.isRemoteParticipantsAudioLevelObserverRunning()||await this._daily.startRemoteParticipantsAudioLevelObserver(100),this.state="initialized"}async connect(e,n){var r,i,a;if(!this._daily)throw new fe("Transport instance not initialized");if(!n.signal.aborted){this.state="connecting";try{await this._daily.join({url:e.room_url,token:e.token});const o=await this._daily.room();o&&"id"in o&&(this._expiry=(r=o.config)==null?void 0:r.exp)}catch{throw this.state="error",new za}n.signal.aborted||(this.state="connected",(a=(i=this._callbacks).onConnected)==null||a.call(i))}}async sendReadyMessage(){return new Promise(e=>{(async()=>this._daily.on("track-started",n=>{var r;(r=n.participant)!=null&&r.local||(this.state="ready",this.sendMessage(ie.clientReady()),e())}))()})}attachEventListeners(){this._daily.on("available-devices-updated",this.handleAvailableDevicesUpdated.bind(this)),this._daily.on("selected-devices-updated",this.handleSelectedDevicesUpdated.bind(this)),this._daily.on("track-started",this.handleTrackStarted.bind(this)),this._daily.on("track-stopped",this.handleTrackStopped.bind(this)),this._daily.on("participant-joined",this.handleParticipantJoined.bind(this)),this._daily.on("participant-left",this.handleParticipantLeft.bind(this)),this._daily.on("local-audio-level",this.handleLocalAudioLevel.bind(this)),this._daily.on("remote-participants-audio-level",this.handleRemoteAudioLevel.bind(this)),this._daily.on("app-message",this.handleAppMessage.bind(this)),this._daily.on("left-meeting",this.handleLeftMeeting.bind(this)),this._daily.on("nonfatal-error",this.handleNonFatalError.bind(this))}async disconnect(){this._daily.stopLocalAudioLevelObserver(),this._daily.stopRemoteParticipantsAudioLevelObserver(),await this._daily.leave(),await this._daily.destroy()}sendMessage(e){this._daily.sendAppMessage(e,"*")}handleAppMessage(e){e.data.label==="rtvi-ai"&&this._onMessage({id:e.data.id,type:e.data.type,data:e.data.data})}handleAvailableDevicesUpdated(e){var n,r,i,a,o,l;(r=(n=this._callbacks).onAvailableCamsUpdated)==null||r.call(n,e.availableDevices.filter(c=>c.kind==="videoinput")),(a=(i=this._callbacks).onAvailableMicsUpdated)==null||a.call(i,e.availableDevices.filter(c=>c.kind==="audioinput")),(l=(o=this._callbacks).onAvailableSpeakersUpdated)==null||l.call(o,e.availableDevices.filter(c=>c.kind==="audiooutput"))}handleSelectedDevicesUpdated(e){var n,r,i,a,o,l,c,h,p;((n=this._selectedCam)==null?void 0:n.deviceId)!==e.devices.camera&&(this._selectedCam=e.devices.camera,(i=(r=this._callbacks).onCamUpdated)==null||i.call(r,e.devices.camera)),((a=this._selectedMic)==null?void 0:a.deviceId)!==e.devices.mic&&(this._selectedMic=e.devices.mic,(l=(o=this._callbacks).onMicUpdated)==null||l.call(o,e.devices.mic)),((c=this._selectedSpeaker)==null?void 0:c.deviceId)!==e.devices.speaker&&(this._selectedSpeaker=e.devices.speaker,(p=(h=this._callbacks).onSpeakerUpdated)==null||p.call(h,e.devices.speaker))}handleTrackStarted(e){var n,r,i,a;e.type==="screenAudio"||e.type==="screenVideo"?(r=(n=this._callbacks).onScreenTrackStarted)==null||r.call(n,e.track,e.participant?it(e.participant):void 0):(a=(i=this._callbacks).onTrackStarted)==null||a.call(i,e.track,e.participant?it(e.participant):void 0)}handleTrackStopped(e){var n,r,i,a;e.type==="screenAudio"||e.type==="screenVideo"?(r=(n=this._callbacks).onScreenTrackStopped)==null||r.call(n,e.track,e.participant?it(e.participant):void 0):(a=(i=this._callbacks).onTrackStopped)==null||a.call(i,e.track,e.participant?it(e.participant):void 0)}handleParticipantJoined(e){var r,i,a,o;const n=it(e.participant);(i=(r=this._callbacks).onParticipantJoined)==null||i.call(r,n),!n.local&&(this._botId=e.participant.session_id,(o=(a=this._callbacks).onBotConnected)==null||o.call(a,n))}handleParticipantLeft(e){var r,i,a,o;const n=it(e.participant);(i=(r=this._callbacks).onParticipantLeft)==null||i.call(r,n),!n.local&&(this._botId="",(o=(a=this._callbacks).onBotDisconnected)==null||o.call(a,n))}handleLocalAudioLevel(e){var n,r;(r=(n=this._callbacks).onLocalAudioLevel)==null||r.call(n,e.audioLevel)}handleRemoteAudioLevel(e){var i,a;const n=this._daily.participants(),r=Object.keys(e.participantsAudioLevel);for(let o=0;o<r.length;o++){const l=r[o],c=e.participantsAudioLevel[l];(a=(i=this._callbacks).onRemoteAudioLevel)==null||a.call(i,c,it(n[l]))}}handleLeftMeeting(){var e,n;this.state="disconnecting",this._botId="",(n=(e=this._callbacks).onDisconnected)==null||n.call(e)}handleNonFatalError(e){var n,r;switch(e.type){case"screen-share-error":(r=(n=this._callbacks).onScreenShareError)==null||r.call(n,e.errorMsg);break}}}const it=t=>({id:t.user_id,local:t.local,name:t.user_name});class au{constructor(){this.rtviClient=null,this.setupDOMElements(),this.setupEventListeners()}setupDOMElements(){this.connectBtn=document.getElementById("connect-btn"),this.disconnectBtn=document.getElementById("disconnect-btn"),this.statusSpan=document.getElementById("connection-status"),this.debugLog=document.getElementById("debug-log"),this.botVideoContainer=document.getElementById("bot-video-container"),this.botTranscriptContainer=document.getElementById("bot-transcript"),this.botAudio=document.createElement("audio"),this.botAudio.autoplay=!0,this.botAudio.playsInline=!0,document.body.appendChild(this.botAudio)}clearAnnie(e,n){setTimeout(()=>{function r(i){for(;i.firstElementChild;)i.firstElementChild.remove()}r(e)},n)}setupEventListeners(){this.connectBtn.addEventListener("click",()=>this.connect()),this.disconnectBtn.addEventListener("click",()=>this.disconnect())}log(e){const n=document.createElement("div");n.textContent=`${new Date().toISOString()} - ${e}`,e.startsWith("User: ")?n.style.color="#2196F3":e.startsWith("Bot: ")&&(n.style.color="#4CAF50"),this.debugLog.appendChild(n),this.debugLog.scrollTop=this.debugLog.scrollHeight,console.log(e)}annie(e,n){const r=document.createElement("div");return r.textContent=`${n}`,r.font="Sans-serif",r.style.color="#f2d21b",r["text-shadow"]="2px 2px",e.appendChild(r),this.botTranscriptContainer.appendChild(e),console.log(n),e}updateStatus(e){this.statusSpan.textContent=e,this.log(`Status: ${e}`)}setupMediaTracks(){var n,r;if(!this.rtviClient)return;const e=this.rtviClient.tracks();(n=e.bot)!=null&&n.audio&&this.setupAudioTrack(e.bot.audio),(r=e.bot)!=null&&r.video&&this.setupVideoTrack(e.bot.video)}setupTrackListeners(){this.rtviClient&&(this.rtviClient.on(j.TrackStarted,(e,n)=>{n!=null&&n.local||(e.kind==="audio"?this.setupAudioTrack(e):e.kind==="video"&&this.setupVideoTrack(e))}),this.rtviClient.on(j.TrackStopped,(e,n)=>{this.log(`Track stopped event: ${e.kind} from ${(n==null?void 0:n.name)||"unknown"}`)}))}setupAudioTrack(e){if(this.log("Setting up audio track"),this.botAudio.srcObject){const n=this.botAudio.srcObject.getAudioTracks()[0];if((n==null?void 0:n.id)===e.id)return}this.botAudio.srcObject=new MediaStream([e])}setupVideoTrack(e){var r;this.log("Setting up video track");const n=document.createElement("video");if(n.autoplay=!0,n.playsInline=!0,n.muted=!0,n.style.width="100%",n.style.height="100%",n.style.objectFit="cover",(r=this.botVideoContainer.querySelector("video"))!=null&&r.srcObject){const i=this.botVideoContainer.querySelector("video").srcObject.getVideoTracks()[0];if((i==null?void 0:i.id)===e.id)return}n.srcObject=new MediaStream([e]),this.botVideoContainer.innerHTML="",this.botVideoContainer.appendChild(n)}async connect(){try{const e=new Fs;this.rtviClient=new Ne({transport:e,params:{baseUrl:"https://annie-hall-weatherbot.onrender.com",endpoints:{connect:"/connect"}},enableMic:!0,enableCam:!1,callbacks:{onConnected:()=>{this.updateStatus("Connected"),this.connectBtn.disabled=!0,this.disconnectBtn.disabled=!1,this.log("Client connected")},onDisconnected:()=>{this.updateStatus("Disconnected"),this.connectBtn.disabled=!1,this.disconnectBtn.disabled=!0,this.log("Client disconnected")},onTransportStateChanged:n=>{this.updateStatus(`Transport: ${n}`),this.log(`Transport state changed: ${n}`),n==="ready"&&this.setupMediaTracks()},onBotConnected:n=>{this.log(`Bot connected: ${JSON.stringify(n)}`)},onBotDisconnected:n=>{this.log(`Bot disconnected: ${JSON.stringify(n)}`)},onBotReady:n=>{this.log(`Bot ready: ${JSON.stringify(n)}`),this.setupMediaTracks()},onBotTranscript:n=>{if(n.text.startsWith("&nnie")||this.log(` Bot: ${n.text}`),n.text.startsWith("&nnie")){const r=n.text.replaceAll("&nnie",""),i=document.createElement("div"),a=this.annie(i,r);this.clearAnnie(i,10*1e3)}},onUserTranscript:n=>{n.final&&this.log(`User: ${n.text}`)},onMessageError:n=>{console.log("Message error:",n)},onError:n=>{console.log("Error:",n)}}}),this.setupTrackListeners(),this.log("Initializing devices..."),await this.rtviClient.initDevices(),this.log("Connecting to bot..."),await this.rtviClient.connect(),this.log("Connection complete")}catch(e){if(this.log(`Error connecting: ${e.message}`),this.log(`Error stack: ${e.stack}`),this.updateStatus("Error"),this.rtviClient)try{await this.rtviClient.disconnect()}catch(n){this.log(`Error during disconnect: ${n.message}`)}}}async disconnect(){if(this.rtviClient)try{await this.rtviClient.disconnect(),this.rtviClient=null,this.botAudio.srcObject&&(this.botAudio.srcObject.getTracks().forEach(e=>e.stop()),this.botAudio.srcObject=null)}catch(e){this.log(`Error disconnecting: ${e.message}`)}}}window.addEventListener("DOMContentLoaded",()=>{new au});
